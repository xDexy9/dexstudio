import{o as $,u as H,d as K,r,s as o,j as e,e as u,f as h,h as p,i as j,N as O,K as _,B as q}from"./index-CNxWMcuV.js";import{g as z,a as G,R as w}from"./invoiceService-B8qPXtsv.js";import{g as J}from"./companySettingsService-BheHf_-3.js";import{a as S}from"./pdfGenerator-DtjVo1jc.js";import{S as Q,a as U,b as Y,c as W,d as m}from"./select-CbHlLrev.js";import{D as X,a as Z,E as ee,b as se,c as x}from"./dropdown-menu-B4ssD23R.js";import{E as D}from"./euro-JmB74vkB.js";import{S as te}from"./search-vDLcJ1l5.js";import{E as ae}from"./eye-Dbr3NOu6.js";import{F as re}from"./file-text-_cJWw5Fx.js";import{D as le}from"./download-CwOjd3gN.js";import{P as ne}from"./printer-BEYF_3-0.js";import{f as C}from"./format-DSNd7y_7.js";import"./chevron-down-n_8xVDCk.js";function ye(){$();const{t}=H(),f=K(),[N,F]=r.useState([]),[g,I]=r.useState([]),[M,v]=r.useState(!0),[i,P]=r.useState(""),[n,E]=r.useState("all"),[c,T]=r.useState(null),[d,L]=r.useState(null),y={unpaid:{label:t("invoices.unpaid"),color:"bg-amber-100 text-amber-800"},partial:{label:t("invoices.partial"),color:"bg-blue-100 text-blue-800"},paid:{label:t("invoices.paid"),color:"bg-green-100 text-green-800"},overdue:{label:t("invoices.overdue"),color:"bg-red-100 text-red-800"}};r.useEffect(()=>{k()},[]),r.useEffect(()=>{A()},[N,i,n]);const k=async()=>{try{v(!0);const[s,a,l]=await Promise.all([z(),G(),J()]);F(s),T(a),L(l)}catch(s){console.error("Error loading invoices:",s),o.error("Failed to load invoices")}finally{v(!1)}},A=()=>{let s=[...N];if(i){const a=i.toLowerCase();s=s.filter(l=>l.invoiceNumber.toLowerCase().includes(a)||l.customer.name.toLowerCase().includes(a)||l.vehicle.licensePlate.toLowerCase().includes(a))}n&&n!=="all"&&(s=s.filter(a=>a.paymentStatus===n)),I(s)},V=async s=>{if(!d){o.error("Company settings not configured");return}try{await S(s,d)}catch(a){console.error("Error downloading PDF:",a),o.error("Failed to download PDF")}},B=async s=>{if(!d){o.error("Company settings not configured");return}try{await S(s,d)}catch(a){console.error("Error printing PDF:",a),o.error("Failed to print PDF")}},R=s=>s.paymentStatus==="paid"?!1:new Date(s.dueDate)<new Date;return M?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(w,{className:"h-8 w-8 text-primary"}),t("invoices.title")]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:t("invoices.subtitle")})]}),c&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(u,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:t("common.total")})}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold",children:c.total})})]}),e.jsxs(u,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:t("invoices.thisMonth")})}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:c.thisMonth})})]}),e.jsxs(u,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:t("invoices.thisMonthValue")})}),e.jsx(j,{children:e.jsxs("div",{className:"text-2xl font-bold text-green-600 flex items-center gap-1",children:[e.jsx(D,{className:"h-5 w-5"}),c.thisMonthValue.toFixed(0)]})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"relative flex-1 min-w-[300px]",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(O,{placeholder:t("invoices.searchPlaceholder"),value:i,onChange:s=>P(s.target.value),className:"pl-10"})]}),e.jsxs(Q,{value:n,onValueChange:E,children:[e.jsx(U,{className:"w-[180px]",children:e.jsx(Y,{placeholder:t("invoices.allStatuses")})}),e.jsxs(W,{children:[e.jsx(m,{value:"all",children:t("invoices.allStatuses")}),e.jsx(m,{value:"unpaid",children:t("invoices.unpaid")}),e.jsx(m,{value:"partial",children:t("invoices.partial")}),e.jsx(m,{value:"paid",children:t("invoices.paid")})]})]})]}),e.jsxs("div",{className:"rounded-lg border",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:t("invoices.invoiceNumber")}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:t("common.customer")}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:t("jobs.vehicle")}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium",children:t("common.amount")}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium",children:t("common.status")}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:t("invoices.issueDate")}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:t("invoices.dueDate")}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium",children:t("common.actions")})]})}),e.jsx("tbody",{className:"divide-y",children:g.map(s=>{const a=R(s),l=a?"overdue":s.paymentStatus,b=y[l]||y.unpaid;return e.jsxs("tr",{className:"hover:bg-muted/30",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-mono font-medium",children:s.invoiceNumber})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.customer.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.customer.phone})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.vehicle.brand," ",s.vehicle.model]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.vehicle.licensePlate})]})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsxs("div",{className:"flex items-center justify-end gap-1 font-semibold",children:[e.jsx(D,{className:"h-4 w-4"}),s.grandTotal.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.lineItems.length," ",s.lineItems.length===1?t("common.item"):t("common.items")]})]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx(_,{className:`${b.color} w-fit mx-auto`,children:b.label})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:C(new Date(s.issueDate),"dd MMM yyyy")}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:a?"text-red-600 font-medium":"",children:C(new Date(s.dueDate),"dd MMM yyyy")})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs(X,{children:[e.jsx(Z,{asChild:!0,children:e.jsx(q,{variant:"ghost",size:"icon",children:e.jsx(ee,{className:"h-4 w-4"})})}),e.jsxs(se,{align:"end",children:[e.jsxs(x,{onClick:()=>f(`/invoices/${s.id}`),children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),t("invoices.viewInvoice")]}),e.jsxs(x,{onClick:()=>f(`/jobs/${s.jobId}`),children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),t("quotes.viewJob")]}),e.jsxs(x,{onClick:()=>V(s),children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),t("common.download")]}),e.jsxs(x,{onClick:()=>B(s),children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),t("invoices.printInvoice")]})]})]})})]},s.id)})})]})}),g.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(w,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:t("invoices.noInvoicesFound")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t("invoices.createFromQuote")})]})]})]})}export{ye as InvoicesPage};
