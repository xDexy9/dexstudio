import{o as $,u as z,d as G,r as i,v as H,j as e,e as l,i as c,x as K,_ as f,N as M,f as Q,h as _,K as g,B as v,D as U,s as p}from"./index-CNxWMcuV.js";import{S as b,a as w,b as y,c as C,d as o}from"./select-CbHlLrev.js";import{P as N}from"./package-8-BxBKwT.js";import{C as P}from"./circle-check-big-a_8kXWWc.js";import{E as W}from"./external-link-ChWnHVz5.js";import"./chevron-down-n_8xVDCk.js";function ae(){const{user:m}=$(),{t:S}=z(),O=G(),[k,L]=i.useState([]),[x,A]=i.useState([]),[u,B]=i.useState("all"),[D,E]=i.useState("job"),[h,I]=i.useState(""),[J,T]=i.useState(!0);i.useEffect(()=>{const s=H(n=>{L(n);const a=[];n.forEach(r=>{var t;(t=r.workOrderData)!=null&&t.parts&&r.workOrderData.parts.forEach(d=>{(d.needsOrdering||d.partId)&&a.push({id:d.id,jobId:r.id,jobNumber:r.jobNumber,vehiclePlate:r.vehicleLicensePlate||"",description:d.partName||d.description,referenceNumber:d.partNumber,quantity:d.quantity,unitPrice:d.unitPrice,needsApproval:d.needsOrdering,mechanicName:r.workOrderData.mechanicName,status:"pending"})})}),A(a),T(!1)});return()=>s()},[]);const j=x.filter(s=>{var n,a;if(u!=="all"&&s.status!==u)return!1;if(h){const r=h.toLowerCase();return s.description.toLowerCase().includes(r)||((n=s.referenceNumber)==null?void 0:n.toLowerCase().includes(r))||s.vehiclePlate.toLowerCase().includes(r)||((a=s.jobNumber)==null?void 0:a.toLowerCase().includes(r))}return!0}),q=x.filter(s=>s.status==="pending").length,R=x.filter(s=>s.status==="ordered").length,V=x.filter(s=>s.status==="received").length,F=async(s,n)=>{const a=k.find(t=>t.id===n);if(!a||!a.workOrderData)return;const r=a.workOrderData.parts.map(t=>t.id===s?{...t,needsOrdering:!1}:t);try{await U(n,{workOrderData:{...a.workOrderData,parts:r}},m==null?void 0:m.id),p.success("Part marked as ordered")}catch(t){console.error("Error updating part status:",t),p.error("Failed to update part status")}};return J?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading parts orders..."})}):e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Parts Ordering Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Track and manage parts needing orders across all jobs"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(l,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Parts"}),e.jsx("p",{className:"text-2xl font-bold",children:x.length})]}),e.jsx(N,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(l,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:q})]}),e.jsx(K,{className:"h-8 w-8 text-orange-600"})]})})}),e.jsx(l,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Ordered"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:R})]}),e.jsx(N,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(l,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Received"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:V})]}),e.jsx(P,{className:"h-8 w-8 text-green-600"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(f,{className:"text-xs",children:"Search"}),e.jsx(M,{placeholder:"Search parts, reference, vehicle...",value:h,onChange:s=>I(s.target.value)})]}),e.jsxs("div",{className:"w-full sm:w-48",children:[e.jsx(f,{className:"text-xs",children:"Status"}),e.jsxs(b,{value:u,onValueChange:s=>B(s),children:[e.jsx(w,{children:e.jsx(y,{})}),e.jsxs(C,{children:[e.jsx(o,{value:"all",children:"All Status"}),e.jsx(o,{value:"pending",children:"Pending"}),e.jsx(o,{value:"ordered",children:"Ordered"}),e.jsx(o,{value:"received",children:"Received"})]})]})]}),e.jsxs("div",{className:"w-full sm:w-48",children:[e.jsx(f,{className:"text-xs",children:"Group By"}),e.jsxs(b,{value:D,onValueChange:s=>E(s),children:[e.jsx(w,{children:e.jsx(y,{})}),e.jsxs(C,{children:[e.jsx(o,{value:"job",children:"By Job"}),e.jsx(o,{value:"category",children:"By Category"})]})]})]})]}),e.jsxs(l,{children:[e.jsx(Q,{children:e.jsxs(_,{className:"text-lg",children:["Parts Needing Orders (",j.length,")"]})}),e.jsx(c,{children:j.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No parts found"})]}):e.jsx("div",{className:"space-y-4",children:j.map(s=>e.jsx(l,{className:"hover:shadow-md transition-shadow",children:e.jsx(c,{className:"pt-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold",children:s.description}),s.needsApproval&&e.jsx(g,{variant:"destructive",className:"text-xs",children:"Needs Approval"}),e.jsx(g,{variant:s.status==="received"?"default":s.status==="ordered"?"secondary":"outline",children:s.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm text-muted-foreground",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Vehicle:"})," ",s.vehiclePlate]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Job:"})," ",s.jobNumber||s.jobId.slice(0,8)]}),s.referenceNumber&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Ref:"})," ",s.referenceNumber]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Qty:"})," ",s.quantity]}),s.unitPrice&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Price:"})," â‚¬",(s.quantity*s.unitPrice).toFixed(2)]}),s.mechanicName&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Requested by:"})," ",s.mechanicName]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(v,{size:"sm",variant:"outline",onClick:()=>O(`/jobs/${s.jobId}`),children:[e.jsx(W,{className:"h-4 w-4 mr-1"}),S("common.viewJob")]}),s.needsApproval&&s.status==="pending"&&e.jsxs(v,{size:"sm",onClick:()=>F(s.id,s.jobId),children:[e.jsx(P,{className:"h-4 w-4 mr-1"}),"Approve"]})]})]})})},`${s.jobId}-${s.id}`))})})]})]})}export{ae as default};
