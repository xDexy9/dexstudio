import{c as _,u as oe,o as os,r as g,j as e,ao as R,$ as cs,K as k,a as D,S as Xe,E as Dt,aA as is,C as ue,B as j,as as K,am as ds,an as He,ap as Ys,ar as St,N as V,P as ce,M as Ae,e as T,f as se,h as re,i as F,x as ye,_ as ae,aq as z,aB as Rs,aC as Ze,s as Ke,aD as Pt,d as Xs,aE as It,X as _s,Z as Ot,D as pe,aF as $s,aG as Bs,k as Mt,O as Qs,a2 as At}from"./index-CNxWMcuV.js";import{T as ze}from"./textarea-D6buyuls.js";import{C as et,S as Tt,a as Ft,b as qt,c as Lt,d as Me}from"./select-CbHlLrev.js";import{D as Re,b as _e,c as $e,d as Be,e as ms,f as st}from"./dialog-CIS6byhQ.js";import{g as Et,a as zt,d as Ht,b as Rt,c as _t}from"./partsService-DfpAxGHT.js";import{g as Te}from"./jobTranslation-C42sppDK.js";import{C as tt}from"./car-brand-logo-BjPA7wLP.js";import{C as at}from"./chevron-down-n_8xVDCk.js";import{G as ss}from"./gauge-BGmypo8-.js";import{P as rt}from"./phone-CnbjRpiL.js";import{T as we}from"./triangle-alert-CHSZJu74.js";import{C as ie}from"./circle-check-big-a_8kXWWc.js";import{C as es}from"./calendar-BxIrFUaJ.js";import{P as I}from"./package-8-BxBKwT.js";import{Z as xs}from"./zap-DwLr8eAC.js";import{S as it}from"./settings-CBKaQ5jg.js";import{C as $t}from"./car-DWakAuoX.js";import{H as Bt,Q as Vs}from"./QuoteBuilderModal-DpKzWyJ_.js";import{A as Qt,a as Vt,b as Wt,c as Ut,d as Jt,e as Gt,f as Zt,g as Kt}from"./alert-dialog-BDITvcmU.js";import{C as Ws}from"./checkbox-CtHhNy01.js";import{g as Yt,a as Xt}from"./servicesService-CCLYMeGf.js";import{g as ea}from"./companySettingsService-BheHf_-3.js";import{F as ke}from"./file-text-_cJWw5Fx.js";import{S as ns}from"./search-vDLcJ1l5.js";import{L as sa}from"./license-plate-BoT_Ewxe.js";import{P as ls,L as ta}from"./play-4evLEZIL.js";import{A as aa}from"./arrow-left-5j_RihUX.js";import{P as Us}from"./pencil-BmBYV1qM.js";import{M as ra}from"./message-square-BrEHgpxS.js";import{R as Js}from"./invoiceService-B8qPXtsv.js";import{f as ge}from"./format-DSNd7y_7.js";import"./googleTranslate-BIF2yF35.js";import"./quoteService-j1Naoogm.js";import"./tabs-gg0ONG9Z.js";import"./euro-JmB74vkB.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=_("CircleDot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=_("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=_("Cog",[["path",{d:"M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z",key:"sobvz5"}],["path",{d:"M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z",key:"11i496"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 22v-2",key:"1osdcq"}],["path",{d:"m17 20.66-1-1.73",key:"eq3orb"}],["path",{d:"M11 10.27 7 3.34",key:"16pf9h"}],["path",{d:"m20.66 17-1.73-1",key:"sg0v6f"}],["path",{d:"m3.34 7 1.73 1",key:"1ulond"}],["path",{d:"M14 12h8",key:"4f43i9"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"m20.66 7-1.73 1",key:"1ow05n"}],["path",{d:"m3.34 17 1.73-1",key:"nuk764"}],["path",{d:"m17 3.34-1 1.73",key:"2wel8s"}],["path",{d:"m11 13.73-4 6.93",key:"794ttg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=_("CornerDownLeft",[["polyline",{points:"9 10 4 15 9 20",key:"r3jprv"}],["path",{d:"M20 4v7a4 4 0 0 1-4 4H4",key:"6o5b7l"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=_("Disc",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=_("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=_("Fuel",[["line",{x1:"3",x2:"15",y1:"22",y2:"22",key:"xegly4"}],["line",{x1:"4",x2:"14",y1:"9",y2:"9",key:"xcnuvu"}],["path",{d:"M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18",key:"16j0yd"}],["path",{d:"M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5",key:"7cu91f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=_("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=_("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=_("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=_("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=_("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=_("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=_("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=_("ThermometerSun",[["path",{d:"M12 9a4 4 0 0 0-2 7.5",key:"1jvsq6"}],["path",{d:"M12 3v2",key:"1w22ol"}],["path",{d:"m6.6 18.4-1.4 1.4",key:"w2yidj"}],["path",{d:"M20 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"iof6y5"}],["path",{d:"M4 13H2",key:"118le4"}],["path",{d:"M6.34 7.34 4.93 5.93",key:"1brd51"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=_("Warehouse",[["path",{d:"M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z",key:"gksnxg"}],["path",{d:"M6 18h12",key:"9pbo8z"}],["path",{d:"M6 14h12",key:"4cwo0f"}],["rect",{width:"12",height:"12",x:"6",y:"10",key:"apd30q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=_("Wind",[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]]),Zs={en:{brake:{possibleCauses:["Worn brake pads or discs","Brake fluid leak or low level","Stuck brake caliper"],suggestedActions:["Inspect brake pad thickness","Check brake fluid level and condition","Test caliper movement"],estimatedDifficulty:"medium",warningNotes:"Ensure vehicle is safely supported before inspection"},engine:{possibleCauses:["Battery or charging system issue","Fuel delivery problem","Ignition system fault"],suggestedActions:["Test battery voltage","Check fuel pump operation","Scan for diagnostic trouble codes"],estimatedDifficulty:"medium"},oil:{possibleCauses:["Oil leak from gasket or seal","Oil consumption issue","Oil filter or drain plug problem"],suggestedActions:["Inspect for visible leaks","Check oil level and condition","Examine oil filter and drain plug"],estimatedDifficulty:"easy"},default:{possibleCauses:["Multiple potential causes - diagnosis required","Component wear or damage","Electrical or sensor issue"],suggestedActions:["Perform visual inspection","Run diagnostic scan","Test drive to verify symptoms"],estimatedDifficulty:"medium"}},fr:{brake:{possibleCauses:["Plaquettes ou disques de frein usés","Fuite ou niveau bas de liquide de frein","Étrier de frein bloqué"],suggestedActions:["Inspecter l'épaisseur des plaquettes","Vérifier le niveau et l'état du liquide de frein","Tester le mouvement de l'étrier"],estimatedDifficulty:"medium",warningNotes:"Assurez-vous que le véhicule est correctement supporté avant l'inspection"},engine:{possibleCauses:["Problème de batterie ou système de charge","Problème d'alimentation en carburant","Défaut du système d'allumage"],suggestedActions:["Tester la tension de la batterie","Vérifier le fonctionnement de la pompe à carburant","Scanner les codes de défaut"],estimatedDifficulty:"medium"},oil:{possibleCauses:["Fuite d'huile au niveau du joint","Consommation excessive d'huile","Problème de filtre ou bouchon de vidange"],suggestedActions:["Inspecter les fuites visibles","Vérifier le niveau et l'état de l'huile","Examiner le filtre à huile et le bouchon de vidange"],estimatedDifficulty:"easy"},default:{possibleCauses:["Causes multiples possibles - diagnostic requis","Usure ou dommage de composant","Problème électrique ou capteur"],suggestedActions:["Effectuer une inspection visuelle","Lancer un diagnostic électronique","Essai routier pour vérifier les symptômes"],estimatedDifficulty:"medium"}},ro:{brake:{possibleCauses:["Plăcuțe sau discuri de frână uzate","Scurgere sau nivel scăzut de lichid de frână","Etrier de frână blocat"],suggestedActions:["Inspectați grosimea plăcuțelor","Verificați nivelul și starea lichidului de frână","Testați mișcarea etrierului"],estimatedDifficulty:"medium",warningNotes:"Asigurați-vă că vehiculul este susținut în siguranță înainte de inspecție"},engine:{possibleCauses:["Problemă baterie sau sistem de încărcare","Problemă alimentare combustibil","Defecțiune sistem aprindere"],suggestedActions:["Testați tensiunea bateriei","Verificați funcționarea pompei de combustibil","Scanați codurile de eroare"],estimatedDifficulty:"medium"},oil:{possibleCauses:["Scurgere ulei de la garnitură","Consum excesiv de ulei","Problemă filtru sau bușon de golire"],suggestedActions:["Inspectați scurgerile vizibile","Verificați nivelul și starea uleiului","Examinați filtrul de ulei și bușonul"],estimatedDifficulty:"easy"},default:{possibleCauses:["Cauze multiple posibile - diagnostic necesar","Uzură sau deteriorare componentă","Problemă electrică sau senzor"],suggestedActions:["Efectuați o inspecție vizuală","Rulați diagnosticul electronic","Test de drum pentru verificarea simptomelor"],estimatedDifficulty:"medium"}},pt:{brake:{possibleCauses:["Pastilhas ou discos de travão gastos","Vazamento ou nível baixo de líquido de travão","Pinça de travão presa"],suggestedActions:["Inspecionar espessura das pastilhas","Verificar nível e condição do líquido de travão","Testar movimento da pinça"],estimatedDifficulty:"medium",warningNotes:"Certifique-se de que o veículo está apoiado com segurança antes da inspeção"},engine:{possibleCauses:["Problema de bateria ou sistema de carga","Problema de fornecimento de combustível","Falha no sistema de ignição"],suggestedActions:["Testar tensão da bateria","Verificar funcionamento da bomba de combustível","Escanear códigos de diagnóstico"],estimatedDifficulty:"medium"},oil:{possibleCauses:["Vazamento de óleo pela junta","Consumo excessivo de óleo","Problema no filtro ou tampão de drenagem"],suggestedActions:["Inspecionar vazamentos visíveis","Verificar nível e condição do óleo","Examinar filtro de óleo e tampão"],estimatedDifficulty:"easy"},default:{possibleCauses:["Múltiplas causas possíveis - diagnóstico necessário","Desgaste ou dano de componente","Problema elétrico ou sensor"],suggestedActions:["Realizar inspeção visual","Executar diagnóstico eletrônico","Test drive para verificar sintomas"],estimatedDifficulty:"medium"}},ru:{brake:{possibleCauses:["Изношенные тормозные колодки или диски","Утечка или низкий уровень тормозной жидкости","Заклинивший тормозной суппорт"],suggestedActions:["Проверить толщину тормозных колодок","Проверить уровень и состояние тормозной жидкости","Проверить движение суппорта"],estimatedDifficulty:"medium",warningNotes:"Убедитесь, что автомобиль надёжно закреплён перед осмотром"},engine:{possibleCauses:["Проблема аккумулятора или системы зарядки","Проблема подачи топлива","Неисправность системы зажигания"],suggestedActions:["Проверить напряжение аккумулятора","Проверить работу топливного насоса","Сканировать коды неисправностей"],estimatedDifficulty:"medium"},oil:{possibleCauses:["Утечка масла через прокладку","Чрезмерный расход масла","Проблема масляного фильтра или сливной пробки"],suggestedActions:["Осмотреть видимые утечки","Проверить уровень и состояние масла","Осмотреть масляный фильтр и пробку"],estimatedDifficulty:"easy"},default:{possibleCauses:["Множество возможных причин - требуется диагностика","Износ или повреждение компонента","Электрическая проблема или датчик"],suggestedActions:["Провести визуальный осмотр","Запустить электронную диагностику","Тест-драйв для проверки симптомов"],estimatedDifficulty:"medium"}}};async function oa(p,o,r){await new Promise(c=>setTimeout(c,800));const x=Zs[r]||Zs.en,d=p.toLowerCase();return d.includes("brake")||d.includes("frein")||d.includes("frână")||d.includes("travão")||d.includes("тормоз")?x.brake:d.includes("engine")||d.includes("moteur")||d.includes("motor")||d.includes("start")||d.includes("двигатель")?x.engine:d.includes("oil")||d.includes("huile")||d.includes("ulei")||d.includes("óleo")||d.includes("масл")?x.oil:x.default}function da({open:p,onOpenChange:o,job:r,vehicle:x,onConfirm:d}){const{t:c,language:a}=oe(),{user:t}=os(),C=(t==null?void 0:t.role)==="mechanic",[f,H]=g.useState(null),[y,W]=g.useState(!1),[q,J]=g.useState(!1);g.useEffect(()=>{p&&x&&!f&&(W(!0),oa(r.problemDescription,{brand:x.brand,model:x.model,year:x.year},a).then(S=>{H(S),W(!1)}))},[p,x,r.problemDescription,a,f]),g.useEffect(()=>{p||H(null)},[p]);const L={repair:c("modal.assignment.serviceType.repair"),maintenance:c("modal.assignment.serviceType.maintenance"),inspection:c("modal.assignment.serviceType.inspection"),diagnostic:c("modal.assignment.serviceType.diagnostic")},h={low:{class:"bg-muted text-muted-foreground",label:c("modal.assignment.priority.low")},normal:{class:"bg-primary/10 text-primary",label:c("modal.assignment.priority.normal")},urgent:{class:"bg-destructive/10 text-destructive",label:c("modal.assignment.priority.urgent")}},w={easy:{class:"bg-green-500/10 text-green-600",label:c("modal.assignment.difficulty.easy")},medium:{class:"bg-amber-500/10 text-amber-600",label:c("modal.assignment.difficulty.medium")},hard:{class:"bg-red-500/10 text-red-600",label:c("modal.assignment.difficulty.hard")}};return e.jsx(Re,{open:p,onOpenChange:o,children:e.jsxs(_e,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs($e,{children:[e.jsxs(Be,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5 text-primary"}),c("modal.assignment.title")]}),e.jsx(ms,{children:c("modal.assignment.description")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[x&&e.jsxs("div",{className:"rounded-lg border bg-secondary/30 overflow-hidden",children:[e.jsxs("button",{onClick:()=>J(!q),className:"w-full p-4 flex items-center justify-between hover:bg-secondary/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center shrink-0",children:e.jsx(tt,{brand:x.brand,size:"md",className:"text-primary"})}),e.jsxs("div",{className:"text-left",children:[e.jsxs("h4",{className:"font-semibold",children:[x.year," ",x.brand," ",x.model]}),e.jsx("p",{className:"text-sm text-muted-foreground font-mono",children:x.licensePlate})]})]}),q?e.jsx(et,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(at,{className:"h-5 w-5 text-muted-foreground"})]}),q&&e.jsx("div",{className:"px-4 pb-4 pt-0 border-t bg-secondary/20 animate-fade-in",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:c("vehicle.brand")}),e.jsx("p",{className:"font-medium",children:x.brand})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:c("vehicle.model")}),e.jsx("p",{className:"font-medium",children:x.model})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:c("vehicle.year")}),e.jsx("p",{className:"font-medium",children:x.year})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:c("vehicle.licensePlate")}),e.jsx("p",{className:"font-medium font-mono",children:x.licensePlate})]}),x.vin&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"VIN"}),e.jsx("p",{className:"font-medium font-mono text-sm",children:x.vin})]}),x.color&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:c("vehicle.color")}),e.jsx("p",{className:"font-medium",children:x.color})]}),r.mileage&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Kilometers"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(ss,{className:"h-3.5 w-3.5"}),r.mileage.toLocaleString()," km"]})]})]})})]}),e.jsx("div",{className:"rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[!C&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-full bg-muted p-2",children:e.jsx(cs,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:r.customerName}),e.jsxs("a",{href:`tel:${r.customerPhone}`,className:"flex items-center gap-1 text-sm text-primary",children:[e.jsx(rt,{className:"h-3 w-3"}),r.customerPhone]})]})]}),C&&e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:c("modal.assignment.jobDetails")})}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[r.serviceType&&e.jsxs(k,{variant:"outline",className:"gap-1 text-xs",children:[e.jsx(R,{className:"h-3 w-3"}),L[r.serviceType]]}),e.jsx(k,{className:D("text-xs",h[r.priority].class),children:h[r.priority].label})]})]})}),e.jsx("div",{className:"rounded-lg border border-destructive/20 bg-destructive/5 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(we,{className:"h-5 w-5 text-destructive shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-destructive mb-1",children:c("jobs.problemDescription")}),e.jsx("p",{className:"text-sm text-foreground",children:Te(r,a)})]})]})}),e.jsxs("div",{className:"rounded-lg border bg-gradient-to-br from-primary/5 to-primary/10 p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-5 w-5 text-primary"}),e.jsx("h4",{className:"font-semibold text-primary",children:c("modal.assignment.aiSuggestions")})]}),y?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Dt,{className:"h-4 w-4 animate-spin"}),c("modal.assignment.aiAnalyzing")]}),e.jsx(is,{className:"h-4 w-full"}),e.jsx(is,{className:"h-4 w-3/4"}),e.jsx(is,{className:"h-4 w-5/6"})]}):f?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium",children:[c("modal.assignment.difficulty"),":"]}),e.jsx(k,{className:w[f.estimatedDifficulty].class,children:w[f.estimatedDifficulty].label})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium mb-2 flex items-center gap-1.5",children:[e.jsx(ue,{className:"h-4 w-4 text-amber-500"}),c("modal.assignment.possibleCauses")]}),e.jsx("ul",{className:"space-y-1.5",children:f.possibleCauses.map((S,M)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-amber-500 mt-1.5 shrink-0"}),e.jsx("span",{children:S})]},M))})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium mb-2 flex items-center gap-1.5",children:[e.jsx(us,{className:"h-4 w-4 text-primary"}),c("modal.assignment.suggestedActions")]}),e.jsx("ul",{className:"space-y-1.5",children:f.suggestedActions.map((S,M)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(ie,{className:"h-4 w-4 text-primary shrink-0 mt-0.5"}),e.jsx("span",{children:S})]},M))})]}),f.warningNotes&&e.jsx("div",{className:"rounded-md bg-amber-500/10 border border-amber-500/20 p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(we,{className:"h-4 w-4 text-amber-600 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-amber-700 mb-0.5",children:c("modal.assignment.warning")}),e.jsx("p",{className:"text-sm text-amber-600",children:f.warningNotes})]})]})})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:c("modal.assignment.aiUnavailable")})]}),r.scheduledDate&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(es,{className:"h-4 w-4"}),e.jsxs("span",{children:[c("modal.assignment.scheduled"),": ",new Date(r.scheduledDate).toLocaleDateString()]})]})]}),e.jsxs(st,{children:[e.jsx(j,{variant:"outline",onClick:()=>o(!1),children:c("common.cancel")}),e.jsxs(j,{onClick:d,className:"gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),c("modal.assignment.startWorking")]})]})]})})}const ma=["brakes","fluids","electrical","air_system","gauges","transmission","suspension","body","lighting","cooling","engine","drivetrain","audio","wheels","accessories"],Ye={brakes:ct,fluids:ot,electrical:xs,air_system:ht,gauges:ss,transmission:it,suspension:dt,body:Ys,lighting:us,cooling:ut,engine:R,drivetrain:lt,audio:xt,wheels:nt,accessories:I};function xa({open:p,onOpenChange:o,onComplete:r,existingParts:x=[]}){const{t:d}=oe(),[c,a]=g.useState(1),[t,C]=g.useState([]),[f,H]=g.useState({}),y=x.map(h=>h.categoryId),W=h=>{y.includes(h)||C(w=>w.includes(h)?w.filter(S=>S!==h):[...w,h])},q=()=>{const h=t.map(w=>({categoryId:w,status:f[w]||"order"}));a(1),C([]),H({}),r({partsNeeded:h})},J=h=>{h||(a(1),C([]),H({})),o(h)},L=h=>d(`modal.parts.category.${h}`);return e.jsx(Re,{open:p,onOpenChange:J,children:e.jsxs(_e,{className:"sm:max-w-xl",children:[e.jsxs($e,{children:[e.jsxs(Be,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5 text-primary"}),d("modal.parts.title")]}),e.jsxs(ms,{children:[c===1&&d("modal.parts.step1"),c===2&&d("modal.parts.step2"),c===3&&d("modal.parts.step3")]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 py-2",children:[1,2,3].map(h=>e.jsx("div",{className:D("h-2 w-16 rounded-full transition-colors",h<=c?"bg-primary":"bg-muted")},h))}),c===1&&e.jsxs("div",{className:"py-4",children:[x.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mb-3 text-center",children:[x.length," ",x.length===1?"part":"parts"," already added (grayed out)"]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 sm:max-h-[400px] sm:overflow-y-auto pr-2",children:ma.map(h=>{const w=t.includes(h),S=y.includes(h),M=Ye[h];return e.jsxs("div",{role:"button",tabIndex:S?-1:0,"aria-disabled":S,onPointerUp:A=>{A.preventDefault(),S||W(h)},className:D("relative flex flex-col items-center gap-2 p-3 rounded-lg border-2 transition-all touch-manipulation select-none cursor-pointer",S?"border-border bg-muted/50 opacity-60 pointer-events-none":w?"border-primary bg-primary/10":"border-border hover:border-primary/50 bg-card active:bg-muted"),children:[e.jsx("div",{className:D("p-2 rounded-full transition-colors",S?"bg-muted":w?"bg-primary text-primary-foreground":"bg-muted"),children:e.jsx(M,{className:"h-5 w-5"})}),e.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:L(h)}),S&&e.jsx(K,{className:"h-4 w-4 text-green-600 absolute top-1 right-1"}),!S&&w&&e.jsx(K,{className:"h-4 w-4 text-primary absolute top-1 right-1"})]},h)})})]}),c===2&&e.jsxs("div",{className:"py-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4 text-center",children:"For each part category, select whether it needs to be ordered or is in stock"}),e.jsx("div",{className:"space-y-3 sm:max-h-[400px] sm:overflow-y-auto pr-2",children:t.map(h=>{const w=Ye[h],S=f[h];return e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border-2 border-border bg-card",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-primary/10",children:e.jsx(w,{className:"h-5 w-5 text-primary"})}),e.jsx("span",{className:"font-medium",children:L(h)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{role:"button",tabIndex:0,onPointerUp:M=>{M.preventDefault(),H(A=>({...A,[h]:"order"}))},className:D("flex items-center gap-2 px-4 py-2 rounded-lg border-2 transition-all touch-manipulation select-none cursor-pointer",S==="order"?"border-amber-500 bg-amber-500/10 text-amber-700":"border-border hover:border-amber-500/50 active:bg-amber-500/5"),children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Order"})]}),e.jsxs("div",{role:"button",tabIndex:0,onPointerUp:M=>{M.preventDefault(),H(A=>({...A,[h]:"in_stock"}))},className:D("flex items-center gap-2 px-4 py-2 rounded-lg border-2 transition-all touch-manipulation select-none cursor-pointer",S==="in_stock"?"border-green-500 bg-green-500/10 text-green-700":"border-border hover:border-green-500/50 active:bg-green-500/5"),children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"In Stock"})]})]})]},h)})})]}),c===3&&e.jsxs("div",{className:"py-6 space-y-4",children:[t.filter(h=>f[h]==="order").length>0&&e.jsxs("div",{className:"rounded-lg border border-amber-500/30 bg-amber-500/5 p-4",children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center gap-2 text-amber-700",children:[e.jsx(Ce,{className:"h-4 w-4"}),"Parts to Order (",t.filter(h=>f[h]==="order").length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.filter(h=>f[h]==="order").map(h=>{const w=Ye[h];return w?e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-amber-500/10 text-amber-700 text-sm border border-amber-500/30",children:[e.jsx(w,{className:"h-3.5 w-3.5"}),L(h)]},h):null})})]}),t.filter(h=>f[h]==="in_stock").length>0&&e.jsxs("div",{className:"rounded-lg border border-green-500/30 bg-green-500/5 p-4",children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center gap-2 text-green-700",children:[e.jsx(De,{className:"h-4 w-4"}),"Parts In Stock (",t.filter(h=>f[h]==="in_stock").length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.filter(h=>f[h]==="in_stock").map(h=>{const w=Ye[h];return w?e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-green-500/10 text-green-700 text-sm border border-green-500/30",children:[e.jsx(w,{className:"h-3.5 w-3.5"}),L(h)]},h):null})})]}),e.jsxs("div",{className:"rounded-lg border border-primary/20 bg-primary/5 p-4 text-center",children:[e.jsx(K,{className:"h-8 w-8 text-primary mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:d("modal.parts.readyToSubmit")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Office will be notified about parts that need ordering"})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[c>1?e.jsxs(j,{variant:"outline",onClick:()=>a(c-1),children:[e.jsx(ds,{className:"h-4 w-4 mr-1"}),d("common.back")]}):e.jsx(j,{variant:"outline",onClick:()=>J(!1),children:d("common.cancel")}),c<3?e.jsxs(j,{onClick:()=>a(c+1),disabled:c===1&&t.length===0||c===2&&t.some(h=>!f[h]),children:[d("common.next"),e.jsx(He,{className:"h-4 w-4 ml-1"})]}):e.jsxs(j,{onClick:q,children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),d("modal.parts.submitRequest")]})]})]})})}function ua({onComplete:p,successText:o,successMessage:r}){const[x,d]=g.useState(0);return g.useEffect(()=>{const c=[setTimeout(()=>d(1),100),setTimeout(()=>d(2),600),setTimeout(()=>d(3),1200),setTimeout(()=>d(4),1800),setTimeout(()=>p(),3e3)];return()=>c.forEach(clearTimeout)},[p]),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/95 backdrop-blur-sm",children:e.jsxs("div",{className:"relative flex flex-col items-center",children:[e.jsxs("div",{className:"relative w-48 h-48 mb-8",children:[e.jsx("div",{className:D("absolute inset-0 flex items-center justify-center transition-all duration-500",x>=1?"opacity-100 scale-100":"opacity-0 scale-75"),children:e.jsx($t,{className:"h-24 w-24 text-primary",strokeWidth:1.5})}),e.jsx("div",{className:D("absolute top-4 right-4 transition-all duration-300",x>=2?"opacity-100 rotate-0":"opacity-0 -rotate-45"),children:e.jsx(R,{className:"h-8 w-8 text-amber-500 animate-bounce"})}),e.jsx("div",{className:D("absolute bottom-8 left-4 transition-all duration-300 delay-200",x>=2?"opacity-100 rotate-0":"opacity-0 rotate-45"),children:e.jsx(R,{className:"h-6 w-6 text-amber-500 animate-bounce",style:{animationDelay:"200ms"}})}),x>=3&&e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"absolute top-0 left-1/2 h-6 w-6 text-yellow-400 animate-ping",style:{animationDuration:"1s"}}),e.jsx(Xe,{className:"absolute top-8 right-0 h-5 w-5 text-yellow-400 animate-ping",style:{animationDuration:"1.2s",animationDelay:"200ms"}}),e.jsx(Xe,{className:"absolute bottom-4 left-8 h-4 w-4 text-yellow-400 animate-ping",style:{animationDuration:"0.8s",animationDelay:"400ms"}})]}),e.jsx("div",{className:D("absolute -bottom-4 left-1/2 -translate-x-1/2 transition-all duration-500",x>=4?"opacity-100 scale-100":"opacity-0 scale-0"),children:e.jsx("div",{className:"rounded-full bg-green-500 p-3 shadow-lg shadow-green-500/30",children:e.jsx(ie,{className:"h-8 w-8 text-white"})})})]}),e.jsxs("div",{className:D("text-center transition-all duration-500",x>=4?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2",children:o}),e.jsx("p",{className:"text-muted-foreground",children:r})]})]})})}function ha({open:p,onOpenChange:o,onConfirm:r,job:x}){const{t:d}=oe(),[c,a]=g.useState(!1),[t,C]=g.useState(1),[f,H]=g.useState(""),[y,W]=g.useState([]),[q,J]=g.useState([]);g.useEffect(()=>{var l,b;if(p){C(1),H("");const O=[];(l=x.workOrderData)!=null&&l.findings&&x.workOrderData.findings.length>0?x.workOrderData.findings.forEach(B=>{O.push({id:B.id,description:B.description,fixed:!1,notes:""})}):O.push({id:"problem-desc",description:x.problemDescription,fixed:!1,notes:""}),W(O);const $=[];(b=x.workOrderData)!=null&&b.parts&&x.workOrderData.parts.length>0&&x.workOrderData.parts.forEach(B=>{$.push({id:B.id,partName:B.partName,partNumber:B.partNumber,originalQuantity:B.quantity,confirmedQuantity:B.quantity,removed:!1})}),J($)}},[p,x]);const L=l=>{W(b=>b.map(O=>O.id===l?{...O,fixed:!O.fixed}:O))},h=(l,b)=>{W(O=>O.map($=>$.id===l?{...$,notes:b}:$))},w=(l,b)=>{J(O=>O.map($=>$.id===l?{...$,confirmedQuantity:Math.max(0,b)}:$))},S=l=>{J(b=>b.map(O=>O.id===l?{...O,removed:!O.removed}:O))},M=y.every(l=>l.fixed);y.length>0;const A=q.length>0,U=A?3:2,fe=l=>d(l===1?"modal.completion.faultCheck":l===2&&A?"modal.completion.partsUsed":"modal.completion.confirmStep"),Fe=()=>{C(t===1&&A?2:A?3:2)},Y=()=>{(t===3||t===2&&A)&&C(t-1)},ne=A?t===3:t===2,de=()=>{const l={faultsChecked:y.map(b=>({id:b.id,description:b.description,fixed:b.fixed,notes:b.notes||void 0})),partsConfirmed:q.map(b=>({id:b.id,partName:b.partName,partNumber:b.partNumber,originalQuantity:b.originalQuantity,confirmedQuantity:b.confirmedQuantity,removed:b.removed})),completionNotes:f||void 0};r(l),o(!1),a(!0)},u=()=>{a(!1)};return c?e.jsx(ua,{onComplete:u,successText:d("modal.completion.success"),successMessage:d("modal.completion.successMessage")}):e.jsx(Re,{open:p,onOpenChange:o,children:e.jsxs(_e,{className:"sm:max-w-lg max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs($e,{children:[e.jsxs(Be,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5 text-green-500"}),d("modal.completion.complete")]}),e.jsxs(ms,{children:[d("modal.completion.stepOf").replace("{step}",String(t)).replace("{total}",String(U)),": ",fe(t)]})]}),e.jsx("div",{className:"flex gap-1 px-1",children:Array.from({length:U},(l,b)=>e.jsx("div",{className:D("h-1.5 flex-1 rounded-full transition-colors",b<t?"bg-green-500":"bg-muted")},b))}),e.jsxs(St,{className:"flex-1 max-h-[50vh]",children:[t===1&&e.jsxs("div",{className:"space-y-4 p-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ia,{className:"h-4 w-4 text-amber-500"}),d("modal.completion.haveFaultsFixed")]}),e.jsx("div",{className:"space-y-3",children:y.map(l=>e.jsx("div",{className:D("p-3 rounded-lg border-2 transition-all",l.fixed?"border-green-500/50 bg-green-50 dark:bg-green-950/20":"border-border bg-card"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("button",{onClick:()=>L(l.id),className:D("mt-0.5 h-5 w-5 rounded border-2 flex items-center justify-center shrink-0 transition-colors",l.fixed?"bg-green-500 border-green-500 text-white":"border-muted-foreground/40"),children:l.fixed&&e.jsx(ie,{className:"h-3 w-3"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:D("text-sm",l.fixed&&"line-through text-muted-foreground"),children:l.description}),!l.fixed&&e.jsx(V,{placeholder:d("modal.completion.addNoteOptional"),value:l.notes,onChange:b=>h(l.id,b.target.value),className:"mt-2 h-8 text-xs"})]})]})},l.id))}),!M&&y.length>1&&e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-amber-50 dark:bg-amber-950/20 border border-amber-200 dark:border-amber-800",children:[e.jsx(ue,{className:"h-4 w-4 text-amber-600 shrink-0"}),e.jsx("p",{className:"text-xs text-amber-700 dark:text-amber-400",children:d("modal.completion.faultsNotFixed").replace("{count}",String(y.filter(l=>!l.fixed).length))})]})]}),t===2&&A&&e.jsxs("div",{className:"space-y-4 p-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(I,{className:"h-4 w-4 text-blue-500"}),d("modal.completion.confirmPartsUsed")]}),e.jsx("div",{className:"space-y-3",children:q.map(l=>e.jsxs("div",{className:D("p-3 rounded-lg border transition-all",l.removed?"border-red-200 bg-red-50/50 dark:bg-red-950/10 opacity-60":"border-border bg-card"),children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:D("font-medium text-sm",l.removed&&"line-through text-muted-foreground"),children:l.partName}),l.partNumber&&e.jsx("p",{className:"text-xs text-muted-foreground",children:l.partNumber})]}),!l.removed&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>w(l.id,l.confirmedQuantity-1),children:e.jsx(mt,{className:"h-3 w-3"})}),e.jsx(V,{type:"number",min:0,value:l.confirmedQuantity,onChange:b=>w(l.id,Number(b.target.value)),className:"w-16 h-7 text-center text-sm"}),e.jsx(j,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>w(l.id,l.confirmedQuantity+1),children:e.jsx(ce,{className:"h-3 w-3"})})]}),e.jsx(j,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>S(l.id),children:l.removed?e.jsx(ce,{className:"h-3 w-3 text-green-600"}):e.jsx(Ae,{className:"h-3 w-3 text-destructive"})})]}),l.confirmedQuantity!==l.originalQuantity&&!l.removed&&e.jsx("p",{className:"text-xs text-amber-600 mt-1",children:d("modal.completion.changedQuantity").replace("{original}",String(l.originalQuantity)).replace("{confirmed}",String(l.confirmedQuantity))})]},l.id))}),q.some(l=>l.removed)&&e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-amber-50 dark:bg-amber-950/20 border border-amber-200 dark:border-amber-800",children:[e.jsx(ue,{className:"h-4 w-4 text-amber-600 shrink-0"}),e.jsx("p",{className:"text-xs text-amber-700 dark:text-amber-400",children:d("modal.completion.partsNotUsed").replace("{count}",String(q.filter(l=>l.removed).length))})]})]}),ne&&e.jsxs("div",{className:"space-y-4 p-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ie,{className:"h-4 w-4 text-green-500"}),d("modal.completion.reviewConfirm")]}),e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50 space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground uppercase",children:d("modal.completion.faults")}),y.map(l=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[l.fixed?e.jsx(ie,{className:"h-3.5 w-3.5 text-green-500 shrink-0"}):e.jsx(ue,{className:"h-3.5 w-3.5 text-amber-500 shrink-0"}),e.jsxs("span",{className:D(!l.fixed&&"text-amber-700 dark:text-amber-400"),children:[l.description,!l.fixed&&` ${d("modal.completion.notFixed")}`]})]},l.id))]}),A&&e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50 space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground uppercase",children:d("modal.completion.partsUsed")}),q.filter(l=>!l.removed).map(l=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:l.partName}),e.jsxs(k,{variant:"secondary",className:"text-xs",children:["x",l.confirmedQuantity,l.confirmedQuantity!==l.originalQuantity&&e.jsxs("span",{className:"text-amber-600 ml-1",children:["(was ",l.originalQuantity,")"]})]})]},l.id)),q.filter(l=>l.removed).map(l=>e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground line-through",children:[e.jsx("span",{children:l.partName}),e.jsx(k,{variant:"outline",className:"text-xs",children:d("modal.completion.removed")})]},l.id))]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground uppercase mb-2",children:d("modal.completion.additionalNotes")}),e.jsx(ze,{value:f,onChange:l=>H(l.target.value),placeholder:d("modal.completion.notesPlaceholder"),className:"h-20 text-sm"})]})]})]}),e.jsxs(st,{className:"flex-row justify-between gap-2 pt-2 border-t",children:[e.jsx("div",{children:t>1&&e.jsxs(j,{variant:"outline",onClick:Y,size:"sm",children:[e.jsx(ds,{className:"h-4 w-4 mr-1"}),d("modal.completion.back")]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{variant:"outline",onClick:()=>o(!1),size:"sm",children:d("modal.completion.cancel")}),ne?e.jsxs(j,{onClick:de,className:"bg-green-600 hover:bg-green-700",size:"sm",children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),d("modal.completion.complete")]}):e.jsxs(j,{onClick:Fe,size:"sm",children:[d("modal.completion.next"),e.jsx(He,{className:"h-4 w-4 ml-1"})]})]})]})]})})}const Ks={brakes:ct,fluids:ot,electrical:xs,air_system:ht,gauges:ss,transmission:it,suspension:dt,body:Ys,lighting:us,cooling:ut,engine:R,drivetrain:lt,audio:xt,wheels:nt,accessories:I};function pa({partsNeeded:p,onAddMoreParts:o}){const{t:r}=oe(),x=a=>r(`modal.parts.category.${a}`),d=p.filter(a=>a.status==="order"),c=p.filter(a=>a.status==="in_stock");return e.jsxs(T,{className:"glass-strong border-0 shadow-premium-lg overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 gradient-royal-radial opacity-5 pointer-events-none"}),e.jsx(se,{className:"pb-3 relative border-b border-border/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(re,{className:"text-base flex items-center gap-2 font-semibold",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-500/10",children:e.jsx(I,{className:"h-5 w-5 text-amber-500"})}),r("modal.parts.title")," (",p.length,")"]}),o&&e.jsxs(j,{variant:"outline",size:"sm",onClick:o,className:"relative z-10 h-8 text-xs",children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),"Add More"]})]})}),e.jsxs(F,{className:"space-y-4 pt-4 relative",children:[d.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl border-2 border-amber-500/30 bg-amber-500/5",children:[e.jsx("div",{className:"p-2 rounded-full bg-amber-500/10",children:e.jsx(Ce,{className:"h-5 w-5 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm text-amber-700",children:r("modal.parts.orderRequired")}),e.jsxs("p",{className:"text-xs text-amber-600",children:[d.length," ",d.length===1?"part":"parts"," need ordering"]})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:d.map(a=>{const t=Ks[a.categoryId]||I;return e.jsxs("div",{className:"flex flex-col items-center gap-2 p-3 rounded-lg border-2 border-amber-500/30 bg-amber-500/5",children:[e.jsx("div",{className:"p-2 rounded-full bg-amber-500/10",children:e.jsx(t,{className:"h-4 w-4 text-amber-600"})}),e.jsx("span",{className:"text-xs font-medium text-center leading-tight text-amber-700",children:x(a.categoryId)})]},a.categoryId)})})]}),c.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl border-2 border-green-500/30 bg-green-500/5",children:[e.jsx("div",{className:"p-2 rounded-full bg-green-500/10",children:e.jsx(De,{className:"h-5 w-5 text-green-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm text-green-700",children:r("modal.parts.inStock")}),e.jsxs("p",{className:"text-xs text-green-600",children:[c.length," ",c.length===1?"part is":"parts are"," available"]})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:c.map(a=>{const t=Ks[a.categoryId]||I;return e.jsxs("div",{className:"flex flex-col items-center gap-2 p-3 rounded-lg border-2 border-green-500/30 bg-green-500/5",children:[e.jsx("div",{className:"p-2 rounded-full bg-green-500/10",children:e.jsx(t,{className:"h-4 w-4 text-green-600"})}),e.jsx("span",{className:"text-xs font-medium text-center leading-tight text-green-700",children:x(a.categoryId)})]},a.categoryId)})})]})]})]})}const ga=(p,o)=>{if(!p||!o)return"N/A";const r=new Date(p),d=new Date(o).getTime()-r.getTime(),c=Math.floor(d/(1e3*60*60)),a=Math.floor(d%(1e3*60*60)/(1e3*60));return c>0?`${c}h ${a}m`:`${a}m`};function fa({job:p,vehicle:o,mechanic:r,creator:x,isMechanic:d=!1}){var t,C;const{t:c,language:a}=oe();return ga(p.assignedAt,p.completedAt),(t=p.partsNeeded)!=null&&t.filter(f=>f.status==="order"),(C=p.partsNeeded)!=null&&C.filter(f=>f.status==="in_stock"),e.jsx("div",{className:"space-y-6 animate-fade-in",children:e.jsxs(T,{className:"glass-strong border-0 overflow-hidden relative",children:[e.jsx("div",{className:"absolute inset-0 gradient-gold-radial opacity-10 pointer-events-none"}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 gradient-gold"}),e.jsx(F,{className:"pt-8 pb-6 relative",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 flex items-center justify-center mx-auto mb-4 animate-scale-in",children:e.jsx("img",{src:"/celebration.gif",alt:c("jobDetail.celebration"),className:"w-20 h-20 object-contain"})}),e.jsx("h2",{className:"text-3xl font-bold text-gradient-gold mb-2",children:c("jobs.completed.title")}),e.jsx("p",{className:"text-muted-foreground",children:c("jobs.completed.subtitle")})]})})]})})}function ja({open:p,onClose:o,job:r,onSave:x,onProcessQuote:d}){const{user:c}=os(),{t:a,language:t}=oe(),C=(c==null?void 0:c.role)==="mechanic",f=C?[{id:1,label:a("wo.header"),icon:R},{id:2,label:a("wo.findings"),icon:ue},{id:3,label:a("wo.workRequired"),icon:ye},{id:4,label:a("wo.parts"),icon:I},{id:5,label:a("wo.summary"),icon:K}]:[{id:1,label:a("wo.header"),icon:R},{id:2,label:a("wo.findings"),icon:ue},{id:3,label:a("wo.workRequired"),icon:ye},{id:4,label:a("wo.parts"),icon:I},{id:5,label:a("wo.summary"),icon:K},{id:6,label:a("wo.quote"),icon:ke}],H=f.length,[y,W]=g.useState(1),[q,J]=g.useState(!1),[L,h]=g.useState([]),[w,S]=g.useState([]),[M,A]=g.useState(""),[U,fe]=g.useState(""),[Fe,Y]=g.useState(!1),[ne,de]=g.useState("catalog"),[u,l]=g.useState(()=>{const s={department:"",date:new Date().toISOString().split("T")[0],vehiclePlate:r.vehicleLicensePlate||"",vehicleMake:r.vehicleBrand||"",vehicleModel:r.vehicleModel||"",mileage:r.mileage,mechanicName:(c==null?void 0:c.fullName)||"",mechanicId:c==null?void 0:c.id,workItems:[],findings:[],parts:[],urgencyPercent:r.priority==="urgent"?100:r.priority==="normal"?50:25,laborSubtotal:0,partsSubtotal:0,discountPercent:0,grandTotal:0};return r.workOrderData?{...s,...r.workOrderData}:s});g.useEffect(()=>{if(!p)return;(async()=>{try{const[i,m,N]=await Promise.all([Yt(),Et(),ea()]);h(i),S(m),N!=null&&N.companyName&&!u.department&&l(he=>({...he,department:N.companyName}))}catch(i){console.error("Error loading data:",i)}})()},[p]);const b=g.useMemo(()=>{const s=u.workItems.reduce((he,xe)=>xe.fixedPrice!=null?he+xe.fixedPrice:he+xe.durationHours*(xe.pricePerHour||0),0),i=u.parts.reduce((he,xe)=>he+xe.quantity*xe.unitPrice,0),m=s+i,N=m*(u.discountPercent/100);return{laborSubtotal:s,partsSubtotal:i,grandTotal:m-N}},[u.workItems,u.parts,u.discountPercent]),O=g.useMemo(()=>u.workItems.reduce((s,i)=>s+i.durationHours,0),[u.workItems]),$=g.useMemo(()=>{if(!M)return L;const s=M.toLowerCase();return L.filter(i=>i.name.toLowerCase().includes(s)||i.serviceCode.toLowerCase().includes(s)||i.category.toLowerCase().includes(s))},[L,M]),B=g.useMemo(()=>{if(!U)return w;const s=U.toLowerCase();return w.filter(i=>{var m;return i.name.toLowerCase().includes(s)||i.partNumber.toLowerCase().includes(s)||((m=i.category)==null?void 0:m.toLowerCase().includes(s))})},[w,U]),ts=s=>{if(u.workItems.find(m=>m.serviceId===s.id)){Ke.info("Service already added");return}const i={id:crypto.randomUUID(),serviceId:s.id,serviceName:s.name,serviceCode:s.serviceCode,description:s.description||s.name,isImmediate:!1,isCustom:!1,durationHours:s.estimatedDuration||1,pricePerHour:s.hourlyRate,fixedPrice:s.pricingType==="fixed"?s.fixedPrice:void 0};l(m=>({...m,workItems:[...m.workItems,i]}))},je=s=>{const i={id:crypto.randomUUID(),serviceName:s||"",description:"",isImmediate:!1,isCustom:!0,durationHours:1};l(m=>({...m,workItems:[...m.workItems,i]})),s&&A("")},Ne=(s,i)=>{l(m=>({...m,workItems:m.workItems.map(N=>N.id===s?{...N,...i}:N)}))},qe=s=>{l(i=>({...i,workItems:i.workItems.filter(m=>m.id!==s)}))},[Qe,le]=g.useState(""),Se=g.useRef(null),Le=[{key:"wo.findingBrakePads",en:"Brake pads worn"},{key:"wo.findingOilLeak",en:"Oil leak detected"},{key:"wo.findingTireTread",en:"Tire tread low"},{key:"wo.findingBattery",en:"Battery weak"},{key:"wo.findingBelt",en:"Belt cracked"},{key:"wo.findingFluid",en:"Fluid levels low"},{key:"wo.findingSuspension",en:"Suspension noise"},{key:"wo.findingExhaust",en:"Exhaust leak"},{key:"wo.findingFilter",en:"Filter clogged"},{key:"wo.findingCorrosion",en:"Corrosion found"}],Pe=s=>{const i={id:crypto.randomUUID(),description:s||"",requiresReplacement:!1,inStock:!0};l(m=>({...m,findings:[...m.findings,i]}))},Ee=()=>{var i;const s=Qe.trim();s&&(Pe(s),le(""),(i=Se.current)==null||i.focus())},be=(s,i)=>{l(m=>({...m,findings:m.findings.map(N=>N.id===s?{...N,...i}:N)}))},Ve=s=>{l(i=>({...i,findings:i.findings.filter(m=>m.id!==s)}))},We=s=>{if(u.parts.find(m=>m.partId===s.id)){Ke.info("Part already added");return}const i={id:crypto.randomUUID(),partId:s.id,partName:s.name,partNumber:s.partNumber,description:s.description||s.name,quantity:1,unitPrice:s.sellingPrice,isCustom:!1,needsOrdering:s.stockQuantity<=0};l(m=>({...m,parts:[...m.parts,i]}))},ve=s=>{const i={id:crypto.randomUUID(),partName:s||"",description:"",quantity:1,unitPrice:0,isCustom:!0,needsOrdering:!0};l(m=>({...m,parts:[...m.parts,i]})),s&&fe("")},X=(s,i)=>{l(m=>({...m,parts:m.parts.map(N=>N.id===s?{...N,...i}:N)}))},Ie=s=>{l(i=>({...i,parts:i.parts.filter(m=>m.id!==s)}))},te=s=>{const i=new Date;i.setHours(i.getHours()+s);const m=new Date(i.getTime()-i.getTimezoneOffset()*6e4).toISOString().slice(0,16);l(N=>({...N,returnTime:m}))},me=()=>{const s=new Date;s.setDate(s.getDate()+1),s.setHours(9,0,0,0);const i=new Date(s.getTime()-s.getTimezoneOffset()*6e4).toISOString().slice(0,16);l(m=>({...m,returnTime:i}))},Ue=async()=>{if(!(c!=null&&c.id))return;const s=20,i=u.workItems.filter(N=>N.isCustom&&N.serviceName.trim()).map(N=>Xt({serviceCode:N.serviceCode||"",name:N.serviceName.trim(),description:N.description||"",category:"custom",pricingType:"hourly",hourlyRate:N.pricePerHour||0,fixedPrice:N.fixedPrice,estimatedDuration:N.durationHours||1,taxRate:s,skillLevel:"junior",includesParts:!1,isActive:!0},c.id).catch(()=>{})),m=u.parts.filter(N=>N.isCustom&&N.partName.trim()).map(N=>zt({partNumber:N.partNumber||"",name:N.partName.trim(),description:N.description||"",category:"custom",stockQuantity:0,minStockLevel:1,maxStockLevel:10,unit:"piece",costPrice:0,sellingPrice:N.unitPrice||0,markup:0,taxRate:s,isActive:!0},c.id).catch(()=>{}));await Promise.all([...i,...m])},as=async()=>{J(!0);try{const s={...u,...b,completedAt:new Date().toISOString()};await Ue(),await x(s),Y(!1),Ke.success("Work order saved"),o()}catch(s){console.error("Error saving:",s),Ke.error("Failed to save work order")}finally{J(!1)}},rs=()=>{if(y===H){Y(!0);return}W(s=>Math.min(s+1,H))},Je=()=>W(s=>Math.max(s-1,1)),Ge=s=>s?w.find(i=>i.id===s):null;return e.jsxs(e.Fragment,{children:[e.jsx(Re,{open:p,onOpenChange:o,children:e.jsxs(_e,{className:"max-w-4xl max-h-[90vh] flex flex-col p-0 overflow-hidden",children:[e.jsx($e,{className:"px-6 pt-6 pb-0",children:e.jsxs(Be,{className:"text-xl",children:["Work Order — ",u.vehiclePlate]})}),e.jsx("div",{className:"px-6 py-3 border-b overflow-x-auto",children:e.jsx("div",{className:"flex items-center gap-1",children:f.map((s,i)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("button",{onClick:()=>W(s.id),className:D("flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium transition-colors whitespace-nowrap",y===s.id?"bg-primary text-primary-foreground":y>s.id?"bg-primary/20 text-primary":"bg-muted text-muted-foreground"),children:[e.jsx(s.icon,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:s.label}),e.jsx("span",{className:"sm:hidden",children:s.id})]}),i<f.length-1&&e.jsx(He,{className:"h-4 w-4 text-muted-foreground mx-1"})]},s.id))})}),e.jsxs("div",{className:"flex-1 overflow-y-auto overscroll-contain px-6 py-4",style:{WebkitOverflowScrolling:"touch"},children:[y===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(ae,{className:"text-xs text-muted-foreground",children:a("wo.department")}),e.jsx("p",{className:"font-medium",children:u.department||"—"})]}),e.jsxs("div",{children:[e.jsx(ae,{className:"text-xs text-muted-foreground",children:a("wo.date")}),e.jsx("p",{className:"font-medium",children:new Date(u.date).toLocaleDateString("en-GB")})]})]}),e.jsx(z,{}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(ae,{className:"text-xs text-muted-foreground",children:a("wo.registration")}),e.jsx("p",{className:"font-mono font-bold text-lg",children:u.vehiclePlate})]}),e.jsxs("div",{children:[e.jsx(ae,{className:"text-xs text-muted-foreground",children:a("wo.vehicle")}),e.jsxs("p",{className:"font-medium",children:[u.vehicleMake," ",u.vehicleModel]})]}),e.jsxs("div",{children:[e.jsx(ae,{className:"text-xs text-muted-foreground",children:a("wo.kilometers")}),e.jsx("p",{className:"font-medium",children:u.mileage?`${u.mileage.toLocaleString()} km`:"—"})]})]}),e.jsx(z,{}),e.jsxs("div",{children:[e.jsx(ae,{className:"text-xs text-muted-foreground",children:a("wo.mechanic")}),e.jsx("p",{className:"font-medium",children:u.mechanicName})]}),r.problemDescription&&e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsxs("div",{children:[e.jsx(ae,{className:"text-xs text-muted-foreground",children:a("wo.bookingDescription")}),e.jsx("p",{className:"text-sm mt-1",children:Te(r,t)})]})]})]}),y===3&&e.jsxs("div",{className:"space-y-4",children:[r.problemDescription&&e.jsx(T,{className:"border-blue-200 bg-blue-50/50 dark:border-blue-800 dark:bg-blue-950/20",children:e.jsxs(F,{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ca,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"}),e.jsx("h4",{className:"font-semibold text-sm text-blue-900 dark:text-blue-100",children:a("wo.customerReportedIssue")})]}),e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:Te(r,t)})]})}),r.partsNeeded&&r.partsNeeded.length>0&&e.jsx(T,{className:"border-amber-200 bg-amber-50/50 dark:border-amber-800 dark:bg-amber-950/20",children:e.jsxs(F,{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(I,{className:"h-4 w-4 text-amber-600 dark:text-amber-400"}),e.jsx("h4",{className:"font-semibold text-sm text-amber-900 dark:text-amber-100",children:a("wo.faultCategories")})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.partsNeeded.map((s,i)=>e.jsx(k,{variant:"outline",className:"text-xs bg-white dark:bg-slate-900",children:a(`modal.parts.category.${s.categoryId}`)},i))})]})}),e.jsx(z,{}),e.jsxs("div",{className:"relative",children:[e.jsx(ns,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:a("wo.searchServices"),value:M,onChange:s=>A(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:max-h-48 sm:overflow-y-auto border rounded-lg p-2",children:[$.map(s=>{var m;const i=u.workItems.some(N=>N.serviceId===s.id);return e.jsxs("div",{role:"button",tabIndex:i?-1:0,"aria-disabled":i,onClick:()=>{i||ts(s)},className:D("flex items-center gap-2 p-2 rounded-lg text-left text-sm transition-colors select-none cursor-pointer",i?"bg-primary/10 border border-primary/30 opacity-60 pointer-events-none":"hover:bg-muted border border-transparent active:bg-muted"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:C?`${s.estimatedDuration||"?"}h est.`:e.jsxs(e.Fragment,{children:[s.pricingType==="fixed"?`€${(m=s.fixedPrice)==null?void 0:m.toFixed(2)}`:`€${s.hourlyRate}/h`," · ",s.estimatedDuration||"?","h"]})})]}),i?e.jsx(K,{className:"h-4 w-4 text-primary shrink-0"}):e.jsx(ce,{className:"h-4 w-4 text-muted-foreground shrink-0"})]},s.id)}),$.length===0&&M.trim()&&e.jsxs("div",{className:"col-span-2 text-center py-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:a("wo.noServicesFound")}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>je(M.trim()),children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),a("wo.addAsCustom").replace("{name}",M.trim())]})]}),$.length===0&&!M.trim()&&e.jsx("p",{className:"col-span-2 text-center text-sm text-muted-foreground py-4",children:a("wo.noServicesFound")})]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>je(),className:"w-full",children:[e.jsx(Gs,{className:"h-4 w-4 mr-2"}),a("wo.addCustomService")]}),e.jsx(z,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium text-sm",children:[a("wo.selectedServices")," (",u.workItems.length,")"]}),u.workItems.length===0?e.jsx("p",{className:"text-center text-sm text-muted-foreground py-6",children:a("wo.selectServicesHint")}):u.workItems.map(s=>e.jsx(T,{children:e.jsx(F,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[s.isCustom?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{placeholder:a("wo.referenceOptional"),value:s.serviceCode||"",onChange:i=>Ne(s.id,{serviceCode:i.target.value}),className:"w-32"}),e.jsx(V,{placeholder:a("wo.serviceName"),value:s.serviceName,onChange:i=>Ne(s.id,{serviceName:i.target.value}),className:"flex-1"})]}),e.jsx(ze,{placeholder:a("wo.description"),value:s.description,onChange:i=>Ne(s.id,{description:i.target.value}),className:"min-h-[60px]"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium",children:s.serviceName}),s.serviceCode&&e.jsx(k,{variant:"outline",className:"text-xs",children:s.serviceCode})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx(V,{type:"number",min:"0.5",step:"0.5",value:s.durationHours||"",onChange:i=>Ne(s.id,{durationHours:Number(i.target.value)}),onFocus:i=>i.target.select(),className:"w-20 h-8"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a("wo.hours")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ws,{checked:s.isImmediate,onCheckedChange:i=>Ne(s.id,{isImmediate:i})}),e.jsx("span",{className:"text-xs",children:a("wo.immediate")})]})]})]}),e.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",onClick:()=>qe(s.id),children:e.jsx(Ae,{className:"h-4 w-4"})})]})})},s.id))]})]}),y===2&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 text-primary"}),a("wo.diagnosticFindings")]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(V,{ref:Se,placeholder:a("wo.typeFinding"),value:Qe,onChange:s=>le(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),Ee())},className:"pr-10 h-[52px] text-base"}),Qe&&e.jsx("button",{onClick:Ee,className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:e.jsx(na,{className:"h-5 w-5"})})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx(xs,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"text-sm text-muted-foreground font-medium",children:a("wo.quickAdd")})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Le.map(s=>{const i=u.findings.some(m=>m.description===a(s.key)||m.description===s.en);return e.jsxs("div",{role:"button",tabIndex:i?-1:0,"aria-disabled":i,onClick:()=>{i||Pe(a(s.key))},className:D("px-3 py-2 rounded-lg text-sm font-medium border transition-colors min-h-[48px] select-none cursor-pointer",i?"bg-primary/10 border-primary/30 text-primary opacity-60 pointer-events-none":"border-border hover:bg-muted hover:border-muted-foreground/30 active:bg-muted"),children:[i?e.jsx(K,{className:"h-4 w-4 inline mr-1.5"}):e.jsx(ce,{className:"h-4 w-4 inline mr-1.5"}),a(s.key)]},s.key)})})]}),e.jsx(z,{}),u.findings.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ue,{className:"h-12 w-12 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a("wo.typeOrTapHint")})]}):e.jsx("div",{className:"space-y-3",children:u.findings.map((s,i)=>e.jsx(T,{className:"min-h-[48px]",children:e.jsx(F,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(k,{variant:"secondary",className:"mt-1 shrink-0 text-sm h-6 px-2",children:["#",i+1]}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-3",children:[e.jsx(ze,{value:s.description,onChange:m=>be(s.id,{description:m.target.value}),placeholder:a("wo.describeFinding"),className:"min-h-[60px] text-base resize-none"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer min-h-[48px] p-2 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsx(Ws,{checked:s.requiresReplacement,onCheckedChange:m=>be(s.id,{requiresReplacement:m})}),e.jsx(I,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:a("wo.requiresReplacement")})]}),s.requiresReplacement&&e.jsxs(Rs,{value:s.inStock===!1?"order":"stock",onValueChange:m=>be(s.id,{inStock:m==="stock"}),className:"flex gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer flex-1 p-3 rounded-lg border min-h-[48px] transition-colors hover:bg-muted/50 has-[:checked]:border-primary has-[:checked]:bg-primary/5",children:[e.jsx(Ze,{value:"stock",id:`${s.id}-stock`}),e.jsx(De,{className:"h-4 w-4 text-green-600 dark:text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:a("wo.inStock")})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer flex-1 p-3 rounded-lg border min-h-[48px] transition-colors hover:bg-muted/50 has-[:checked]:border-primary has-[:checked]:bg-primary/5",children:[e.jsx(Ze,{value:"order",id:`${s.id}-order`}),e.jsx(Ce,{className:"h-4 w-4 text-orange-600 dark:text-orange-500"}),e.jsx("span",{className:"text-sm font-medium",children:a("wo.needsOrdering")})]})]})]})]}),e.jsx(j,{variant:"ghost",size:"icon",className:"h-10 w-10 shrink-0 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>Ve(s.id),children:e.jsx(Ae,{className:"h-4 w-4"})})]})})},s.id))})]}),y===4&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5 text-primary"}),a("wo.partsRequired")]}),e.jsxs("div",{className:"flex gap-2 p-1 bg-muted rounded-lg",children:[e.jsxs("button",{onClick:()=>de("manual"),className:D("flex-1 px-4 py-2 rounded-md text-sm font-medium transition-colors min-h-[48px]",ne==="manual"?"bg-background shadow-sm":"hover:bg-background/50"),children:[e.jsx(Gs,{className:"h-4 w-4 inline mr-2"}),a("wo.manualEntry")]}),e.jsxs("button",{onClick:()=>de("catalog"),className:D("flex-1 px-4 py-2 rounded-md text-sm font-medium transition-colors min-h-[48px]",ne==="catalog"?"bg-background shadow-sm":"hover:bg-background/50"),children:[e.jsx(ns,{className:"h-4 w-4 inline mr-2"}),a("wo.searchCatalog")]})]}),ne==="manual"&&e.jsx(T,{children:e.jsxs(F,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{htmlFor:"manual-part-name",className:"text-sm font-medium",children:a("wo.partName")}),e.jsx(V,{id:"manual-part-name",placeholder:a("wo.enterPartName"),className:"h-[48px] text-base",onKeyDown:s=>{if(s.key==="Enter"){s.preventDefault();const i=s.currentTarget;i.value.trim()&&(ve(i.value.trim()),i.value="")}}})]}),e.jsxs(j,{onClick:s=>{var m;const i=(m=s.currentTarget.parentElement)==null?void 0:m.querySelector("input");i!=null&&i.value.trim()&&(ve(i.value.trim()),i.value="")},className:"w-full h-[48px]",children:[e.jsx(ce,{className:"h-5 w-5 mr-2"}),a("wo.addPart")]})]})}),ne==="catalog"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx(ns,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(V,{placeholder:a("wo.searchPartsCatalog"),value:U,onChange:s=>fe(s.target.value),className:"pl-10 h-[48px] text-base"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:max-h-64 sm:overflow-y-auto border rounded-lg p-2",children:[B.map(s=>{const i=u.parts.some(m=>m.partId===s.id);return e.jsxs("div",{role:"button",tabIndex:i?-1:0,"aria-disabled":i,onPointerUp:m=>{m.preventDefault(),i||We(s)},className:D("flex items-center gap-2 p-3 rounded-lg text-left text-sm transition-colors min-h-[60px] touch-manipulation select-none cursor-pointer",i?"bg-primary/10 border border-primary/30 opacity-60 pointer-events-none":"hover:bg-muted border border-transparent active:bg-muted"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.partNumber,!C&&e.jsxs(e.Fragment,{children:[" · €",s.sellingPrice.toFixed(2)]})," · ",e.jsxs("span",{className:s.stockQuantity>0?"text-green-600":"text-red-500",children:[s.stockQuantity," ",a("wo.inStock").toLowerCase()]})]})]}),i?e.jsx(K,{className:"h-5 w-5 text-primary shrink-0"}):e.jsx(ce,{className:"h-5 w-5 text-muted-foreground shrink-0"})]},s.id)}),B.length===0&&U.trim()&&e.jsxs("div",{className:"col-span-2 text-center py-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:a("wo.noPartsFound")}),e.jsxs(j,{variant:"outline",onClick:()=>{ve(U.trim()),fe("")},className:"h-[48px]",children:[e.jsx(ce,{className:"h-5 w-5 mr-2"}),a("wo.addAsCustom").replace("{name}",U.trim())]})]}),B.length===0&&!U.trim()&&e.jsx("p",{className:"col-span-2 text-center text-sm text-muted-foreground py-8",children:a("wo.noPartsAvailable")})]})]}),e.jsx(z,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),a("wo.partsList")," (",u.parts.length,")"]}),u.parts.length===0?e.jsx(T,{className:"border-dashed",children:e.jsxs(F,{className:"p-8 text-center",children:[e.jsx(I,{className:"h-10 w-10 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a(ne==="manual"?"wo.enterPartDetails":"wo.searchOrSwitch")})]})}):u.parts.map(s=>e.jsx(T,{children:e.jsx(F,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1 space-y-3",children:[s.isCustom?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{placeholder:a("wo.referenceOptional"),value:s.partNumber||"",onChange:i=>X(s.id,{partNumber:i.target.value}),className:"w-32 h-[48px]"}),e.jsx(V,{placeholder:a("wo.partName")+"...",value:s.partName,onChange:i=>X(s.id,{partName:i.target.value}),className:"flex-1 h-[48px] text-base font-medium"})]}),e.jsx(ze,{placeholder:a("wo.notesOptional"),value:s.description,onChange:i=>X(s.id,{description:i.target.value}),className:"min-h-[60px] text-sm resize-none"})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-base",children:s.partName}),s.partNumber&&e.jsx(k,{variant:"outline",className:"text-xs",children:s.partNumber})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"text-sm",children:a("wo.quantity")}),e.jsx(V,{type:"number",min:"1",value:s.quantity||"",onChange:i=>X(s.id,{quantity:Number(i.target.value)}),onFocus:i=>i.target.select(),className:"w-20 h-10 text-base"})]}),!C&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"text-sm",children:a("wo.pricePerUnit")}),e.jsx(V,{type:"number",min:"0",step:"0.01",value:s.unitPrice||"",onChange:i=>X(s.id,{unitPrice:Number(i.target.value)}),onFocus:i=>i.target.select(),className:"w-24 h-10 text-base"})]}),e.jsxs("p",{className:"text-base font-medium ml-auto",children:["€",(s.quantity*s.unitPrice).toFixed(2)]})]}),C&&(()=>{const i=Ge(s.partId);return i?e.jsx(k,{variant:i.stockQuantity>0?"secondary":"destructive",children:i.stockQuantity>0?`${i.stockQuantity} ${a("wo.inStock").toLowerCase()}`:a("wo.outOfStock")}):null})()]}),e.jsxs(Rs,{value:s.needsOrdering?"order":"stock",onValueChange:i=>X(s.id,{needsOrdering:i==="order"}),className:"flex gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer flex-1 p-3 rounded-lg border min-h-[48px] transition-colors hover:bg-muted/50 has-[:checked]:border-primary has-[:checked]:bg-primary/5",children:[e.jsx(Ze,{value:"stock",id:`${s.id}-stock`}),e.jsx(De,{className:"h-4 w-4 text-green-600 dark:text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:a("wo.inStock")})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer flex-1 p-3 rounded-lg border min-h-[48px] transition-colors hover:bg-muted/50 has-[:checked]:border-primary has-[:checked]:bg-primary/5",children:[e.jsx(Ze,{value:"order",id:`${s.id}-order`}),e.jsx(Ce,{className:"h-4 w-4 text-orange-600 dark:text-orange-500"}),e.jsx("span",{className:"text-sm font-medium",children:a("wo.needsOrdering")})]})]})]}),e.jsx(j,{variant:"ghost",size:"icon",className:"h-10 w-10 shrink-0 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>Ie(s.id),children:e.jsx(Ae,{className:"h-4 w-4"})})]})})},s.id))]})]}),y===5&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(T,{children:[e.jsx(se,{className:"pb-3",children:e.jsxs(re,{className:"text-base flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5 text-primary"}),a("wo.services")," (",u.workItems.length,")"]})}),e.jsx(F,{className:"space-y-2",children:u.workItems.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:a("wo.noServicesAdded")}):u.workItems.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(ye,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsx("span",{className:"text-sm truncate",children:s.serviceName||a("wo.customService")}),s.isCustom&&e.jsx(k,{variant:"outline",className:"text-xs shrink-0",children:"Custom"}),s.isImmediate&&e.jsx(k,{variant:"destructive",className:"text-xs shrink-0",children:"Immediate"})]}),e.jsxs("span",{className:"text-sm font-medium text-muted-foreground shrink-0",children:[s.durationHours,"h"]})]},s.id))})]}),e.jsxs(T,{children:[e.jsx(se,{className:"pb-3",children:e.jsxs(re,{className:"text-base flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 text-primary"}),a("wo.findings")," (",u.findings.length,")"]})}),e.jsx(F,{className:"space-y-2",children:u.findings.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:a("wo.noFindings")}):u.findings.map((s,i)=>e.jsxs("div",{className:"flex items-start gap-2 p-2 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs(k,{variant:"secondary",className:"shrink-0 mt-0.5",children:["#",i+1]}),e.jsx("span",{className:"text-sm flex-1",children:s.description||"—"}),e.jsx("div",{className:"flex items-center gap-1 shrink-0",children:s.requiresReplacement&&e.jsxs(e.Fragment,{children:[e.jsxs(k,{variant:"outline",className:"text-xs",children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),"Part"]}),s.inStock===!1?e.jsxs(k,{variant:"outline",className:"text-xs text-orange-600",children:[e.jsx(Ce,{className:"h-3 w-3 mr-1"}),"Order"]}):e.jsxs(k,{variant:"outline",className:"text-xs text-green-600",children:[e.jsx(De,{className:"h-3 w-3 mr-1"}),"Stock"]})]})})]},s.id))})]}),e.jsxs(T,{children:[e.jsx(se,{className:"pb-3",children:e.jsxs(re,{className:"text-base flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5 text-primary"}),a("wo.partsLabel")," (",u.parts.length,")"]})}),e.jsx(F,{className:"space-y-2",children:u.parts.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:a("wo.noPartsAdded")}):u.parts.map(s=>{const i=Ge(s.partId);return e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-muted/50 transition-colors gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(I,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsx("span",{className:"text-sm truncate",children:s.partName||a("wo.customPart")}),e.jsxs("span",{className:"text-sm text-muted-foreground shrink-0",children:["×",s.quantity]})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[s.needsOrdering?e.jsxs(k,{variant:"outline",className:"text-xs text-orange-600",children:[e.jsx(Ce,{className:"h-3 w-3 mr-1"}),"Order"]}):e.jsxs(k,{variant:"outline",className:"text-xs text-green-600",children:[e.jsx(De,{className:"h-3 w-3 mr-1"}),"Stock"]}),C&&i&&i.stockQuantity<=0&&!s.needsOrdering&&e.jsx(k,{variant:"destructive",className:"text-xs",children:"Low"}),!C&&e.jsxs("span",{className:"text-sm font-medium ml-2",children:["€",(s.quantity*s.unitPrice).toFixed(2)]})]})]},s.id)})})]}),e.jsx(z,{}),C?e.jsx("div",{className:"p-3 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:a("wo.totalLaborTime")}),e.jsxs("span",{className:"font-bold",children:[O,"h"]})]})}):e.jsxs("div",{className:"space-y-2 p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:a("wo.labor")}),e.jsxs("span",{children:["€",b.laborSubtotal.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:a("wo.partsLabel")}),e.jsxs("span",{children:["€",b.partsSubtotal.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{children:a("wo.discount")}),e.jsx(V,{type:"number",min:"0",max:"100",value:u.discountPercent||"",onChange:s=>l(i=>({...i,discountPercent:Number(s.target.value)})),onFocus:s=>s.target.select(),className:"w-20 h-7 text-xs"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"%"})]}),e.jsx(z,{}),e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:a("wo.total")}),e.jsxs("span",{children:["€",b.grandTotal.toFixed(2)]})]})]}),e.jsxs("div",{children:[e.jsx(ae,{className:"text-xs text-muted-foreground mb-2 block",children:a("wo.estimatedReturnTime")}),C?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{label:"1h",hours:1},{label:"2h",hours:2},{label:"3h",hours:3},{label:"4h",hours:4}].map(s=>e.jsx(j,{variant:"outline",className:"h-12 text-base font-bold",onClick:()=>te(s.hours),children:s.label},s.label))}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(j,{variant:"outline",className:"h-12 text-sm font-bold",onClick:()=>te(6),children:a("wo.halfDay")}),e.jsx(j,{variant:"outline",className:"h-12 text-sm font-bold",onClick:()=>te(8),children:a("wo.endOfDay")}),e.jsx(j,{variant:"outline",className:"h-12 text-sm font-bold",onClick:me,children:a("wo.tomorrow")})]}),u.returnTime&&e.jsxs("p",{className:"text-sm text-center text-muted-foreground",children:[a("wo.setTo"),": ",e.jsx("span",{className:"font-medium text-foreground",children:new Date(u.returnTime).toLocaleString("en-GB")})]})]}):e.jsx(V,{type:"datetime-local",value:u.returnTime||"",onChange:s=>l(i=>({...i,returnTime:s.target.value}))})]})]}),y===6&&!C&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ke,{className:"h-12 w-12 text-primary mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:a("wo.workOrderComplete")}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md mx-auto",children:a("wo.saveAndQuoteHint")})]}),e.jsxs("div",{className:"space-y-2 p-4 bg-muted/50 rounded-lg max-w-sm mx-auto",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[u.workItems.length," ",a("wo.services")]}),e.jsxs("span",{children:["€",b.laborSubtotal.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[u.parts.length," ",a("wo.partsLabel")]}),e.jsxs("span",{children:["€",b.partsSubtotal.toFixed(2)]})]}),u.discountPercent>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsxs("span",{children:[a("wo.discount")," (",u.discountPercent,"%)"]}),e.jsxs("span",{children:["-€",((b.laborSubtotal+b.partsSubtotal)*u.discountPercent/100).toFixed(2)]})]}),e.jsx(z,{}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:a("wo.total")}),e.jsxs("span",{children:["€",b.grandTotal.toFixed(2)]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 max-w-sm mx-auto",children:[e.jsxs(j,{variant:"outline",className:"h-14",onClick:()=>{Y(!0)},children:[e.jsx(K,{className:"h-5 w-5 mr-2"}),a("wo.saveOnly")]}),e.jsxs(j,{className:"h-14",onClick:()=>{const s={...u,...b,completedAt:new Date().toISOString()};d==null||d(s)},children:[e.jsx(ke,{className:"h-5 w-5 mr-2"}),a("wo.processQuote")]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t bg-background",children:[e.jsx(j,{variant:"outline",onClick:y===1?o:Je,children:y===1?a("wo.cancel"):e.jsxs(e.Fragment,{children:[e.jsx(ds,{className:"h-4 w-4 mr-1"})," ",a("wo.back")]})}),e.jsxs(k,{variant:"secondary",children:[a("wo.step")," ",y," ",a("wo.of")," ",H]}),!(y===6&&!C)&&e.jsx(j,{onClick:rs,children:y===H?e.jsxs(e.Fragment,{children:[a("wo.saveWorkOrder")," ",e.jsx(K,{className:"h-4 w-4 ml-1"})]}):e.jsxs(e.Fragment,{children:[a("wo.next")," ",e.jsx(He,{className:"h-4 w-4 ml-1"})]})}),y===6&&!C&&e.jsx("div",{})]})]})}),e.jsx(Qt,{open:Fe,onOpenChange:Y,children:e.jsxs(Vt,{className:"max-w-lg max-h-[80vh] overflow-y-auto",children:[e.jsxs(Wt,{children:[e.jsx(Ut,{children:a("wo.confirmWorkOrder")}),e.jsx(Jt,{children:a("wo.reviewBeforeSaving")})]}),e.jsxs("div",{className:"space-y-3 my-4",children:[e.jsxs("h4",{className:"font-medium text-sm",children:[a("wo.services")," (",u.workItems.length,")"]}),u.workItems.map(s=>e.jsxs("div",{className:"flex items-center justify-between text-sm border-b pb-2",children:[e.jsxs("span",{children:[s.serviceName||a("wo.custom")," (",s.durationHours,"h)"]}),e.jsx(j,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>qe(s.id),children:e.jsx(Ae,{className:"h-3 w-3"})})]},s.id)),e.jsx(z,{}),e.jsxs("h4",{className:"font-medium text-sm",children:[a("wo.partsLabel")," (",u.parts.length,")"]}),u.parts.map(s=>e.jsxs("div",{className:"flex items-center justify-between text-sm border-b pb-2 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("span",{className:"truncate",children:s.partName||a("wo.custom")}),s.needsOrdering&&e.jsx(k,{variant:"outline",className:"text-[10px] shrink-0 text-orange-600",children:"Order"})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx(j,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-full",onClick:()=>X(s.id,{quantity:Math.max(1,s.quantity-1)}),children:e.jsx(mt,{className:"h-4 w-4"})}),e.jsx("span",{className:"w-8 text-center font-bold text-base",children:s.quantity}),e.jsx(j,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-full",onClick:()=>X(s.id,{quantity:s.quantity+1}),children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"icon",className:"h-7 w-7 ml-1",onClick:()=>Ie(s.id),children:e.jsx(Ae,{className:"h-3.5 w-3.5"})})]})]},s.id)),u.workItems.length===0&&u.parts.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:a("wo.noServicesOrParts")})]}),e.jsxs(Gt,{children:[e.jsx(Zt,{onClick:()=>Y(!1),children:a("wo.goBackEdit")}),e.jsx(Kt,{onClick:as,disabled:q,children:a(q?"wo.saving":"wo.confirmSave")})]})]})})]})}function pt({status:p,size:o="default"}){const{t:r}=oe(),x={not_started:{class:"status-not-started",label:r("jobs.notStarted")},in_progress:{class:"status-in-progress",label:r("jobs.inProgress")},waiting_for_parts:{class:"status-waiting",label:r("jobs.waitingParts")},completed:{class:"status-completed",label:r("jobs.completed")}},{class:d,label:c}=x[p];return e.jsx("span",{className:D(`inline-flex items-center rounded-full font-medium ${d}`,o==="sm"?"px-2 py-0.5 text-xs":"px-3 py-1 text-sm"),children:c})}function gt({serviceType:p}){const{t:o}=oe();if(!p)return null;const r={repair:{icon:R,label:o("serviceType.repair"),color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"},maintenance:{icon:R,label:o("serviceType.maintenance"),color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"},inspection:{icon:ie,label:o("serviceType.inspection"),color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"},diagnostic:{icon:we,label:o("serviceType.diagnostic"),color:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"}},{icon:x,label:d,color:c}=r[p];return e.jsxs("span",{className:D("inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium",c),children:[e.jsx(x,{className:"h-3 w-3"}),d]})}function Na({job:p,isExpanded:o,onToggle:r,userLanguage:x}){const d=Xs(),{t:c}=oe();return e.jsx(T,{className:D("transition-all duration-300 cursor-pointer border-l-4",o?"shadow-lg border-l-primary":"hover:shadow-md border-l-muted-foreground/30"),onClick:r,children:e.jsxs(F,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(es,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm",children:ge(new Date(p.createdAt),"dd/MM/yyyy")}),e.jsx(gt,{serviceType:p.serviceType})]}),e.jsx("p",{className:D("text-sm text-muted-foreground",!o&&"line-clamp-1"),children:Te(p,x)})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[e.jsx(pt,{status:p.status,size:"sm"}),o?e.jsx(et,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(at,{className:"h-4 w-4 text-muted-foreground"})]})]}),o&&e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-3 animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase mb-1",children:c("jobDetail.problemDescription")}),e.jsx("p",{className:"text-sm",children:Te(p,x)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:c("jobDetail.priority")}),e.jsx("span",{className:`font-medium uppercase text-xs priority-${p.priority}`,children:c(`jobs.priority.${p.priority}`)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:c("jobDetail.jobNumber")}),e.jsx("span",{className:"font-mono text-xs",children:p.jobNumber||p.id.slice(0,8)})]}),p.mileage&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:c("jobDetail.kilometers")}),e.jsxs("span",{className:"text-xs",children:[p.mileage.toLocaleString()," km"]})]}),p.completedAt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:c("jobDetail.completed")}),e.jsx("span",{className:"text-xs",children:ge(new Date(p.completedAt),"dd/MM/yyyy")})]})]}),p.faultCategory&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:c("jobDetail.affectedAreas")}),e.jsx("div",{className:"flex flex-wrap gap-1",children:p.faultCategory.split(",").map((a,t)=>e.jsx(k,{variant:"secondary",className:"text-xs",children:c(`modal.parts.category.${a.trim()}`)},t))})]}),e.jsx(j,{variant:"outline",size:"sm",className:"w-full mt-2",onClick:a=>{a.stopPropagation(),d(`/jobs/${p.id}`)},children:c("jobDetail.viewFullDetails")})]})]})})}function sr(){var gs,fs,js,Ns,bs,vs,ys,ws,ks,Cs,Ds,Ss,Ps,Is,Os,Ms,As,Ts,Fs,qs,Ls,Es,zs,Hs;const{jobId:p}=Pt(),{user:o}=os(),{t:r,language:x}=oe(),d=Xs(),[c,a]=g.useState(!1),[t,C]=g.useState(null),[f,H]=g.useState(null),[y,W]=g.useState([]),[q,J]=g.useState(null),[L,h]=g.useState(null),[w,S]=g.useState(!0),[M,A]=g.useState(null),[U,fe]=g.useState(null),[Fe,Y]=g.useState(!1),[ne,de]=g.useState(!1),[u,l]=g.useState(!1),[b,O]=g.useState(!1),[$,B]=g.useState(!1),[ts,je]=g.useState(!1),[Ne,qe]=g.useState(!1),[Qe,le]=g.useState(null),[Se,Le]=g.useState(!1),[Pe,Ee]=g.useState(""),[be,Ve]=g.useState(""),[We,ve]=g.useState(!1),[X,Ie]=g.useState("");if(g.useEffect(()=>{if(!p){A("No job ID provided"),S(!1);return}S(!0),A(null);const n=It(p,async P=>{if(P){C(P);try{const[E,ee]=await Promise.all([Mt(P.vehicleId),Qs(P.createdBy)]);if(H(E),J(ee),P.assignedMechanicId){const Q=await Qs(P.assignedMechanicId);h(Q)}else h(null);if(E){const G=(await At(E.id)).filter(Oe=>Oe.id!==p).sort((Oe,v)=>new Date(v.createdAt).getTime()-new Date(Oe.createdAt).getTime());W(G)}}catch(E){console.error("Error loading related data:",E)}}else A("Job not found");S(!1)});return()=>n()},[p]),w)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:r("common.loading")}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Job ID: ",p]})]})});if(M||!t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-destructive font-semibold",children:M||"Job not found"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Job ID: ",p]}),e.jsx(j,{onClick:()=>d("/jobs"),className:"mt-4",children:"Back to Jobs"})]})});const te=(o==null?void 0:o.role)==="mechanic",me=(o==null?void 0:o.role)==="office_staff"||(o==null?void 0:o.role)==="manager"||(o==null?void 0:o.role)==="admin",Ue=t.assignedMechanicId===(o==null?void 0:o.id),as=te&&!t.assignedMechanicId&&t.status==="not_started",rs=t.vehicleLicensePlate||(f==null?void 0:f.licensePlate)||"-",Je=t.vehicleBrand||(f==null?void 0:f.brand)||"-",Ge=t.vehicleModel||(f==null?void 0:f.model)||"",s=t.vehicleYear||(f==null?void 0:f.year),i=t.vehicleVin||(f==null?void 0:f.vin),m=t.vehicleFuelType||(f==null?void 0:f.fuelType),N=t.mileage||(f==null?void 0:f.mileage),he=n=>n?{petrol:r("fuel.petrol"),diesel:r("fuel.diesel"),electric:r("fuel.electric"),hybrid:r("fuel.hybrid"),lpg:r("fuel.lpg"),other:r("fuel.other")}[n]||n:"-",xe=async()=>{if(!t)return;const n={};Pe!==""&&(n.mileage=Number(Pe)),be&&(n.vehicleFuelType=be),Object.keys(n).length>0&&await pe(t.id,n),Le(!1)},ft=async()=>{!t||!X.trim()||(await pe(t.id,{problemDescription:X.trim()},o==null?void 0:o.id),ve(!1))},jt=()=>{Y(!0)},Nt=async()=>{if(!(!o||!t))try{const n=new Date().toISOString();await pe(t.id,{assignedMechanicId:o.id,assignedAt:n,status:"in_progress"},o.id),Y(!1)}catch(n){console.error("Error claiming job:",n)}},bt=async()=>{if(!(!o||!t))try{const n=new Date().toISOString();await pe(t.id,{status:"in_progress"},o.id)}catch(n){console.error("Error starting job:",n)}},vt=n=>{if(t){if(n==="waiting_for_parts"){le(n),de(!0);return}if(n==="completed"){le(n),l(!0);return}yt(n)}},yt=async n=>{if(t)try{const P={status:n,...n==="completed"&&{completedAt:new Date().toISOString()}};if(await pe(t.id,P,o==null?void 0:o.id),n==="completed")try{await $s(t.id,t.problemDescription.substring(0,50),o==null?void 0:o.id)}catch(E){console.error("Error sending completion notification:",E)}le(null)}catch(P){console.error("Error updating job status:",P)}},wt=async n=>{if(t)try{const P=t.partsNeeded||[],E=P.map(G=>G.categoryId),ee=n.partsNeeded.filter(G=>!E.includes(G.categoryId)),Q=[...P,...ee];if(await pe(t.id,{status:"waiting_for_parts",partsNeeded:Q},o==null?void 0:o.id),ee.length>0)try{await Bs(t.id,t.problemDescription.substring(0,50),o==null?void 0:o.id)}catch(G){console.error("Error sending parts notification:",G)}le(null),de(!1)}catch(P){console.error("Error saving parts data:",P)}},kt=async n=>{var P;if(!(!t||!o))try{const E={...t.workOrderData||{},completionConfirmation:{faultsChecked:n.faultsChecked,partsConfirmed:n.partsConfirmed,completionNotes:n.completionNotes,confirmedAt:new Date().toISOString(),confirmedBy:o.id},parts:(((P=t.workOrderData)==null?void 0:P.parts)||[]).map(v=>{const Z=n.partsConfirmed.find(Ct=>Ct.id===v.id);return Z?Z.removed?null:{...v,quantity:Z.confirmedQuantity}:v}).filter(Boolean),completedAt:new Date().toISOString()},ee=JSON.parse(JSON.stringify(E));await pe(t.id,{status:"completed",completedAt:new Date().toISOString(),workOrderData:ee,workOrderStage:6},o.id);const Q=ee.parts||[],G=Q.filter(v=>v.partId).map(v=>({partId:v.partId,partName:v.partName,partNumber:v.partNumber||"",quantity:v.quantity,costPrice:v.unitPrice,sellingPrice:v.unitPrice,totalCost:v.quantity*v.unitPrice}));if(G.length>0)try{await Ht(G,t.id,o.id)}catch(v){console.error("Error deducting stock:",v)}const Oe=Q.filter(v=>{var Z;return!v.partId&&((Z=v.partNumber)==null?void 0:Z.trim())});for(const v of Oe)try{const Z=await Rt(v.partNumber.trim());Z&&await _t(Z.id,-v.quantity,"usage",o.id,{jobId:t.id,costPerUnit:v.unitPrice,reason:`Used in job ${t.id}`,notes:`Part: ${v.partName} (${v.partNumber})`})}catch(Z){console.error(`Error deducting stock for part ${v.partNumber}:`,Z)}try{await $s(t.id,t.problemDescription.substring(0,50),o.id)}catch(v){console.error("Error sending completion notification:",v)}le(null)}catch(E){console.error("Error completing job:",E)}},hs=async n=>{var P,E,ee;if(t)try{let Q=1;((P=n.workItems)==null?void 0:P.length)>0&&(Q=2),((E=n.findings)==null?void 0:E.length)>0&&(Q=3),((ee=n.parts)==null?void 0:ee.length)>0&&(Q=4),n.completedAt&&(Q=5);const G=n.parts&&n.parts.length>0,v={workOrderData:JSON.parse(JSON.stringify(n)),workOrderStage:Q};if(t.status!=="completed")if(G&&t.status!=="waiting_for_parts"){v.status="waiting_for_parts";try{await Bs(t.id,t.problemDescription.substring(0,50),(o==null?void 0:o.id)||"")}catch(Z){console.error("Failed to send notification:",Z)}}else!G&&t.status==="waiting_for_parts"&&(v.status="in_progress");await pe(t.id,v,o==null?void 0:o.id),je(!1)}catch(Q){throw console.error("Error saving work order:",Q),Q}},ps=me?[{status:"in_progress",label:r("jobs.inProgress"),icon:ls,color:"bg-[hsl(var(--status-in-progress))]"},{status:"waiting_for_parts",label:r("jobs.waitingParts"),icon:I,color:"bg-[hsl(var(--status-waiting))]"},{status:"completed",label:r("jobs.completed"),icon:ie,color:"bg-[hsl(var(--status-completed))]"}]:[];return e.jsxs("div",{className:"safe-top pb-8",children:[e.jsxs("div",{className:"px-4 pt-4 pb-4 flex items-center gap-4",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>d(-1),children:e.jsx(aa,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(pt,{status:t.status})}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[r("jobDetail.createdOn")," ",ge(new Date(t.createdAt),"dd/MM/yyyy")]})]})]}),e.jsxs("div",{className:"px-4 space-y-4",children:[t.status==="completed"&&e.jsx(fa,{job:t,vehicle:f,mechanic:L,creator:q,isMechanic:te}),e.jsxs(T,{className:"border-2 border-primary/20 bg-gradient-to-br from-primary/5 to-transparent",children:[e.jsx(se,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 flex items-center justify-center shrink-0",children:e.jsx(tt,{brand:Je||"",size:"xl",className:"text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(sa,{plateNumber:rs,size:"lg"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[Je," ",Ge," ",s&&`(${s})`]})]})]})}),e.jsx(F,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-background/50",children:[e.jsx(ss,{className:"h-5 w-5 text-muted-foreground shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:r("jobDetail.kilometers")}),Se?e.jsx(V,{type:"number",value:Pe,placeholder:N?String(N):"0",onChange:n=>Ee(n.target.value),onFocus:n=>n.target.select(),className:"h-7 text-sm mt-0.5"}):e.jsx("p",{className:"font-medium",children:N?`${N.toLocaleString()} km`:r("jobDetail.notRecorded")})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-background/50",children:[e.jsx(la,{className:"h-5 w-5 text-muted-foreground shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:r("jobDetail.fuelType")}),Se?e.jsxs(Tt,{value:be||m||"",onValueChange:Ve,children:[e.jsx(Ft,{className:"h-7 text-sm mt-0.5",children:e.jsx(qt,{placeholder:"-"})}),e.jsxs(Lt,{children:[e.jsx(Me,{value:"petrol",children:r("fuel.petrol")}),e.jsx(Me,{value:"diesel",children:r("fuel.diesel")}),e.jsx(Me,{value:"electric",children:r("fuel.electric")}),e.jsx(Me,{value:"hybrid",children:r("fuel.hybrid")}),e.jsx(Me,{value:"lpg",children:r("fuel.lpg")}),e.jsx(Me,{value:"other",children:r("fuel.other")})]})]}):e.jsx("p",{className:"font-medium",children:he(m)})]})]}),i&&e.jsxs("div",{className:"col-span-2 flex items-center gap-3 p-3 rounded-lg bg-background/50",children:[e.jsx(Bt,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"VIN"}),e.jsx("p",{className:"font-mono text-sm",children:i})]})]}),(te||me)&&t.status!=="completed"&&e.jsx("div",{className:"col-span-2 flex justify-end gap-2 pt-1",children:Se?e.jsxs(e.Fragment,{children:[e.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>Le(!1),children:[e.jsx(_s,{className:"h-4 w-4 mr-1"}),r("common.cancel")]}),e.jsxs(j,{size:"sm",onClick:xe,children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),r("common.save")]})]}):e.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>{Ee(N?String(N):""),Ve(m||""),Le(!0)},children:[e.jsx(Us,{className:"h-4 w-4 mr-1"}),r("common.edit")]})})]})})]}),te&&t.status!=="completed"&&e.jsx(e.Fragment,{children:as?e.jsx(j,{onClick:jt,className:"w-full h-14 text-base",children:r("jobs.claim")}):Ue&&e.jsx(e.Fragment,{children:t.status==="not_started"?e.jsxs(j,{onClick:bt,className:"w-full h-14 text-base bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(ls,{className:"h-5 w-5 mr-2"}),r("jobs.startJob")]}):e.jsxs(j,{onClick:()=>l(!0),className:"w-full h-14 text-base bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(ie,{className:"h-5 w-5 mr-2"}),r("jobs.completeJob")]})})}),e.jsxs(j,{className:"w-full h-14 text-base",onClick:()=>d(`/jobs/${t.id}/messages`),children:[e.jsx(ra,{className:"mr-2 h-5 w-5"}),r("dashboard.viewMessages")]}),e.jsxs(j,{variant:"default",className:"w-full h-12",onClick:()=>je(!0),children:[e.jsx(ke,{className:"mr-2 h-5 w-5"}),t.workOrderData?r("jobs.editWorkOrder"):r("jobs.createWorkOrder"),t.workOrderStage&&e.jsxs(k,{variant:"secondary",className:"ml-2",children:[r("jobs.stage")," ",t.workOrderStage,"/6"]})]}),me&&Ue&&t.status!=="completed"&&ps.length>0&&e.jsxs(T,{children:[e.jsx(se,{className:"pb-2",children:e.jsx(re,{className:"text-base",children:r("jobDetail.updateStatus")})}),e.jsx(F,{children:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:ps.map(({status:n,label:P,icon:E,color:ee})=>e.jsxs("button",{onClick:()=>vt(n),disabled:t.status===n,className:`flex flex-col items-center gap-2 p-3 rounded-lg border-2 transition-all ${t.status===n?"border-primary bg-primary/10":"border-border hover:border-primary/50"} disabled:opacity-50`,children:[e.jsx("div",{className:`p-2 rounded-full ${ee}`,children:e.jsx(E,{className:"h-4 w-4 text-white"})}),e.jsx("span",{className:"text-xs font-medium text-center",children:P})]},n))})})]}),me&&e.jsxs(T,{children:[e.jsx(se,{className:"pb-2",children:e.jsxs(re,{className:"text-base flex items-center gap-2",children:[e.jsx(cs,{className:"h-4 w-4"}),r("jobDetail.customerInformation")]})}),e.jsx(F,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:r("jobs.customerName")}),e.jsx("span",{className:"font-medium",children:t.customerName})]}),e.jsx(z,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:r("jobs.customerPhone")}),e.jsxs("a",{href:`tel:${t.customerPhone}`,className:"font-medium text-primary flex items-center gap-1",children:[e.jsx(rt,{className:"h-3 w-3"}),t.customerPhone]})]}),t.customerEmail&&e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:r("jobDetail.email")}),e.jsxs("a",{href:`mailto:${t.customerEmail}`,className:"font-medium text-primary flex items-center gap-1",children:[e.jsx(Ot,{className:"h-3 w-3"}),t.customerEmail]})]})]}),t.customerNotes&&e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground text-sm",children:r("jobDetail.notes")}),e.jsx("p",{className:"text-sm mt-1",children:t.customerNotes})]})]})]})})]}),e.jsxs(T,{className:"border-l-4 border-l-amber-500",children:[e.jsx(se,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(re,{className:"text-base flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4 text-amber-500"}),r("jobs.problemDescription")]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.serviceType&&e.jsx(gt,{serviceType:t.serviceType}),e.jsx("span",{className:`text-xs font-medium uppercase px-2 py-0.5 rounded-full priority-${t.priority}`,children:t.priority}),((o==null?void 0:o.role)==="manager"||(o==null?void 0:o.role)==="admin")&&!We&&e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>{Ie(t.problemDescription),ve(!0)},children:e.jsx(Us,{className:"h-4 w-4"})})]})]})}),e.jsxs(F,{className:"space-y-4",children:[e.jsx("div",{className:"p-4 rounded-lg bg-muted/50",children:We?e.jsxs("div",{className:"space-y-3",children:[e.jsx(ze,{value:X,onChange:n=>Ie(n.target.value),className:"min-h-[120px] text-foreground",placeholder:r("jobs.problemDescription")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{size:"sm",onClick:ft,children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),r("common.save")]}),e.jsxs(j,{size:"sm",variant:"ghost",onClick:()=>{ve(!1),Ie("")},children:[e.jsx(_s,{className:"h-4 w-4 mr-1"}),r("common.cancel")]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-foreground leading-relaxed",children:c?t.problemDescription:Te(t,x)}),t.problemDescriptionLanguage&&t.problemDescriptionLanguage!==x&&((gs=t.problemDescriptionTranslations)==null?void 0:gs[x])&&e.jsxs("button",{onClick:()=>a(!c),className:"flex items-center gap-1 mt-3 text-xs text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(ta,{className:"h-3 w-3"}),r(c?"jobDetail.showTranslation":"jobDetail.showOriginal")]})]})}),t.faultCategory&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase mb-2",children:r("jobDetail.affectedAreas")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.faultCategory.split(",").map((n,P)=>e.jsx(k,{variant:"outline",className:"text-sm",children:r(`modal.parts.category.${n.trim()}`)},P))})]}),e.jsxs("div",{className:"flex items-center gap-4 pt-2 border-t",children:[L&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(R,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:r("jobDetail.assignedTo")}),e.jsx("span",{className:"font-medium",children:L.fullName})]}),t.scheduledDate&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(es,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:r("jobDetail.scheduled")}),e.jsx("span",{className:"font-medium",children:ge(new Date(t.scheduledDate),"dd/MM/yyyy")})]})]})]})]}),e.jsxs(T,{children:[e.jsx(se,{className:"pb-3",children:e.jsxs(re,{className:"text-base flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),r("jobs.timeline")]})}),e.jsx(F,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(es,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm",children:r("jobDetail.jobCreated")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:ge(new Date(t.createdAt),"dd/MM/yyyy HH:mm")}),q&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r("jobs.createdBy")," ",q.fullName]})]})]}),t.assignedAt&&e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center shrink-0",children:e.jsx(cs,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm",children:r("jobDetail.assignedToMechanic")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:ge(new Date(t.assignedAt),"dd/MM/yyyy HH:mm")}),L&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r("jobs.assignedTo")," ",L.fullName]})]})]}),t.status!=="not_started"&&t.assignedAt&&e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-500/10 flex items-center justify-center shrink-0",children:e.jsx(ls,{className:"h-5 w-5 text-orange-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm",children:r("jobs.startedAt")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.status==="in_progress"||t.status==="waiting_for_parts"||t.status==="completed"?ge(new Date(t.assignedAt),"dd/MM/yyyy HH:mm"):"-"})]})]}),t.workOrderData&&(((fs=t.workOrderData.parts)==null?void 0:fs.length)>0||((js=t.workOrderData.workItems)==null?void 0:js.length)>0)&&e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-500/10 flex items-center justify-center shrink-0",children:e.jsx(I,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-semibold text-sm",children:[((Ns=t.workOrderData.parts)==null?void 0:Ns.length)>0&&r("jobs.partsAdded"),((bs=t.workOrderData.parts)==null?void 0:bs.length)>0&&((vs=t.workOrderData.workItems)==null?void 0:vs.length)>0&&" / ",((ys=t.workOrderData.workItems)==null?void 0:ys.length)>0&&r("jobs.servicesAdded")]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[((ws=t.workOrderData.parts)==null?void 0:ws.length)>0&&`${t.workOrderData.parts.length} ${t.workOrderData.parts.length===1?r("jobDetail.part"):r("jobDetail.parts")}`,((ks=t.workOrderData.parts)==null?void 0:ks.length)>0&&((Cs=t.workOrderData.workItems)==null?void 0:Cs.length)>0&&", ",((Ds=t.workOrderData.workItems)==null?void 0:Ds.length)>0&&`${t.workOrderData.workItems.length} ${t.workOrderData.workItems.length===1?r("jobDetail.service"):r("jobDetail.services")}`]})]})]}),t.completedAt&&e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-green-500/10 flex items-center justify-center shrink-0",children:e.jsx(ie,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm text-green-600",children:r("jobDetail.jobCompleted")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:ge(new Date(t.completedAt),"dd/MM/yyyy HH:mm")}),L&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r("jobs.completedBy")," ",L.fullName]})]})]})]})})]}),t.workOrderData&&(((Ss=t.workOrderData.parts)==null?void 0:Ss.length)>0||((Ps=t.workOrderData.workItems)==null?void 0:Ps.length)>0)&&e.jsxs(T,{className:"cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>qe(!0),children:[e.jsx(se,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(re,{className:"text-base flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),r("jobs.partsAdded")," / ",r("jobs.servicesAdded")]}),e.jsx(He,{className:"h-5 w-5 text-muted-foreground"})]})}),e.jsx(F,{children:e.jsxs("div",{className:"space-y-2",children:[t.workOrderData.workItems&&t.workOrderData.workItems.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(R,{className:"h-4 w-4 text-primary"}),e.jsxs("span",{className:"font-medium",children:[t.workOrderData.workItems.length," ",t.workOrderData.workItems.length===1?r("jobDetail.service"):r("jobDetail.services")]})]}),t.workOrderData.parts&&t.workOrderData.parts.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(I,{className:"h-4 w-4 text-primary"}),e.jsxs("span",{className:"font-medium",children:[t.workOrderData.parts.length," ",t.workOrderData.parts.length===1?r("jobDetail.part"):r("jobDetail.parts")]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:r("jobDetail.tapToView")})]})})]}),te&&t.status==="completed"&&e.jsxs(T,{children:[e.jsx(se,{className:"pb-3",children:e.jsxs(re,{className:"text-base flex items-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4"}),"Work Performed"]})}),e.jsxs(F,{className:"space-y-4",children:[((Is=t.workOrderData)==null?void 0:Is.workItems)&&t.workOrderData.workItems.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground font-semibold uppercase",children:r("jobDetail.services")}),t.workOrderData.workItems.map(n=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-muted/50",children:[e.jsx(R,{className:"h-4 w-4 text-primary mt-0.5 shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:n.serviceName}),n.description&&n.description!==n.serviceName&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:n.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[n.durationHours>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[n.durationHours,"h"]}),n.isImmediate&&e.jsx(k,{variant:"destructive",className:"text-[10px] px-1.5 py-0",children:r("status.immediate")})]})]})]},n.id))]}),((Os=t.workOrderData)==null?void 0:Os.findings)&&t.workOrderData.findings.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{}),e.jsx("p",{className:"text-xs text-muted-foreground font-semibold uppercase",children:"Findings"}),t.workOrderData.findings.map(n=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-muted/50",children:[e.jsx(we,{className:`h-4 w-4 mt-0.5 shrink-0 ${n.requiresReplacement?"text-amber-500":"text-muted-foreground"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm",children:n.description}),n.requiresReplacement&&e.jsx(k,{variant:"outline",className:"text-[10px] px-1.5 py-0 mt-1 border-amber-500/50 text-amber-600",children:"Replacement Required"})]})]},n.id))]}),((Ms=t.workOrderData)==null?void 0:Ms.parts)&&t.workOrderData.parts.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{}),e.jsx("p",{className:"text-xs text-muted-foreground font-semibold uppercase",children:r("jobDetail.partsUsed")}),t.workOrderData.parts.map(n=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50",children:[e.jsx(I,{className:"h-4 w-4 text-primary shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:n.partName}),n.partNumber&&e.jsxs("p",{className:"text-xs text-muted-foreground font-mono",children:["#",n.partNumber]})]}),e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:["x",n.quantity]})]},n.id))]}),(!((As=t.workOrderData)!=null&&As.parts)||t.workOrderData.parts.length===0)&&t.partsNeeded&&t.partsNeeded.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{}),e.jsx("p",{className:"text-xs text-muted-foreground font-semibold uppercase",children:r("jobDetail.parts")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.partsNeeded.map(n=>e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-primary/10 text-primary text-xs border border-primary/30",children:[e.jsx(I,{className:"h-3 w-3"}),r(`modal.parts.category.${n.categoryId}`)]},n.categoryId))})]}),((Fs=(Ts=t.workOrderData)==null?void 0:Ts.completionConfirmation)==null?void 0:Fs.completionNotes)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{}),e.jsx("p",{className:"text-xs text-muted-foreground font-semibold uppercase",children:"Completion Notes"}),e.jsx("p",{className:"text-sm p-3 rounded-lg bg-muted/50",children:t.workOrderData.completionConfirmation.completionNotes})]})]})]}),t.status==="waiting_for_parts"&&t.partsNeeded&&t.partsNeeded.length>0&&e.jsx(pa,{partsNeeded:t.partsNeeded,onAddMoreParts:()=>de(!0)}),me&&!t.quoteId&&e.jsxs(j,{variant:"outline",className:"w-full h-12 border-primary/50 text-primary hover:bg-primary/10",onClick:()=>O(!0),children:[e.jsx(ke,{className:"mr-2 h-5 w-5"}),r("jobDetail.createQuote")]}),t.quoteId&&me&&e.jsxs(j,{variant:"outline",className:"w-full h-12 border-primary/50 text-primary hover:bg-primary/10",onClick:()=>d(`/quotes/${t.quoteId}`),children:[e.jsx(ke,{className:"mr-2 h-5 w-5"}),r("jobs.viewQuote")]}),me&&t.status==="completed"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{variant:"default",className:"flex-1 h-12 bg-green-600 hover:bg-green-700",onClick:()=>B(!0),children:[e.jsx(Js,{className:"mr-2 h-5 w-5"}),r("jobs.processInvoice"),(((qs=t.invoiceIds)==null?void 0:qs.length)||0)>0&&e.jsxs(k,{variant:"secondary",className:"ml-1 text-xs",children:["+",(Ls=t.invoiceIds)==null?void 0:Ls.length]})]}),e.jsxs(j,{variant:"outline",className:"flex-1 h-12 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>d(`/invoices/${t.invoiceId}`),disabled:!t.invoiceId,children:[e.jsx(Js,{className:"mr-2 h-5 w-5"}),r("jobs.viewInvoice")]})]}),y.length>0&&e.jsxs(T,{children:[e.jsxs(se,{className:"pb-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(re,{className:"text-base flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),r("jobs.serviceHistory"),e.jsxs(k,{variant:"secondary",className:"ml-2",children:[y.length," ",r("jobs.previousJobs")]})]})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r("jobs.tapForDetails")})]}),e.jsx(F,{children:e.jsx("div",{className:"space-y-3",children:y.map(n=>e.jsx(Na,{job:n,isExpanded:U===n.id,onToggle:()=>fe(U===n.id?null:n.id),userLanguage:x},n.id))})})]})]}),e.jsx(da,{open:Fe,onOpenChange:Y,job:t,vehicle:f,onConfirm:Nt}),e.jsx(xa,{open:ne,onOpenChange:n=>{de(n),n||le(null)},onComplete:wt,existingParts:(t==null?void 0:t.partsNeeded)||[]}),e.jsx(ha,{open:u,onOpenChange:n=>{l(n),n||le(null)},onConfirm:kt,job:t}),e.jsx(Vs,{job:t,isOpen:b,onClose:()=>O(!1),onQuoteCreated:n=>{O(!1)}}),e.jsx(ja,{open:ts,onClose:()=>je(!1),job:t,onSave:hs,onProcessQuote:async n=>{await hs(n),je(!1),O(!0)}}),e.jsx(Vs,{job:t,isOpen:$,onClose:()=>B(!1),mode:"invoice",onQuoteCreated:n=>{B(!1)}}),e.jsx(Re,{open:Ne,onOpenChange:qe,children:e.jsxs(_e,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx($e,{children:e.jsxs(Be,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),r("jobs.partsAdded")," & ",r("jobs.servicesAdded")]})}),e.jsxs("div",{className:"space-y-6 mt-4",children:[((Es=t.workOrderData)==null?void 0:Es.findings)&&t.workOrderData.findings.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground uppercase mb-3 flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),r("jobDetail.diagnosticFindings")," (",t.workOrderData.findings.length,")"]}),e.jsx("div",{className:"space-y-2",children:t.workOrderData.findings.map(n=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-muted/50 border",children:[e.jsx(we,{className:`h-4 w-4 mt-0.5 shrink-0 ${n.requiresReplacement?"text-amber-500":"text-muted-foreground"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm",children:n.description}),n.requiresReplacement&&e.jsx(k,{variant:"outline",className:"text-[10px] px-1.5 py-0 mt-1 border-amber-500/50 text-amber-600",children:"Replacement Required"})]})]},n.id))})]}),((zs=t.workOrderData)==null?void 0:zs.workItems)&&t.workOrderData.workItems.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground uppercase mb-3 flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),r("jobDetail.services")," (",t.workOrderData.workItems.length,")"]}),e.jsx("div",{className:"space-y-2",children:t.workOrderData.workItems.map(n=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-muted/50 border",children:[e.jsx(R,{className:"h-4 w-4 text-primary mt-0.5 shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium",children:n.serviceName}),n.description&&n.description!==n.serviceName&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:n.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 flex-wrap",children:[n.durationHours>0&&e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(ye,{className:"h-3 w-3"}),n.durationHours,"h"]}),n.isImmediate&&e.jsx(k,{variant:"destructive",className:"text-[10px] px-1.5 py-0",children:r("status.immediate")}),!te&&n.fixedPrice!=null&&e.jsxs("span",{className:"text-xs font-medium text-primary",children:["€",n.fixedPrice.toFixed(2)]})]})]})]},n.id))})]}),((Hs=t.workOrderData)==null?void 0:Hs.parts)&&t.workOrderData.parts.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground uppercase mb-3 flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),r("jobDetail.parts")," (",t.workOrderData.parts.length,")"]}),e.jsx("div",{className:"space-y-2",children:t.workOrderData.parts.map(n=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50 border",children:[e.jsx(I,{className:"h-4 w-4 text-primary shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium",children:n.partName}),n.partNumber&&e.jsxs("p",{className:"text-xs text-muted-foreground font-mono",children:["#",n.partNumber]}),n.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:n.description})]}),e.jsxs("div",{className:"text-right shrink-0",children:[e.jsxs("p",{className:"text-sm font-medium",children:["×",n.quantity]}),!te&&n.unitPrice>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["€",n.unitPrice.toFixed(2)]}),n.needsOrdering&&e.jsx(k,{variant:"outline",className:"text-[10px] mt-1 text-orange-600 border-orange-600",children:r("status.needsOrder")})]})]},n.id))})]})]})]})})]})}export{sr as default};
