import{o as re,u as le,r as c,s as d,j as e,B as h,P as ie,e as b,f as P,h as S,i as C,N as o,K as ce,M as ne,_ as i}from"./index-CNxWMcuV.js";import{e as oe,f as O,h as de,a as me,u as xe,i as ue}from"./partsService-DfpAxGHT.js";import{D as he,b as pe,c as ge,d as je,e as ve}from"./dialog-CIS6byhQ.js";import{S as F,a as E,b as R,c as A,d as w}from"./select-CbHlLrev.js";import{T as V}from"./textarea-D6buyuls.js";import{P as B}from"./package-8-BxBKwT.js";import{S as fe}from"./search-vDLcJ1l5.js";import{T as I}from"./triangle-alert-CHSZJu74.js";import{S as Ne}from"./square-pen-wrU9Jooq.js";import"./chevron-down-n_8xVDCk.js";const _=["brakes","fluids","electrical","air_system","gauges","transmission","suspension","body","lighting","cooling","engine","drivetrain","audio","wheels","accessories","filters","belts","hoses","gaskets","other"];function Re(){const{user:m}=re(),{t:s}=le(),z=[{value:"piece",label:s("parts.units.piece")},{value:"liter",label:s("parts.units.liter")},{value:"meter",label:s("parts.units.meter")},{value:"kilogram",label:s("parts.units.kilogram")},{value:"set",label:s("parts.units.set")}],[x,Q]=c.useState([]),[T,q]=c.useState([]),[H,D]=c.useState(!0),[g,K]=c.useState(""),[p,$]=c.useState("all"),[j,G]=c.useState(!1),[U,v]=c.useState(!1),[J,f]=c.useState(!1),[u,N]=c.useState(null),[r,l]=c.useState({partNumber:"",name:"",description:"",category:"",stockQuantity:0,minStockLevel:5,maxStockLevel:100,unit:"piece",location:"",costPrice:0,sellingPrice:0,markup:0,taxRate:20,isActive:!0,notes:""});c.useEffect(()=>{L()},[]),c.useEffect(()=>{W()},[x,g,p,j]);const L=async()=>{try{D(!0);const t=await oe();Q(t)}catch(t){console.error("Error loading parts:",t),d.error(s("parts.loadError"))}finally{D(!1)}},W=()=>{let t=[...x];if(g){const a=g.toLowerCase();t=t.filter(n=>{var M;return n.name.toLowerCase().includes(a)||n.partNumber.toLowerCase().includes(a)||((M=n.description)==null?void 0:M.toLowerCase().includes(a))})}p&&p!=="all"&&(t=t.filter(a=>a.category===p)),j&&(t=t.filter(a=>a.stockQuantity<=a.minStockLevel)),q(t)},y=()=>{l({partNumber:"",name:"",description:"",category:"",stockQuantity:0,minStockLevel:5,maxStockLevel:100,unit:"piece",location:"",costPrice:0,sellingPrice:0,markup:0,taxRate:20,isActive:!0,notes:""})},X=t=>{const a=O(t,r.markup);l(n=>({...n,costPrice:t,sellingPrice:a}))},Y=t=>{const a=de(r.costPrice,t);l(n=>({...n,sellingPrice:t,markup:a}))},Z=t=>{const a=O(r.costPrice,t);l(n=>({...n,markup:t,sellingPrice:a}))},ee=async()=>{if(m)try{if(!r.name||!r.partNumber||!r.category){d.error(s("common.fillRequired"));return}await me(r,m.id),d.success(s("parts.added")),v(!1),y(),L()}catch(t){console.error("Error adding part:",t),d.error(s("parts.addError"))}},te=async()=>{if(!(!m||!u))try{await xe(u.id,r,m.id),d.success(s("parts.updated")),f(!1),N(null),y(),L()}catch(t){console.error("Error updating part:",t),d.error(s("parts.updateError"))}},se=async t=>{if(m&&confirm(s("parts.confirmDelete")))try{await ue(t,m.id),d.success(s("parts.deleted")),Q(a=>a.filter(n=>n.id!==t))}catch(a){console.error("Error deleting part:",a),d.error(s("parts.deleteError"))}},ae=t=>{N(t),l({partNumber:t.partNumber,name:t.name,description:t.description||"",category:t.category,stockQuantity:t.stockQuantity,minStockLevel:t.minStockLevel,maxStockLevel:t.maxStockLevel,unit:t.unit,location:t.location||"",costPrice:t.costPrice,sellingPrice:t.sellingPrice,markup:t.markup,taxRate:t.taxRate,isActive:t.isActive,notes:t.notes||""}),f(!0)},k={total:x.length,active:x.filter(t=>t.isActive).length,lowStock:x.filter(t=>t.stockQuantity<=t.minStockLevel).length,totalValue:x.reduce((t,a)=>t+a.stockQuantity*a.costPrice,0)};return H?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(B,{className:"h-8 w-8 text-primary"}),s("parts.title")]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:s("parts.subtitle")})]}),e.jsxs(h,{onClick:()=>v(!0),children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),s("parts.addNew")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(b,{children:[e.jsx(P,{className:"pb-3",children:e.jsx(S,{className:"text-sm font-medium text-muted-foreground",children:s("parts.totalParts")})}),e.jsx(C,{children:e.jsx("div",{className:"text-2xl font-bold",children:k.total})})]}),e.jsxs(b,{children:[e.jsx(P,{className:"pb-3",children:e.jsx(S,{className:"text-sm font-medium text-muted-foreground",children:s("parts.activeParts")})}),e.jsx(C,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:k.active})})]}),e.jsxs(b,{children:[e.jsx(P,{className:"pb-3",children:e.jsx(S,{className:"text-sm font-medium text-muted-foreground",children:s("parts.lowStock")})}),e.jsx(C,{children:e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:k.lowStock})})]}),e.jsxs(b,{children:[e.jsx(P,{className:"pb-3",children:e.jsx(S,{className:"text-sm font-medium text-muted-foreground",children:s("parts.totalValue")})}),e.jsx(C,{children:e.jsxs("div",{className:"text-2xl font-bold",children:["€",k.totalValue.toFixed(2)]})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"relative flex-1 min-w-[300px]",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(o,{placeholder:s("parts.searchPlaceholder"),value:g,onChange:t=>K(t.target.value),className:"pl-10"})]}),e.jsxs(F,{value:p,onValueChange:$,children:[e.jsx(E,{className:"w-[200px]",children:e.jsx(R,{placeholder:s("parts.allCategories")})}),e.jsxs(A,{children:[e.jsx(w,{value:"all",children:s("parts.allCategories")}),_.map(t=>e.jsx(w,{value:t,children:s(`parts.categories.${t}`)},t))]})]}),e.jsxs(h,{variant:j?"default":"outline",onClick:()=>G(!j),children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),s("parts.lowStockOnly")]})]}),e.jsxs("div",{className:"rounded-lg border",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:s("parts.partNumber")}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:s("common.name")}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:s("parts.category")}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium",children:s("parts.stock")}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium",children:s("parts.cost")}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium",children:s("parts.selling")}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium",children:s("parts.markup")}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium",children:s("common.actions")})]})}),e.jsx("tbody",{className:"divide-y",children:T.map(t=>{const a=t.stockQuantity<=t.minStockLevel;return e.jsxs("tr",{className:"hover:bg-muted/30",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-mono",children:t.partNumber}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.name}),t.description&&e.jsx("div",{className:"text-sm text-muted-foreground line-clamp-1",children:t.description})]})}),e.jsx("td",{className:"px-4 py-3 text-sm capitalize",children:t.category.replace("_"," ")}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("span",{className:a?"text-amber-600 font-semibold":"",children:t.stockQuantity}),e.jsx("span",{className:"text-muted-foreground text-sm",children:t.unit}),a&&e.jsx(I,{className:"h-4 w-4 text-amber-500"})]})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:["€",t.costPrice.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right font-semibold",children:["€",t.sellingPrice.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs(ce,{variant:t.markup>30?"default":"secondary",children:[t.markup.toFixed(1),"%"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>ae(t),children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>se(t.id),children:e.jsx(ne,{className:"h-4 w-4 text-destructive"})})]})})]},t.id)})})]})}),T.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(B,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:s("parts.noPartsFound")})]})]}),e.jsx(he,{open:U||J,onOpenChange:t=>{t||(v(!1),f(!1),N(null),y())},children:e.jsxs(pe,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ge,{children:[e.jsx(je,{children:s(u?"parts.editPart":"parts.addNew")}),e.jsx(ve,{children:s(u?"parts.updateDetails":"parts.addDescription")})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(i,{htmlFor:"partNumber",children:[s("parts.partNumber")," *"]}),e.jsx(o,{id:"partNumber",value:r.partNumber,onChange:t=>l(a=>({...a,partNumber:t.target.value})),placeholder:"e.g., BRK-001"})]}),e.jsxs("div",{children:[e.jsxs(i,{htmlFor:"name",children:[s("common.name")," *"]}),e.jsx(o,{id:"name",value:r.name,onChange:t=>l(a=>({...a,name:t.target.value})),placeholder:"e.g., Brake Pad Set"})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"description",children:s("common.description")}),e.jsx(V,{id:"description",value:r.description,onChange:t=>l(a=>({...a,description:t.target.value})),placeholder:s("parts.descriptionPlaceholder"),rows:2})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(i,{htmlFor:"category",children:[s("parts.category")," *"]}),e.jsxs(F,{value:r.category,onValueChange:t=>l(a=>({...a,category:t})),children:[e.jsx(E,{children:e.jsx(R,{placeholder:s("parts.selectCategory")})}),e.jsx(A,{children:_.map(t=>e.jsx(w,{value:t,children:s(`parts.categories.${t}`)},t))})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"unit",children:s("parts.unit")}),e.jsxs(F,{value:r.unit,onValueChange:t=>l(a=>({...a,unit:t})),children:[e.jsx(E,{children:e.jsx(R,{})}),e.jsx(A,{children:z.map(t=>e.jsx(w,{value:t.value,children:t.label},t.value))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"stockQuantity",children:s("parts.stockQuantity")}),e.jsx(o,{id:"stockQuantity",type:"number",value:r.stockQuantity||"",placeholder:"0",onFocus:t=>t.target.select(),onChange:t=>l(a=>({...a,stockQuantity:Number(t.target.value)}))})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"minStockLevel",children:s("parts.minStock")}),e.jsx(o,{id:"minStockLevel",type:"number",value:r.minStockLevel||"",placeholder:"0",onFocus:t=>t.target.select(),onChange:t=>l(a=>({...a,minStockLevel:Number(t.target.value)}))})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"maxStockLevel",children:s("parts.maxStock")}),e.jsx(o,{id:"maxStockLevel",type:"number",value:r.maxStockLevel||"",placeholder:"0",onFocus:t=>t.target.select(),onChange:t=>l(a=>({...a,maxStockLevel:Number(t.target.value)}))})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"location",children:s("parts.storageLocation")}),e.jsx(o,{id:"location",value:r.location,onChange:t=>l(a=>({...a,location:t.target.value})),placeholder:s("parts.locationPlaceholder")})]}),e.jsxs("div",{className:"space-y-3 border-t pt-4",children:[e.jsx("h4",{className:"font-semibold",children:s("parts.pricing")}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"costPrice",children:s("parts.costPrice")}),e.jsx(o,{id:"costPrice",type:"number",step:"0.01",value:r.costPrice||"",placeholder:"0.00",onFocus:t=>t.target.select(),onChange:t=>X(Number(t.target.value))})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"markup",children:s("parts.markupPercent")}),e.jsx(o,{id:"markup",type:"number",step:"0.1",value:r.markup||"",placeholder:"0",onFocus:t=>t.target.select(),onChange:t=>Z(Number(t.target.value))})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"sellingPrice",children:s("parts.sellingPrice")}),e.jsx(o,{id:"sellingPrice",type:"number",step:"0.01",value:r.sellingPrice||"",placeholder:"0.00",onFocus:t=>t.target.select(),onChange:t=>Y(Number(t.target.value))})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"taxRate",children:s("parts.taxRate")}),e.jsx(o,{id:"taxRate",type:"number",step:"0.1",value:r.taxRate||"",placeholder:"0",onFocus:t=>t.target.select(),onChange:t=>l(a=>({...a,taxRate:Number(t.target.value)}))})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"notes",children:s("common.notes")}),e.jsx(V,{id:"notes",value:r.notes,onChange:t=>l(a=>({...a,notes:t.target.value})),placeholder:s("parts.notesPlaceholder"),rows:2})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(h,{variant:"outline",onClick:()=>{v(!1),f(!1),N(null),y()},children:s("common.cancel")}),e.jsx(h,{onClick:u?te:ee,children:s(u?"parts.updatePart":"parts.addPart")})]})]})})]})}export{Re as PartsManagementPage};
