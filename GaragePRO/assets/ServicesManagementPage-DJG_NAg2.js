import{o as Y,u as Z,r as l,s as d,j as e,ao as k,B as p,P as ee,e as C,f as S,h as b,i as w,N as o,K as se,x as re,M as te,_ as c,aB as ie,aC as L}from"./index-CNxWMcuV.js";import{b as ae,a as le,u as ce,d as de,c as ne}from"./servicesService-CCLYMeGf.js";import{D as oe,b as xe,c as me,d as he,e as ue}from"./dialog-CIS6byhQ.js";import{S as A,a as M,b as O,c as I,d as P}from"./select-CbHlLrev.js";import{T as V}from"./textarea-D6buyuls.js";import{S as pe}from"./search-vDLcJ1l5.js";import{S as ve}from"./square-pen-wrU9Jooq.js";import"./chevron-down-n_8xVDCk.js";const $=["brakes","fluids","electrical","air_system","gauges","transmission","suspension","body","lighting","cooling","engine","drivetrain","audio","wheels","diagnostic","inspection","maintenance","repair","other"];function we(){const{user:x}=Y(),{t:r}=Z();r("services.skillLevels.junior"),r("services.skillLevels.senior"),r("services.skillLevels.specialist");const[m,D]=l.useState([]),[T,B]=l.useState([]),[_,E]=l.useState(!0),[v,z]=l.useState(""),[u,G]=l.useState("all"),[H,j]=l.useState(!1),[q,g]=l.useState(!1),[h,f]=l.useState(null),[i,a]=l.useState({serviceCode:"",name:"",description:"",category:"",pricingType:"fixed",hourlyRate:0,fixedPrice:0,estimatedDuration:0,taxRate:20,skillLevel:"junior",includesParts:!1,isActive:!0,notes:""});l.useEffect(()=>{R()},[]),l.useEffect(()=>{K()},[m,v,u]);const R=async()=>{try{E(!0);const s=await ae();D(s)}catch(s){console.error("Error loading services:",s),d.error(r("services.loadError"))}finally{E(!1)}},K=()=>{let s=[...m];if(v){const t=v.toLowerCase();s=s.filter(n=>{var F;return n.name.toLowerCase().includes(t)||n.serviceCode.toLowerCase().includes(t)||((F=n.description)==null?void 0:F.toLowerCase().includes(t))})}u&&u!=="all"&&(s=s.filter(t=>t.category===u)),B(s)},y=()=>{a({serviceCode:"",name:"",description:"",category:"",pricingType:"fixed",hourlyRate:0,fixedPrice:0,estimatedDuration:0,taxRate:20,skillLevel:"junior",includesParts:!1,isActive:!0,notes:""})},W=async()=>{if(x)try{if(!i.name||!i.serviceCode||!i.category){d.error(r("common.fillRequired"));return}if(i.pricingType==="hourly"&&i.hourlyRate<=0){d.error(r("services.validHourlyRate"));return}if(i.pricingType==="fixed"&&i.fixedPrice<=0){d.error(r("services.validFixedPrice"));return}await le(i,x.id),d.success(r("services.added")),j(!1),y(),R()}catch(s){console.error("Error adding service:",s),d.error(r("services.addError"))}},J=async()=>{if(!(!x||!h))try{await ce(h.id,i,x.id),d.success(r("services.updated")),g(!1),f(null),y(),R()}catch(s){console.error("Error updating service:",s),d.error(r("services.updateError"))}},Q=async s=>{if(x&&confirm(r("services.confirmDelete")))try{await de(s,x.id),d.success(r("services.deleted")),D(t=>t.filter(n=>n.id!==s))}catch(t){console.error("Error deleting service:",t),d.error(r("services.deleteError"))}},U=async()=>{const s=await ne();a(t=>({...t,serviceCode:s})),j(!0)},X=s=>{f(s),a({serviceCode:s.serviceCode,name:s.name,description:s.description||"",category:s.category,pricingType:s.pricingType,hourlyRate:s.hourlyRate||0,fixedPrice:s.fixedPrice||0,estimatedDuration:s.estimatedDuration||0,taxRate:s.taxRate,skillLevel:s.skillLevel||"junior",includesParts:s.includesParts,isActive:s.isActive,notes:s.notes||""}),g(!0)},N={total:m.length,active:m.filter(s=>s.isActive).length,hourly:m.filter(s=>s.pricingType==="hourly").length,fixed:m.filter(s=>s.pricingType==="fixed").length};return _?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(k,{className:"h-8 w-8 text-primary"}),r("services.title")]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:r("services.subtitle")})]}),e.jsxs(p,{onClick:U,children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),r("services.addNew")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(C,{children:[e.jsx(S,{className:"pb-3",children:e.jsx(b,{className:"text-sm font-medium text-muted-foreground",children:r("services.totalServices")})}),e.jsx(w,{children:e.jsx("div",{className:"text-2xl font-bold",children:N.total})})]}),e.jsxs(C,{children:[e.jsx(S,{className:"pb-3",children:e.jsx(b,{className:"text-sm font-medium text-muted-foreground",children:r("services.activeServices")})}),e.jsx(w,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:N.active})})]}),e.jsxs(C,{children:[e.jsx(S,{className:"pb-3",children:e.jsx(b,{className:"text-sm font-medium text-muted-foreground",children:r("services.hourlyServices")})}),e.jsx(w,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:N.hourly})})]}),e.jsxs(C,{children:[e.jsx(S,{className:"pb-3",children:e.jsx(b,{className:"text-sm font-medium text-muted-foreground",children:r("services.fixedPrice")})}),e.jsx(w,{children:e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:N.fixed})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"relative flex-1 min-w-[300px]",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(o,{placeholder:r("services.searchPlaceholder"),value:v,onChange:s=>z(s.target.value),className:"pl-10"})]}),e.jsxs(A,{value:u,onValueChange:G,children:[e.jsx(M,{className:"w-[200px]",children:e.jsx(O,{placeholder:r("services.allCategories")})}),e.jsxs(I,{children:[e.jsx(P,{value:"all",children:r("services.allCategories")}),$.map(s=>e.jsx(P,{value:s,children:r(`services.categories.${s}`)},s))]})]})]}),e.jsxs("div",{className:"rounded-lg border",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:r("services.code")}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:r("common.name")}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:r("services.category")}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:r("services.pricing")}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium",children:r("services.price")}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium",children:r("services.duration")}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium",children:r("common.actions")})]})}),e.jsx("tbody",{className:"divide-y",children:T.map(s=>{var t,n;return e.jsxs("tr",{className:"hover:bg-muted/30",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-mono",children:s.serviceCode}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),s.description&&e.jsx("div",{className:"text-sm text-muted-foreground line-clamp-1",children:s.description})]})}),e.jsx("td",{className:"px-4 py-3 text-sm capitalize",children:s.category.replace("_"," ")}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(se,{variant:s.pricingType==="hourly"?"default":"secondary",children:s.pricingType==="hourly"?r("services.hourly"):r("services.fixed")})}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold",children:s.pricingType==="hourly"?`€${(t=s.hourlyRate)==null?void 0:t.toFixed(2)}/hr`:`€${(n=s.fixedPrice)==null?void 0:n.toFixed(2)}`}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1 text-sm",children:[e.jsx(re,{className:"h-3 w-3"}),s.estimatedDuration?`${s.estimatedDuration}h`:"-"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>X(s),children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>Q(s.id),children:e.jsx(te,{className:"h-4 w-4 text-destructive"})})]})})]},s.id)})})]})}),T.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:r("services.noServicesFound")})]})]}),e.jsx(oe,{open:H||q,onOpenChange:s=>{s||(j(!1),g(!1),f(null),y())},children:e.jsxs(xe,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(me,{children:[e.jsx(he,{children:r(h?"services.editService":"services.addNew")}),e.jsx(ue,{children:r(h?"services.updateDetails":"services.addDescription")})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(c,{htmlFor:"serviceCode",children:[r("services.serviceCode")," *"]}),e.jsx(o,{id:"serviceCode",value:i.serviceCode,onChange:s=>a(t=>({...t,serviceCode:s.target.value})),placeholder:"e.g., SRV-0001"})]}),e.jsxs("div",{children:[e.jsxs(c,{htmlFor:"name",children:[r("services.serviceName")," *"]}),e.jsx(o,{id:"name",value:i.name,onChange:s=>a(t=>({...t,name:s.target.value})),placeholder:"e.g., Oil Change"})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"description",children:r("common.description")}),e.jsx(V,{id:"description",value:i.description,onChange:s=>a(t=>({...t,description:s.target.value})),placeholder:r("services.descriptionPlaceholder"),rows:2})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsxs(c,{htmlFor:"category",children:[r("services.category")," *"]}),e.jsxs(A,{value:i.category,onValueChange:s=>a(t=>({...t,category:s})),children:[e.jsx(M,{children:e.jsx(O,{placeholder:r("services.selectCategory")})}),e.jsx(I,{children:$.map(s=>e.jsx(P,{value:s,children:r(`services.categories.${s}`)},s))})]})]})}),e.jsxs("div",{className:"space-y-3 border-t pt-4",children:[e.jsx("h4",{className:"font-semibold",children:r("services.pricingType")}),e.jsxs(ie,{value:i.pricingType,onValueChange:s=>a(t=>({...t,pricingType:s})),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{value:"fixed",id:"fixed"}),e.jsx(c,{htmlFor:"fixed",children:r("services.fixedPrice")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{value:"hourly",id:"hourly"}),e.jsx(c,{htmlFor:"hourly",children:r("services.hourlyRate")})]})]}),i.pricingType==="fixed"?e.jsxs("div",{children:[e.jsxs(c,{htmlFor:"fixedPrice",children:[r("services.fixedPriceEuro")," *"]}),e.jsx(o,{id:"fixedPrice",type:"number",step:"0.01",value:i.fixedPrice||"",placeholder:"0.00",onFocus:s=>s.target.select(),onChange:s=>a(t=>({...t,fixedPrice:Number(s.target.value)}))})]}):e.jsxs("div",{children:[e.jsxs(c,{htmlFor:"hourlyRate",children:[r("services.hourlyRateEuro")," *"]}),e.jsx(o,{id:"hourlyRate",type:"number",step:"0.01",value:i.hourlyRate||"",placeholder:"0.00",onFocus:s=>s.target.select(),onChange:s=>a(t=>({...t,hourlyRate:Number(s.target.value)}))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"estimatedDuration",children:r("services.estimatedDuration")}),e.jsx(o,{id:"estimatedDuration",type:"number",step:"0.5",value:i.estimatedDuration||"",placeholder:"0",onFocus:s=>s.target.select(),onChange:s=>a(t=>({...t,estimatedDuration:Number(s.target.value)}))})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"taxRate",children:r("services.taxRate")}),e.jsx(o,{id:"taxRate",type:"number",step:"0.1",value:i.taxRate||"",placeholder:"0",onFocus:s=>s.target.select(),onChange:s=>a(t=>({...t,taxRate:Number(s.target.value)}))})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"notes",children:r("common.notes")}),e.jsx(V,{id:"notes",value:i.notes,onChange:s=>a(t=>({...t,notes:s.target.value})),placeholder:r("services.notesPlaceholder"),rows:2})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(p,{variant:"outline",onClick:()=>{j(!1),g(!1),f(null),y()},children:r("common.cancel")}),e.jsx(p,{onClick:h?J:W,children:r(h?"services.updateService":"services.addService")})]})]})})]})}export{we as ServicesManagementPage};
