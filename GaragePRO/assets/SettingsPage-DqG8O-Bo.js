import{c as S,aU as ae,r as i,aX as z,b6 as ne,j as e,aY as F,aZ as ie,bc as re,bd as le,a as D,o as ce,u as oe,d as de,p as me,be as he,aI as H,B as J,e as I,i as E,A as xe,g as L,l as ue,m as pe,f as R,h as U,aJ as ge,_ as B,N as O,P as fe,q as je}from"./index-CNxWMcuV.js";import{D as be,b as Ne,c as ye,d as ve}from"./dialog-CIS6byhQ.js";import{u as we}from"./use-toast-C9pXjDz0.js";import{A as ke}from"./arrow-left-5j_RihUX.js";import{C as Ce}from"./circle-check-big-a_8kXWWc.js";import{L as Se}from"./log-out-S8-RmR1F.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=S("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=S("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=S("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=S("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=S("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);var P="Switch",[_e,ze]=ae(P),[Ae,Te]=_e(P),G=i.forwardRef((a,m)=>{const{__scopeSwitch:t,name:h,checked:x,defaultChecked:j,required:o,disabled:d,value:p="on",onCheckedChange:g,form:u,...b}=a,[N,y]=i.useState(null),n=z(m,w=>y(w)),v=i.useRef(!1),M=N?u||!!N.closest("form"):!0,[f,_]=ne({prop:x,defaultProp:j??!1,onChange:g,caller:P});return e.jsxs(Ae,{scope:t,checked:f,disabled:d,children:[e.jsx(F.button,{type:"button",role:"switch","aria-checked":f,"aria-required":o,"data-state":W(f),"data-disabled":d?"":void 0,disabled:d,value:p,...b,ref:n,onClick:ie(a.onClick,w=>{_(k=>!k),M&&(v.current=w.isPropagationStopped(),v.current||w.stopPropagation())})}),M&&e.jsx($,{control:N,bubbles:!v.current,name:h,value:p,checked:f,required:o,disabled:d,form:u,style:{transform:"translateX(-100%)"}})]})});G.displayName=P;var X="SwitchThumb",Z=i.forwardRef((a,m)=>{const{__scopeSwitch:t,...h}=a,x=Te(X,t);return e.jsx(F.span,{"data-state":W(x.checked),"data-disabled":x.disabled?"":void 0,...h,ref:m})});Z.displayName=X;var De="SwitchBubbleInput",$=i.forwardRef(({__scopeSwitch:a,control:m,checked:t,bubbles:h=!0,...x},j)=>{const o=i.useRef(null),d=z(o,j),p=re(t),g=le(m);return i.useEffect(()=>{const u=o.current;if(!u)return;const b=window.HTMLInputElement.prototype,y=Object.getOwnPropertyDescriptor(b,"checked").set;if(p!==t&&y){const n=new Event("click",{bubbles:h});y.call(u,t),u.dispatchEvent(n)}},[p,t,h]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:t,...x,tabIndex:-1,ref:d,style:{...x.style,...g,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});$.displayName=De;function W(a){return a?"checked":"unchecked"}var Y=G,He=Z;const c=i.forwardRef(({className:a,...m},t)=>e.jsx(Y,{className:D("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",a),...m,ref:t,children:e.jsx(He,{className:D("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));c.displayName=Y.displayName;function Fe(){var T;const{user:a,logout:m}=ce(),{t,language:h,setLanguage:x}=oe(),j=de(),{toast:o}=we(),d=i.useRef(null),[p,g]=i.useState(!1),[u,b]=i.useState(!1);i.useEffect(()=>{if(window.matchMedia("(display-mode: standalone)").matches){g(!0);return}const s=r=>{r.preventDefault(),d.current=r};return window.addEventListener("beforeinstallprompt",s),window.addEventListener("appinstalled",()=>g(!0)),()=>window.removeEventListener("beforeinstallprompt",s)},[]);const N=async()=>{const s=window.__pwaInstallPrompt||d.current;if(s)try{await s.prompt();const{outcome:r}=await s.userChoice;r==="accepted"&&(window.__pwaInstallPrompt=null,d.current=null,g(!0));return}catch{}o({title:t("settings.installAndroid"),description:t("settings.androidInstallFallback"),duration:8e3})},y=()=>{b(!0)},[n,v]=i.useState(null),[M,f]=i.useState(!0),[_,w]=i.useState({totalCompleted:0,activeJobs:0,waitingParts:0,completionRate:0}),[k,K]=i.useState(()=>{const s=localStorage.getItem("theme");return s?s==="dark":window.matchMedia("(prefers-color-scheme: dark)").matches});i.useEffect(()=>{const s=document.documentElement;k?(s.classList.add("dark"),localStorage.setItem("theme","dark")):(s.classList.remove("dark"),localStorage.setItem("theme","light"))},[k]),i.useEffect(()=>{a!=null&&a.id&&(A(),a.role==="mechanic"&&Q())},[a==null?void 0:a.id,a==null?void 0:a.role]);const A=async()=>{try{f(!0);const s=await me(a.id);v(s)}catch(s){console.error("Error loading settings:",s),o({title:t("common.error"),description:t("settings.failedToLoad"),variant:"destructive"})}finally{f(!1)}},Q=async()=>{try{const s=await he(a.id),r=s.filter(C=>C.status==="completed"),q=s.filter(C=>C.status==="in_progress"),se=s.filter(C=>C.status==="waiting_for_parts"),te=s.length>0?Math.round(r.length/s.length*100):0;w({totalCompleted:r.length,activeJobs:q.length,waitingParts:se.length,completionRate:te})}catch(s){console.error("Error loading mechanic stats:",s)}},l=async(s,r)=>{if(!(!(a!=null&&a.id)||!n))try{v({...n,[s]:r}),await je(a.id,{[s]:r}),o({title:t("settings.updated"),description:t("settings.savedSuccess")})}catch(q){console.error("Error updating settings:",q),o({title:t("common.error"),description:t("settings.updateFailed"),variant:"destructive"}),A()}},V=()=>{m(),j("/auth")},ee=s=>s.split(" ").map(r=>r[0]).join("").toUpperCase().slice(0,2);return H.find(s=>s.code===h),e.jsxs("div",{className:"safe-top",children:[e.jsxs("div",{className:"px-4 pt-4 pb-4 flex items-center gap-3",children:[(a==null?void 0:a.role)==="office_staff"&&e.jsx(J,{variant:"ghost",size:"icon",onClick:()=>j("/office"),children:e.jsx(ke,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-2xl font-bold",children:t("nav.settings")})]}),e.jsx("div",{className:"px-4 mb-6",children:e.jsx(I,{children:e.jsx(E,{className:"pt-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(xe,{className:"h-16 w-16",children:[(a==null?void 0:a.email)&&L(a.email)&&e.jsx(ue,{src:L(a.email),alt:a.fullName}),e.jsx(pe,{className:"text-lg bg-primary text-primary-foreground",children:a!=null&&a.fullName?ee(a.fullName):"U"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:a==null?void 0:a.fullName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a==null?void 0:a.email}),e.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:(T=a==null?void 0:a.role)==null?void 0:T.replace("_"," ")})]}),p?e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center",children:e.jsx(Ce,{className:"h-5 w-5 text-emerald-600"})}),e.jsx("span",{className:"text-[10px] text-emerald-600 font-medium",children:t("settings.installed")})]}):e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("button",{onClick:N,className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg bg-[#3ddc84]/10 border border-[#3ddc84]/40 hover:bg-[#3ddc84]/20 transition-colors",title:"Install on Android",children:[e.jsx("img",{src:"/iconsimages/androidicon.png",alt:"Android",className:"h-4 w-4 object-contain"}),e.jsx("span",{className:"text-[10px] font-semibold text-[#3ddc84]",children:t("settings.installAndroid")})]}),e.jsxs("button",{onClick:y,className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",title:"Install on iPhone / iPad",children:[e.jsx("svg",{viewBox:"0 0 24 24",className:"h-4 w-4 fill-gray-700 dark:fill-gray-300",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.8-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"})}),e.jsx("span",{className:"text-[10px] font-semibold text-gray-700 dark:text-gray-300",children:t("settings.installIOS")})]})]})]})})})}),e.jsxs("div",{className:"px-4 space-y-4",children:[e.jsxs(I,{children:[e.jsx(R,{className:"pb-2",children:e.jsxs(U,{className:"text-base flex items-center gap-2",children:[e.jsx(Ie,{className:"h-5 w-5"}),t("settings.language")]})}),e.jsx(E,{className:"pt-0",children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:H.map(s=>e.jsxs("button",{onClick:()=>x(s.code),className:`flex items-center gap-2 p-3 rounded-lg border-2 transition-all ${h===s.code?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,children:[e.jsx(ge,{code:s.code,size:"md"}),e.jsx("span",{className:"font-medium text-sm",children:s.label})]},s.code))})})]}),e.jsx(I,{children:e.jsx(E,{className:"pt-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[k?e.jsx(Ee,{className:"h-5 w-5 text-violet-400"}):e.jsx(qe,{className:"h-5 w-5 text-amber-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:t("settings.darkMode")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("settings.darkModeDesc")})]})]}),e.jsx(c,{checked:k,onCheckedChange:K})]})})}),e.jsxs(I,{children:[e.jsx(R,{className:"pb-2",children:e.jsxs(U,{className:"text-base flex items-center gap-2",children:[e.jsx(Me,{className:"h-5 w-5"}),t("settings.notificationPreferences")]})}),e.jsx(E,{className:"pt-0",children:M?e.jsx("div",{className:"py-4 text-center text-muted-foreground",children:t("common.loading")}):n?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsx("label",{className:"text-sm font-medium",children:t("settings.notifyJobCreated")})}),e.jsx(c,{checked:n.notifyJobCreated??!0,onCheckedChange:s=>l("notifyJobCreated",s)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsx("label",{className:"text-sm font-medium",children:t("settings.notifyJobAssigned")})}),e.jsx(c,{checked:n.notifyJobAssigned??!0,onCheckedChange:s=>l("notifyJobAssigned",s)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsx("label",{className:"text-sm font-medium",children:t("settings.notifyJobStatusChanged")})}),e.jsx(c,{checked:n.notifyJobStatusChanged??!0,onCheckedChange:s=>l("notifyJobStatusChanged",s)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsx("label",{className:"text-sm font-medium",children:t("settings.notifyJobCompleted")})}),e.jsx(c,{checked:n.notifyJobCompleted??!0,onCheckedChange:s=>l("notifyJobCompleted",s)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsx("label",{className:"text-sm font-medium",children:t("settings.notifyNewMessage")})}),e.jsx(c,{checked:n.notifyNewMessage??!0,onCheckedChange:s=>l("notifyNewMessage",s)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsx("label",{className:"text-sm font-medium",children:t("settings.notifyPartsStatusChanged")})}),e.jsx(c,{checked:n.notifyPartsStatusChanged??!0,onCheckedChange:s=>l("notifyPartsStatusChanged",s)})]}),e.jsxs("div",{className:"pt-4 mt-4 border-t",children:[e.jsx("h4",{className:"text-sm font-semibold mb-3",children:t("settings.smartNotifications")}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("label",{className:"text-sm font-medium",children:t("settings.urgentJobsOnly")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("settings.urgentJobsOnlyDesc")})]}),e.jsx(c,{checked:n.notifyUrgentOnly??!1,onCheckedChange:s=>l("notifyUrgentOnly",s)})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("label",{className:"text-sm font-medium",children:t("settings.quietHours")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("settings.quietHoursDesc")})]}),e.jsx(c,{checked:n.quietHoursEnabled??!1,onCheckedChange:s=>l("quietHoursEnabled",s)})]}),n.quietHoursEnabled&&e.jsxs("div",{className:"ml-4 mb-4 space-y-3 p-3 bg-secondary/30 rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(B,{htmlFor:"quietStart",className:"text-xs",children:t("settings.startTime")}),e.jsx(O,{id:"quietStart",type:"time",value:n.quietHoursStart||"22:00",onChange:s=>l("quietHoursStart",s.target.value),className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(B,{htmlFor:"quietEnd",className:"text-xs",children:t("settings.endTime")}),e.jsx(O,{id:"quietEnd",type:"time",value:n.quietHoursEnd||"08:00",onChange:s=>l("quietHoursEnd",s.target.value),className:"h-9"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("label",{className:"text-xs font-medium",children:t("settings.allowUrgentNotifications")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("settings.allowUrgentNotificationsDesc")})]}),e.jsx(c,{checked:n.quietHoursIgnoreUrgent??!1,onCheckedChange:s=>l("quietHoursIgnoreUrgent",s)})]})]})]})]}):null})]}),e.jsxs(J,{variant:"destructive",className:"w-full h-12",onClick:V,children:[e.jsx(Se,{className:"mr-2 h-5 w-5"}),t("settings.logout")]})]}),e.jsx(be,{open:u,onOpenChange:b,children:e.jsxs(Ne,{className:"max-w-sm mx-4",children:[e.jsx(ye,{children:e.jsxs(ve,{className:"flex items-center gap-2",children:[e.jsx("svg",{viewBox:"0 0 24 24",className:"h-5 w-5 fill-gray-700 dark:fill-gray-300",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.8-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"})}),t("settings.iosInstallTitle")]})}),e.jsxs("div",{className:"space-y-1 pb-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-4",children:t("settings.iosInstallDesc")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-xs font-bold text-primary",children:"1"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:t("settings.iosStep1Title")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("settings.iosStep1Desc")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-xs font-bold text-primary",children:"2"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:t("settings.iosStep2Title")}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t("settings.iosStep2Desc")," ",e.jsx(Pe,{className:"inline h-3 w-3"})]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-xs font-bold text-primary",children:"3"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:t("settings.iosStep3Title")}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t("settings.iosStep3Desc")," ",e.jsx(fe,{className:"inline h-3 w-3"})]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-xs font-bold text-primary",children:"4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:t("settings.iosStep4Title")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("settings.iosStep4Desc")})]})]})]})]})]})})]})}export{Fe as default};
