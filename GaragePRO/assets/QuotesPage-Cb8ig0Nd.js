import{o as X,u as _,d as W,r,s as o,j as e,e as g,f as N,h as v,i as b,N as Y,K as Z,B as ee,M as te,aQ as se}from"./index-CNxWMcuV.js";import{g as E,a as M,s as ae,d as re}from"./quoteService-j1Naoogm.js";import{R as oe,c as le}from"./invoiceService-B8qPXtsv.js";import{g as ne}from"./companySettingsService-BheHf_-3.js";import{p as T}from"./pdfGenerator-DtjVo1jc.js";import{S as ie}from"./SendQuoteModal-DK7bLIAq.js";import{u as ce,P as de}from"./Pagination-r2zL6nJ4.js";import{S as me,a as xe,b as ue,c as he,d as c}from"./select-CbHlLrev.js";import{D as pe,a as je,E as fe,b as ge,c as x,d as k}from"./dropdown-menu-B4ssD23R.js";import{F as y}from"./file-text-_cJWw5Fx.js";import{S as Ne}from"./search-vDLcJ1l5.js";import{E as ve}from"./euro-JmB74vkB.js";import{E as L}from"./eye-Dbr3NOu6.js";import{D as be}from"./download-CwOjd3gN.js";import{P as ye}from"./printer-BEYF_3-0.js";import{S as we}from"./send-DWCkg-NG.js";import{C as Se}from"./circle-check-big-a_8kXWWc.js";import{C as Ce}from"./circle-x-BOYVvd45.js";import{T as Pe}from"./triangle-alert-CHSZJu74.js";import{T as De}from"./trending-up-B_lHtIZL.js";import{f as q}from"./format-DSNd7y_7.js";import"./textarea-D6buyuls.js";import"./dialog-CIS6byhQ.js";import"./external-link-ChWnHVz5.js";import"./chevron-down-n_8xVDCk.js";const A={draft:{label:"Draft",color:"bg-gray-100 text-gray-800",icon:y},sent:{label:"Sent",color:"bg-blue-100 text-blue-800",icon:we},viewed:{label:"Viewed",color:"bg-purple-100 text-purple-800",icon:L},approved:{label:"Approved",color:"bg-green-100 text-green-800",icon:Se},rejected:{label:"Rejected",color:"bg-red-100 text-red-800",icon:Ce},expired:{label:"Expired",color:"bg-amber-100 text-amber-800",icon:Pe},converted:{label:"Converted",color:"bg-emerald-100 text-emerald-800",icon:De}};function et(){const{user:l}=X(),{t:s}=_(),w=W(),[S,C]=r.useState([]),[z,P]=r.useState(!0),[p,B]=r.useState(""),[u,O]=r.useState("all"),[h,D]=r.useState(null),[U,J]=r.useState(!1),[F,Fe]=r.useState(null),[j,Q]=r.useState(null),R=r.useMemo(()=>{let t=[...S];if(p){const a=p.toLowerCase();t=t.filter(i=>i.quoteNumber.toLowerCase().includes(a)||i.customer.name.toLowerCase().includes(a)||i.vehicle.licensePlate.toLowerCase().includes(a))}return u&&u!=="all"&&(t=t.filter(a=>a.status===u)),t},[S,p,u]),n=ce(R,15);r.useEffect(()=>{f()},[]);const f=async()=>{try{P(!0);const[t,a,i]=await Promise.all([E(),M(),ne()]),d=t.filter(m=>m.status==="sent"||m.status==="viewed");if(l&&d.length>0&&(await Promise.all(d.map(m=>ae(m.id,l.id))),d.length>0)){const[m,K]=await Promise.all([E(),M()]);C(m),D(K),Q(i);return}C(t),D(a),Q(i)}catch(t){console.error("Error loading quotes:",t),o.error("Failed to load quotes")}finally{P(!1)}},V=async t=>{if(l&&confirm("Are you sure you want to delete this draft quote?"))try{await re(t,l.id),o.success("Quote deleted"),f()}catch(a){console.error("Error deleting quote:",a),o.error(a.message||"Failed to delete quote")}},$=async t=>{if(l)try{await le(t,l.id),o.success("Invoice created successfully"),f()}catch(a){console.error("Error creating invoice:",a),o.error(a.message||"Failed to create invoice")}},I=async t=>{try{return await se(t.jobId)||void 0}catch{return}},H=async t=>{if(!j){o.error("Company settings not configured");return}try{const a=await I(t);await T(t,j,a)}catch(a){console.error("Error downloading PDF:",a),o.error("Failed to download PDF")}},G=async t=>{if(!j){o.error("Company settings not configured");return}try{const a=await I(t);await T(t,j,a)}catch(a){console.error("Error printing PDF:",a),o.error("Failed to print PDF")}};return z?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(y,{className:"h-8 w-8 text-primary"}),s("quotes.title")]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:s("quotes.subtitle")})]}),h&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[e.jsxs(g,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(v,{className:"text-sm font-medium text-muted-foreground",children:s("common.total")})}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold",children:h.total})})]}),e.jsxs(g,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(v,{className:"text-sm font-medium text-muted-foreground",children:s("quotes.draft")})}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:h.draft})})]}),e.jsxs(g,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(v,{className:"text-sm font-medium text-muted-foreground",children:s("quotes.sent")})}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:h.sent})})]}),e.jsxs(g,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(v,{className:"text-sm font-medium text-muted-foreground",children:s("quotes.approved")})}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:h.approved})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"relative flex-1 min-w-[300px]",children:[e.jsx(Ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Y,{placeholder:s("quotes.searchPlaceholder"),value:p,onChange:t=>B(t.target.value),className:"pl-10"})]}),e.jsxs(me,{value:u,onValueChange:O,children:[e.jsx(xe,{className:"w-[180px]",children:e.jsx(ue,{placeholder:s("quotes.allStatuses")})}),e.jsxs(he,{children:[e.jsx(c,{value:"all",children:s("quotes.allStatuses")}),e.jsx(c,{value:"draft",children:s("quotes.draft")}),e.jsx(c,{value:"sent",children:s("quotes.sent")}),e.jsx(c,{value:"viewed",children:s("quotes.viewed")}),e.jsx(c,{value:"approved",children:s("quotes.approved")}),e.jsx(c,{value:"rejected",children:s("quotes.rejected")}),e.jsx(c,{value:"expired",children:s("quotes.expired")})]})]})]}),e.jsxs("div",{className:"rounded-lg border",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:s("quotes.quoteNumber")}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:s("common.customer")}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:s("jobs.vehicle")}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium",children:s("common.amount")}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium",children:s("common.status")}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:s("quotes.validUntil")}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:s("common.created")}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium",children:s("common.actions")})]})}),e.jsx("tbody",{className:"divide-y",children:n.paginatedItems.map(t=>{const a=A[t.status]||A.draft,i=a.icon,d=new Date(t.validUntil)<new Date&&t.status==="sent";return e.jsxs("tr",{className:"hover:bg-muted/30",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-mono font-medium",children:t.quoteNumber})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.customer.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.customer.phone})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[t.vehicle.brand," ",t.vehicle.model]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.vehicle.licensePlate})]})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsxs("div",{className:"flex items-center justify-end gap-1 font-semibold",children:[e.jsx(ve,{className:"h-4 w-4"}),t.grandTotal.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.lineItems.length," item",t.lineItems.length!==1?"s":""]})]}),e.jsxs("td",{className:"px-4 py-3 text-center",children:[e.jsxs(Z,{className:`${a.color} flex items-center gap-1 w-fit mx-auto`,children:[e.jsx(i,{className:"h-3 w-3"}),a.label]}),d&&e.jsx("span",{className:"text-xs text-amber-600 block mt-1",children:"Expired"})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:d?"text-amber-600":"",children:q(new Date(t.validUntil),"dd MMM yyyy")})}),e.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground",children:q(new Date(t.createdAt),"dd MMM yyyy")}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs(pe,{children:[e.jsx(je,{asChild:!0,children:e.jsx(ee,{variant:"ghost",size:"icon",children:e.jsx(fe,{className:"h-4 w-4"})})}),e.jsxs(ge,{align:"end",children:[e.jsxs(x,{onClick:()=>w(`/quotes/${t.id}`),children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),s("quotes.viewQuote")]}),e.jsxs(x,{onClick:()=>w(`/jobs/${t.jobId}`),children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),s("quotes.viewJob")]}),e.jsxs(x,{onClick:()=>H(t),children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),s("quotes.downloadPDF")]}),e.jsxs(x,{onClick:()=>G(t),children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),s("quotes.printQuote")]}),t.status==="draft"&&e.jsxs(e.Fragment,{children:[e.jsx(k,{}),e.jsxs(x,{className:"text-destructive",onClick:()=>V(t.id),children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),s("common.delete")]})]}),t.status==="approved"&&e.jsxs(e.Fragment,{children:[e.jsx(k,{}),e.jsxs(x,{onClick:()=>$(t.id),children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),s("quotes.createInvoice")]})]})]})]})})]},t.id)})})]})}),n.totalItems===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(y,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:s("quotes.noQuotesFound")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s("quotes.createFromJob")})]}),e.jsx("div",{className:"border-t px-4",children:e.jsx(de,{currentPage:n.currentPage,totalPages:n.totalPages,totalItems:n.totalItems,pageSize:n.pageSize,onPageChange:n.onPageChange,onPageSizeChange:n.onPageSizeChange,pageSizeOptions:[10,15,25,50]})})]}),F&&l&&e.jsx(ie,{quote:F,open:U,onOpenChange:J,onSent:f,userId:l.id})]})}export{et as QuotesPage};
