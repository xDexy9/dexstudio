import{bB as c,bP as i,bC as l}from"./index-CNxWMcuV.js";const Q=e=>{const t=e.quantity*e.unitPrice,a=t*(e.discount/100),n=(t-a)*e.taxRate,s=t-a+n;return{...e,subtotal:t,discountAmount:a,taxAmount:n,total:s}},f=e=>{const t=e.reduce((u,o)=>u+o.subtotal,0),a=e.reduce((u,o)=>u+o.discountAmount,0),n=e.reduce((u,o)=>u+o.taxAmount,0),s=e.reduce((u,o)=>u+o.total,0);return{subtotal:t,discountTotal:a,taxTotal:n,grandTotal:s}},p=async(e,t,a,n)=>{const s=c.jobs.find(r=>r.id===e),u=c.customers.find(r=>r.id===(s==null?void 0:s.customerId));c.vehicles.find(r=>r.id===(s==null?void 0:s.vehicleId));const o=f(t);return g({jobId:e,customerId:s==null?void 0:s.customerId,vehicleId:s==null?void 0:s.vehicleId,customer:{name:(s==null?void 0:s.customerName)||"",phone:(s==null?void 0:s.customerPhone)||"",email:u==null?void 0:u.email},vehicle:{brand:(s==null?void 0:s.vehicleBrand)||"",model:(s==null?void 0:s.vehicleModel)||"",year:(s==null?void 0:s.vehicleYear)||0,licensePlate:(s==null?void 0:s.vehicleLicensePlate)||""},lineItems:t,...o,currency:"EUR",status:"draft",validUntil:new Date(Date.now()+30*864e5).toISOString(),notes:n==null?void 0:n.notes,termsAndConditions:n==null?void 0:n.termsAndConditions,laborHours:n==null?void 0:n.laborHours,laborRate:n==null?void 0:n.laborRate},a)},d=()=>new Date().toISOString(),g=async(e,t)=>{const a=i(),n=c.companySettings.nextQuoteNumber;c.companySettings.nextQuoteNumber++;const s=`${c.companySettings.quotePrefix}-${new Date().getFullYear()}-${String(n).padStart(3,"0")}`,u=i();return c.quotes.push({id:a,quoteNumber:s,publicToken:u,createdAt:d(),updatedAt:d(),createdBy:t,updatedBy:t,...e}),l(),a},x=async e=>c.quotes.find(t=>t.id===e)||null,y=async e=>c.quotes.find(t=>t.publicToken===e)||null,m=async e=>c.quotes.filter(t=>t.jobId===e),T=async()=>[...c.quotes].sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()),q=async(e,t,a)=>{const n=c.quotes.findIndex(s=>s.id===e);n!==-1&&(c.quotes[n]={...c.quotes[n],status:"approved",approvedAt:d(),signatureDataUrl:t,signatureTimestamp:d(),updatedAt:d()},l())},v=async e=>{const t=c.quotes.findIndex(a=>a.id===e);t!==-1&&(c.quotes[t]={...c.quotes[t],status:"rejected",rejectedAt:d(),updatedAt:d()},l())},h=async(e,t)=>{const a=c.quotes.findIndex(n=>n.id===e);a!==-1&&(c.quotes[a]={...c.quotes[a],status:"sent",sentAt:d(),updatedAt:d(),updatedBy:t},l())},w=async e=>{const t=c.quotes.findIndex(a=>a.id===e);t!==-1&&(c.quotes.splice(t,1),l())},I=async(e,t)=>h(e,t),S=async()=>{const e=c.quotes;return{total:e.length,draft:e.filter(t=>t.status==="draft").length,sent:e.filter(t=>t.status==="sent").length,viewed:e.filter(t=>t.status==="viewed").length,approved:e.filter(t=>t.status==="approved").length,rejected:e.filter(t=>t.status==="rejected").length,totalValue:e.reduce((t,a)=>t+a.grandTotal,0),approvedValue:e.filter(t=>t.status==="approved").reduce((t,a)=>t+a.grandTotal,0)}},B=async(e,t)=>{},P=e=>m(e),k=async(e,t)=>{const a=await y(e);a&&await q(a.id,t)},D=async e=>{const t=await y(e);t&&await v(t.id)};export{S as a,x as b,P as c,w as d,Q as e,f,T as g,p as h,y as i,k as j,I as m,D as r,B as s};
