import{c as J,aD as je,r as n,j as e,E as Q,e as o,i as d,f as C,h as k,bf as pe,K,$ as fe,B as l,Z,ap as ge,_ as Ne,N as ve,s as h}from"./index-CNxWMcuV.js";import{i as ye,j as we,r as be}from"./quoteService-j1Naoogm.js";import{T as Ce}from"./textarea-D6buyuls.js";import{D as P,b as F,c as A,d as U,e as B,f as I}from"./dialog-CIS6byhQ.js";import{T as ke}from"./triangle-alert-CHSZJu74.js";import{F as Se}from"./file-text-_cJWw5Fx.js";import{C as L}from"./circle-check-big-a_8kXWWc.js";import{C as Y}from"./circle-x-BOYVvd45.js";import{C as De}from"./car-DWakAuoX.js";import{C as qe}from"./calendar-BxIrFUaJ.js";import{E as j}from"./euro-JmB74vkB.js";import{P as Te}from"./printer-BEYF_3-0.js";import{f as _}from"./format-DSNd7y_7.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=J("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=J("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);function He(){const{token:m}=je(),[t,ee]=n.useState(null),[se,S]=n.useState(!0),[z,f]=n.useState(null),[g,N]=n.useState(!1),[te,v]=n.useState(!1),[D,X]=n.useState(null),p=n.useRef(null),[ae,W]=n.useState(!1),[re,y]=n.useState(!1),[H,ne]=n.useState(""),[le,w]=n.useState(!1),[b,O]=n.useState(""),[q,ie]=n.useState(!1);n.useEffect(()=>{T()},[m]);const T=async()=>{var s;if(!m){f("Invalid quote link"),S(!1);return}try{S(!0);const a=await ye(m);if(!a){f("Quote not found or has been deleted");return}if(new Date(a.validUntil)<new Date&&a.status==="sent"){f("This quote has expired");return}ee(a),(s=a.customer)!=null&&s.email&&O(a.customer.email)}catch(a){console.error("Error loading quote:",a),f("Failed to load quote")}finally{S(!1)}},V=s=>{const a=p.current;if(!a)return;W(!0);const i=a.getContext("2d");if(!i)return;const c=a.getBoundingClientRect();let x,u;"touches"in s?(x=s.touches[0].clientX-c.left,u=s.touches[0].clientY-c.top):(x=s.clientX-c.left,u=s.clientY-c.top),i.beginPath(),i.moveTo(x,u)},$=s=>{if(!ae)return;const a=p.current;if(!a)return;const i=a.getContext("2d");if(!i)return;const c=a.getBoundingClientRect();let x,u;"touches"in s?(s.preventDefault(),x=s.touches[0].clientX-c.left,u=s.touches[0].clientY-c.top):(x=s.clientX-c.left,u=s.clientY-c.top),i.lineWidth=2,i.lineCap="round",i.strokeStyle="#000",i.lineTo(x,u),i.stroke()},E=()=>{W(!1),ce()},ce=()=>{const s=p.current;if(!s)return;const a=s.toDataURL("image/png");X(a)},oe=()=>{const s=p.current;if(!s)return;const a=s.getContext("2d");a&&(a.clearRect(0,0,s.width,s.height),X(null))},de=async()=>{if(!(!t||!D||!m))try{N(!0),await we(m,D),h.success("Quote approved successfully!"),v(!1),T()}catch(s){console.error("Error approving quote:",s),h.error(s.message||"Failed to approve quote")}finally{N(!1)}},me=async()=>{if(!(!t||!m))try{N(!0),await be(m,H),h.success("Quote rejected"),y(!1),T()}catch(s){console.error("Error rejecting quote:",s),h.error(s.message||"Failed to reject quote")}finally{N(!1)}},xe=()=>{h.info("Print request sent. The garage will prepare a printed copy for you.")},ue=()=>{!b||!q||(h.success(`A copy will be sent to ${b}`),w(!1))},r=t==null?void 0:t.company;if(se)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Q,{className:"h-8 w-8 animate-spin mx-auto text-primary"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading quote..."})]})});if(z||!t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:e.jsx(o,{className:"max-w-md w-full",children:e.jsxs(d,{className:"pt-6 text-center",children:[e.jsx(ke,{className:"h-12 w-12 text-amber-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Quote Unavailable"}),e.jsx("p",{className:"text-muted-foreground",children:z||"Quote not found"})]})})});const R=t.status==="approved"||t.status==="converted",M=t.status==="rejected",G=t.status==="expired",he=t.status==="sent"||t.status==="viewed";return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[r&&e.jsxs("div",{className:"text-center mb-8",children:[r.logoUrl?e.jsx("img",{src:r.logoUrl,alt:r.companyName,className:"h-16 mx-auto mb-4"}):e.jsx("div",{className:"h-16 w-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Se,{className:"h-8 w-8 text-primary"})}),e.jsx("h1",{className:"text-2xl font-bold",children:r.companyName}),r.address&&e.jsxs("p",{className:"text-muted-foreground text-sm mt-1",children:[r.address.street,", ",r.address.city]})]}),R&&e.jsx(o,{className:"bg-green-50 border-green-200",children:e.jsxs(d,{className:"py-4 flex items-center gap-3",children:[e.jsx(L,{className:"h-6 w-6 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-800",children:"Quote Approved"}),e.jsx("p",{className:"text-sm text-green-600",children:"Thank you for approving this quote. Work will begin shortly."})]})]})}),M&&e.jsx(o,{className:"bg-red-50 border-red-200",children:e.jsxs(d,{className:"py-4 flex items-center gap-3",children:[e.jsx(Y,{className:"h-6 w-6 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-800",children:"Quote Rejected"}),e.jsx("p",{className:"text-sm text-red-600",children:"This quote has been rejected. Please contact us if you have questions."})]})]})}),e.jsxs(o,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(k,{className:"text-xl",children:["Quote ",t.quoteNumber]}),e.jsxs(pe,{children:["Issued: ",_(new Date(t.issueDate),"dd MMM yyyy")]})]}),e.jsx(K,{className:R?"bg-green-100 text-green-800":M?"bg-red-100 text-red-800":G?"bg-amber-100 text-amber-800":"bg-blue-100 text-blue-800",children:R?"Approved":M?"Rejected":G?"Expired":"Pending"})]})}),e.jsxs(d,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(fe,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.customer.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.customer.phone}),t.customer.email&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t.customer.email})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(De,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[t.vehicle.brand," ",t.vehicle.model," (",t.vehicle.year,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.vehicle.licensePlate}),t.vehicle.vin&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["VIN: ",t.vehicle.vin]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(qe,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["Valid until: ",_(new Date(t.validUntil),"dd MMM yyyy")]})]})]})]}),e.jsxs(o,{children:[e.jsx(C,{children:e.jsx(k,{children:"Work Items"})}),e.jsxs(d,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium",children:"Description"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-medium",children:"Qty"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-medium",children:"Price"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-medium",children:"Total"})]})}),e.jsx("tbody",{className:"divide-y",children:t.lineItems.map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.description}),e.jsx(K,{variant:"outline",className:"mt-1 text-xs",children:s.type==="part"?"Part":"Service"})]})}),e.jsx("td",{className:"px-4 py-3 text-right",children:s.quantity}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx(j,{className:"h-3 w-3 inline mr-0.5"}),s.unitPrice.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right font-medium",children:[e.jsx(j,{className:"h-3 w-3 inline mr-0.5"}),s.total.toFixed(2)]})]},a))})]})}),e.jsxs("div",{className:"mt-6 border-t pt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e.jsxs("span",{children:[e.jsx(j,{className:"h-3 w-3 inline mr-0.5"}),t.subtotal.toFixed(2)]})]}),t.discountTotal>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-",e.jsx(j,{className:"h-3 w-3 inline mr-0.5"}),t.discountTotal.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Tax"}),e.jsxs("span",{children:[e.jsx(j,{className:"h-3 w-3 inline mr-0.5"}),t.taxTotal.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t pt-2 mt-2",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"h-4 w-4"}),t.grandTotal.toFixed(2)]})]})]})]})]}),t.customerNotes&&e.jsxs(o,{children:[e.jsx(C,{children:e.jsx(k,{children:"Notes"})}),e.jsx(d,{children:e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:t.customerNotes})})]}),(r==null?void 0:r.termsAndConditions)&&e.jsxs(o,{children:[e.jsx(C,{children:e.jsx(k,{className:"text-sm",children:"Terms & Conditions"})}),e.jsx(d,{children:e.jsx("p",{className:"text-xs text-muted-foreground whitespace-pre-wrap",children:r.termsAndConditions})})]}),he&&e.jsx(o,{children:e.jsxs(d,{className:"py-6",children:[e.jsx("p",{className:"text-center text-muted-foreground mb-4",children:"Please review the quote above and approve or reject it."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(l,{size:"lg",className:"gap-2",onClick:()=>v(!0),children:[e.jsx(L,{className:"h-5 w-5"}),"Approve Quote"]}),e.jsxs(l,{size:"lg",variant:"outline",className:"gap-2",onClick:()=>y(!0),children:[e.jsx(Y,{className:"h-5 w-5"}),"Reject Quote"]})]})]})}),e.jsx(o,{children:e.jsxs(d,{className:"py-4",children:[e.jsx("p",{className:"text-center text-sm text-muted-foreground mb-3",children:"Need a copy of this quote?"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center",children:[e.jsxs(l,{variant:"outline",size:"sm",className:"gap-2",onClick:xe,children:[e.jsx(Te,{className:"h-4 w-4"}),"Request Printed Copy"]}),e.jsxs(l,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>w(!0),children:[e.jsx(Z,{className:"h-4 w-4"}),"Email Me a Copy"]})]})]})}),e.jsxs("div",{className:"flex items-start gap-2 text-xs text-muted-foreground px-2",children:[e.jsx(ge,{className:"h-4 w-4 flex-shrink-0 mt-0.5"}),e.jsx("p",{children:"Your personal data is processed in accordance with GDPR. We only use your information to provide the requested service. Your signature and approval data are stored securely. You can request data deletion by contacting us."})]}),e.jsx(P,{open:te,onOpenChange:v,children:e.jsxs(F,{className:"sm:max-w-md",children:[e.jsxs(A,{children:[e.jsx(U,{children:"Sign to Approve"}),e.jsx(B,{children:"Please sign below to approve this quote. Your signature indicates acceptance of the work and pricing."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"border rounded-lg p-2 bg-white",children:e.jsx("canvas",{ref:p,width:350,height:150,className:"w-full border rounded cursor-crosshair touch-none",onMouseDown:V,onMouseMove:$,onMouseUp:E,onMouseLeave:E,onTouchStart:V,onTouchMove:$,onTouchEnd:E})}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(Re,{className:"h-4 w-4"}),"Draw your signature above"]}),e.jsxs(l,{variant:"ghost",size:"sm",onClick:oe,children:[e.jsx(Ee,{className:"h-4 w-4 mr-1"}),"Clear"]})]})]}),e.jsxs(I,{children:[e.jsx(l,{variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(l,{onClick:de,disabled:!D||g,children:g?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 mr-2 animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Approve Quote"]})})]})]})}),e.jsx(P,{open:re,onOpenChange:y,children:e.jsxs(F,{children:[e.jsxs(A,{children:[e.jsx(U,{children:"Reject Quote"}),e.jsx(B,{children:"Please let us know why you're rejecting this quote. This helps us improve our service."})]}),e.jsx(Ce,{placeholder:"Reason for rejection (optional)",value:H,onChange:s=>ne(s.target.value),rows:4}),e.jsxs(I,{children:[e.jsx(l,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsx(l,{variant:"destructive",onClick:me,disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 mr-2 animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Reject Quote"]})})]})]})}),e.jsx(P,{open:le,onOpenChange:w,children:e.jsxs(F,{className:"sm:max-w-md",children:[e.jsxs(A,{children:[e.jsx(U,{children:"Email a Copy"}),e.jsx(B,{children:"Enter your email address to receive a copy of this quote."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(Ne,{children:"Email Address"}),e.jsx(ve,{type:"email",placeholder:"your@email.com",value:b,onChange:s=>O(s.target.value)})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("input",{type:"checkbox",id:"email-consent",checked:q,onChange:s=>ie(s.target.checked),className:"mt-1"}),e.jsx("label",{htmlFor:"email-consent",className:"text-xs text-muted-foreground",children:"I consent to receiving this quote by email. My email will only be used for this purpose and will not be shared with third parties."})]})]}),e.jsxs(I,{children:[e.jsx(l,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsxs(l,{onClick:ue,disabled:!b||!q,children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Send Copy"]})]})]})}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground py-4",children:[e.jsx("p",{children:"Questions about this quote? Contact us at:"}),r&&e.jsxs("p",{className:"font-medium mt-1",children:[r.phone," | ",r.email]})]})]})})}export{He as QuoteApprovalPage};
