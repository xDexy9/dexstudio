import{c as he,r as w,g as se,j as n,a as Z,C as Ce,b as Be,X as Ue,u as H,d as F,e as I,f as $,h as J,B as O,i as B,k as je,S as ie,P as Ge,A as Fe,l as $e,m as Je,n as qe,o as ce,p as ee,q as ge,s as te,L as ke,t as Ve,v as Ye,w as Xe,x as Ke,y as Qe,z as Ze,D as et}from"./index-CNxWMcuV.js";import{S as xe,a as W}from"./stats-card-jYPMOKW6.js";import{g as ye}from"./jobTranslation-C42sppDK.js";import{L as be}from"./license-plate-BoT_Ewxe.js";import{C as Re}from"./car-brand-logo-BjPA7wLP.js";import{T as De}from"./trending-up-B_lHtIZL.js";import{B as Y}from"./briefcase-CQ_aZddD.js";import{T as tt}from"./triangle-alert-CHSZJu74.js";import{Z as st}from"./zap-DwLr8eAC.js";import{M as ze}from"./message-square-BrEHgpxS.js";import{U as it}from"./users-iVsLoBHZ.js";import{P as rt}from"./package-8-BxBKwT.js";import{P as nt,a as at,b as ot}from"./popover-Bn3nULpx.js";import{S as lt}from"./save-Ctp_DjlL.js";import{L as dt}from"./layout-grid-BWDaq3YL.js";import"./googleTranslate-BIF2yF35.js";import"./car-DWakAuoX.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=he("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=he("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=he("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=he("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);function Me({assignedMechanicId:d,mechanics:e,onAssign:t}){const[s,i]=w.useState(!1),r=w.useRef(null),a=w.useRef(null),[o,m]=w.useState({x:0,y:0}),u=d?e.find(f=>f.id===d):null;w.useEffect(()=>{if(!s||!r.current)return;const f=r.current.getBoundingClientRect();m({x:f.left+f.width/2,y:f.top+f.height/2})},[s]),w.useEffect(()=>{if(!s)return;const f=C=>{a.current&&!a.current.contains(C.target)&&r.current&&!r.current.contains(C.target)&&i(!1)};return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[s]);const l=f=>{f.stopPropagation(),i(!s)},h=(f,C)=>{f.stopPropagation(),t(C),i(!1)},g=u&&se(u.email)||void 0,p=e.filter(f=>!f.fullName.toLowerCase().includes("dexanu")&&!f.email.toLowerCase().includes("dexanu")),v=(f,C)=>{const j=-90+360/C*f,_=70,x=j*Math.PI/180;return{x:Math.cos(x)*_,y:Math.sin(x)*_}};return n.jsxs(n.Fragment,{children:[n.jsx("button",{ref:r,onClick:l,className:Z("relative w-9 h-9 rounded-full flex items-center justify-center transition-all duration-300 border-2",u?"border-primary/30 bg-primary/5 hover:border-primary/60":"border-destructive/50 bg-destructive/10 hover:border-destructive/80"),title:u?u.fullName:"Unassigned",children:u?g?n.jsx("img",{src:g,alt:u.fullName,className:"w-7 h-7 rounded-full object-cover"}):n.jsx("span",{className:"text-xs font-bold text-primary",children:u.fullName.split(" ").map(f=>f[0]).join("").slice(0,2)}):n.jsxs(n.Fragment,{children:[n.jsx(Ce,{className:"h-4 w-4 text-destructive"}),n.jsx("span",{className:"absolute inset-0 rounded-full border-2 border-destructive/60 animate-ping opacity-40"})]})}),s&&Be.createPortal(n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0",style:{zIndex:9998},onClick:f=>{f.stopPropagation(),i(!1)}}),n.jsxs("div",{ref:a,className:"fixed",style:{left:o.x,top:o.y,zIndex:9999},onClick:f=>f.stopPropagation(),children:[n.jsx("button",{onClick:f=>{f.stopPropagation(),i(!1)},className:"absolute w-10 h-10 rounded-full bg-background border-2 border-border shadow-lg flex items-center justify-center hover:bg-muted transition-colors",style:{left:-20,top:-20,zIndex:10},children:n.jsx(Ue,{className:"h-4 w-4 text-muted-foreground"})}),p.map((f,C)=>{const k=v(C,p.length),j=se(f.email),_=f.id===d;return n.jsxs("button",{onClick:x=>h(x,f.id),className:Z("absolute flex flex-col items-center gap-0.5 transition-all duration-300 group","animate-scale-in"),style:{left:k.x-24,top:k.y-24,animationDelay:`${C*50}ms`},children:[n.jsx("div",{className:Z("w-11 h-11 rounded-full flex items-center justify-center border-2 shadow-md transition-all","hover:scale-110 hover:shadow-lg",_?"border-primary bg-primary/10 ring-2 ring-primary/30":"border-border bg-background hover:border-primary/50"),children:j?n.jsx("img",{src:j,alt:f.fullName,className:"w-9 h-9 rounded-full object-cover"}):n.jsx("span",{className:"text-xs font-bold text-foreground",children:f.fullName.split(" ").map(x=>x[0]).join("").slice(0,2)})}),n.jsx("span",{className:Z("text-[10px] font-medium px-1.5 py-0.5 rounded-full whitespace-nowrap max-w-[80px] truncate","bg-background/95 shadow-sm border border-border/50",_?"text-primary font-bold":"text-foreground"),children:f.fullName.split(" ")[0]})]},f.id)})]})]}),document.body)]})}class c{static getElements(e,t=document){if(typeof e=="string"){const s="getElementById"in t?t:void 0;if(s&&!isNaN(+e[0])){const r=s.getElementById(e);return r?[r]:[]}let i=t.querySelectorAll(e);if(!i.length&&e[0]!=="."&&e[0]!=="#"&&(i=t.querySelectorAll("."+e),i.length||(i=t.querySelectorAll("#"+e)),!i.length)){const r=t.querySelector(`[gs-id="${e}"]`);return r?[r]:[]}return Array.from(i)}return[e]}static getElement(e,t=document){if(typeof e=="string"){const s="getElementById"in t?t:void 0;if(!e.length)return null;if(s&&e[0]==="#")return s.getElementById(e.substring(1));if(e[0]==="#"||e[0]==="."||e[0]==="[")return t.querySelector(e);if(s&&!isNaN(+e[0]))return s.getElementById(e);let i=t.querySelector(e);return s&&!i&&(i=s.getElementById(e)),i||(i=t.querySelector("."+e)),i}return e}static lazyLoad(e){var t,s;return e.lazyLoad||((s=(t=e.grid)==null?void 0:t.opts)==null?void 0:s.lazyLoad)&&e.lazyLoad!==!1}static createDiv(e,t){const s=document.createElement("div");return e.forEach(i=>{i&&s.classList.add(i)}),t==null||t.appendChild(s),s}static shouldSizeToContent(e,t=!1){return(e==null?void 0:e.grid)&&(t?e.sizeToContent===!0||e.grid.opts.sizeToContent===!0&&e.sizeToContent===void 0:!!e.sizeToContent||e.grid.opts.sizeToContent&&e.sizeToContent!==!1)}static isIntercepted(e,t){return!(e.y>=t.y+t.h||e.y+e.h<=t.y||e.x+e.w<=t.x||e.x>=t.x+t.w)}static isTouching(e,t){return c.isIntercepted(e,{x:t.x-.5,y:t.y-.5,w:t.w+1,h:t.h+1})}static areaIntercept(e,t){const s=e.x>t.x?e.x:t.x,i=e.x+e.w<t.x+t.w?e.x+e.w:t.x+t.w;if(i<=s)return 0;const r=e.y>t.y?e.y:t.y,a=e.y+e.h<t.y+t.h?e.y+e.h:t.y+t.h;return a<=r?0:(i-s)*(a-r)}static area(e){return e.w*e.h}static sort(e,t=1){return e.sort((i,r)=>{const a=t*((i.y??1e4)-(r.y??1e4));return a===0?t*((i.x??1e4)-(r.x??1e4)):a})}static find(e,t){return t?e.find(s=>s.id===t):void 0}static toBool(e){return typeof e=="boolean"?e:typeof e=="string"?(e=e.toLowerCase(),!(e===""||e==="no"||e==="false"||e==="0")):!!e}static toNumber(e){return e===null||e.length===0?void 0:Number(e)}static parseHeight(e){let t,s="px";if(typeof e=="string")if(e==="auto"||e==="")t=0;else{const i=e.match(/^(-[0-9]+\.[0-9]+|[0-9]*\.[0-9]+|-[0-9]+|[0-9]+)(px|em|rem|vh|vw|%|cm|mm)?$/);if(!i)throw new Error(`Invalid height val = ${e}`);s=i[2]||"px",t=parseFloat(i[1])}else t=e;return{h:t,unit:s}}static defaults(e,...t){return t.forEach(s=>{for(const i in s){if(!s.hasOwnProperty(i))return;e[i]===null||e[i]===void 0?e[i]=s[i]:typeof s[i]=="object"&&typeof e[i]=="object"&&c.defaults(e[i],s[i])}}),e}static same(e,t){if(typeof e!="object")return e==t;if(typeof e!=typeof t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}static copyPos(e,t,s=!1){return t.x!==void 0&&(e.x=t.x),t.y!==void 0&&(e.y=t.y),t.w!==void 0&&(e.w=t.w),t.h!==void 0&&(e.h=t.h),s&&(t.minW&&(e.minW=t.minW),t.minH&&(e.minH=t.minH),t.maxW&&(e.maxW=t.maxW),t.maxH&&(e.maxH=t.maxH)),e}static samePos(e,t){return e&&t&&e.x===t.x&&e.y===t.y&&(e.w||1)===(t.w||1)&&(e.h||1)===(t.h||1)}static sanitizeMinMax(e){e.minW||delete e.minW,e.minH||delete e.minH,e.maxW||delete e.maxW,e.maxH||delete e.maxH}static removeInternalAndSame(e,t){if(!(typeof e!="object"||typeof t!="object")&&!(Array.isArray(e)||Array.isArray(t)))for(let s in e){const i=e[s],r=t[s];s[0]==="_"||i===r?delete e[s]:i&&typeof i=="object"&&r!==void 0&&(c.removeInternalAndSame(i,r),Object.keys(i).length||delete e[s])}}static removeInternalForSave(e,t=!0){for(let s in e)(s[0]==="_"||e[s]===null||e[s]===void 0)&&delete e[s];delete e.grid,t&&delete e.el,e.autoPosition||delete e.autoPosition,e.noResize||delete e.noResize,e.noMove||delete e.noMove,e.locked||delete e.locked,(e.w===1||e.w===e.minW)&&delete e.w,(e.h===1||e.h===e.minH)&&delete e.h}static throttle(e,t){let s=!1;return(...i)=>{s||(s=!0,setTimeout(()=>{e(...i),s=!1},t))}}static removePositioningStyles(e){const t=e.style;t.position&&t.removeProperty("position"),t.left&&t.removeProperty("left"),t.top&&t.removeProperty("top"),t.width&&t.removeProperty("width"),t.height&&t.removeProperty("height")}static getScrollElement(e){if(!e)return document.scrollingElement||document.documentElement;const t=getComputedStyle(e);return/(auto|scroll)/.test(t.overflow+t.overflowY)?e:c.getScrollElement(e.parentElement)}static updateScrollPosition(e,t,s){const i=c.getScrollElement(e);if(!i)return;const r=e.getBoundingClientRect(),a=i.getBoundingClientRect(),o=window.innerHeight||document.documentElement.clientHeight,m=r.bottom-Math.min(a.bottom,o),u=r.top-Math.max(a.top,0),l=i.scrollTop;u<0&&s<0?e.offsetHeight>a.height?i.scrollTop+=s:i.scrollTop+=Math.abs(u)>Math.abs(s)?s:u:m>0&&s>0&&(e.offsetHeight>a.height?i.scrollTop+=s:i.scrollTop+=m>s?s:m),t.top+=i.scrollTop-l}static updateScrollResize(e,t,s){const i=c.getScrollElement(t),r=i.clientHeight,a=i===c.getScrollElement()?0:i.getBoundingClientRect().top,o=e.clientY-a,m=o<s,u=o>r-s;m?i.scrollBy({behavior:"smooth",top:o-s}):u&&i.scrollBy({behavior:"smooth",top:s-(r-o)})}static clone(e){return e==null||typeof e!="object"?e:e instanceof Array?[...e]:{...e}}static cloneDeep(e){const t=["parentGrid","el","grid","subGrid","engine"],s=c.clone(e);for(const i in s)s.hasOwnProperty(i)&&typeof s[i]=="object"&&i.substring(0,2)!=="__"&&!t.find(r=>r===i)&&(s[i]=c.cloneDeep(e[i]));return s}static cloneNode(e){const t=e.cloneNode(!0);return t.removeAttribute("id"),t}static appendTo(e,t){let s;typeof t=="string"?s=c.getElement(t):s=t,s&&s.appendChild(e)}static addElStyles(e,t){if(t instanceof Object)for(const s in t)t.hasOwnProperty(s)&&(Array.isArray(t[s])?t[s].forEach(i=>{e.style[s]=i}):e.style[s]=t[s])}static initEvent(e,t){const s={type:t.type},i={button:0,which:0,buttons:1,bubbles:!0,cancelable:!0,target:t.target?t.target:e.target};return["altKey","ctrlKey","metaKey","shiftKey"].forEach(r=>s[r]=e[r]),["pageX","pageY","clientX","clientY","screenX","screenY"].forEach(r=>s[r]=e[r]),{...s,...i}}static simulateMouseEvent(e,t,s){const i=e,r=new MouseEvent(t,{bubbles:!0,composed:!0,cancelable:!0,view:window,detail:1,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY,ctrlKey:i.ctrlKey??!1,altKey:i.altKey??!1,shiftKey:i.shiftKey??!1,metaKey:i.metaKey??!1,button:0,relatedTarget:e.target});(s||e.target).dispatchEvent(r)}static getValuesFromTransformedElement(e){const t=document.createElement("div");c.addElStyles(t,{opacity:"0",position:"fixed",top:"0px",left:"0px",width:"1px",height:"1px",zIndex:"-999999"}),e.appendChild(t);const s=t.getBoundingClientRect();return e.removeChild(t),t.remove(),{xScale:1/s.width,yScale:1/s.height,xOffset:s.left,yOffset:s.top}}static swap(e,t,s){if(!e)return;const i=e[t];e[t]=e[s],e[s]=i}static canBeRotated(e){var t;return!(!e||e.w===e.h||e.locked||e.noResize||(t=e.grid)!=null&&t.opts.disableResize||e.minW&&e.minW===e.maxW||e.minH&&e.minH===e.maxH)}}class q{constructor(e={}){this.addedNodes=[],this.removedNodes=[],this.defaultColumn=12,this.column=e.column||this.defaultColumn,this.column>this.defaultColumn&&(this.defaultColumn=this.column),this.maxRow=e.maxRow,this._float=e.float,this.nodes=e.nodes||[],this.onChange=e.onChange}batchUpdate(e=!0,t=!0){return!!this.batchMode===e?this:(this.batchMode=e,e?(this._prevFloat=this._float,this._float=!0,this.cleanNodes(),this.saveInitial()):(this._float=this._prevFloat,delete this._prevFloat,t&&this._packNodes(),this._notify()),this)}_useEntireRowArea(e,t){return(!this.float||this.batchMode&&!this._prevFloat)&&!this._hasLocked&&(!e._moving||e._skipDown||t.y<=e.y)}_fixCollisions(e,t=e,s,i={}){if(this.sortNodes(-1),s=s||this.collide(e,t),!s)return!1;if(e._moving&&!i.nested&&!this.float&&this.swap(e,s))return!0;let r=t;!this._loading&&this._useEntireRowArea(e,t)&&(r={x:0,w:this.column,y:t.y,h:t.h},s=this.collide(e,r,i.skip));let a=!1;const o={nested:!0,pack:!1};let m=0;for(;s=s||this.collide(e,r,i.skip);){if(m++>this.nodes.length*2)throw new Error("Infinite collide check");let u;if(s.locked||this._loading||e._moving&&!e._skipDown&&t.y>e.y&&!this.float&&(!this.collide(s,{...s,y:e.y},e)||!this.collide(s,{...s,y:t.y-s.h},e))){e._skipDown=e._skipDown||t.y>e.y;const l={...t,y:s.y+s.h,...o};u=this._loading&&c.samePos(e,l)?!0:this.moveNode(e,l),(s.locked||this._loading)&&u?c.copyPos(t,e):!s.locked&&u&&i.pack&&(this._packNodes(),t.y=s.y+s.h,c.copyPos(e,t)),a=a||u}else u=this.moveNode(s,{...s,y:t.y+t.h,skip:e,...o});if(!u)return a;s=void 0}return a}collide(e,t=e,s){const i=e._id,r=s==null?void 0:s._id;return this.nodes.find(a=>a._id!==i&&a._id!==r&&c.isIntercepted(a,t))}collideAll(e,t=e,s){const i=e._id,r=s==null?void 0:s._id;return this.nodes.filter(a=>a._id!==i&&a._id!==r&&c.isIntercepted(a,t))}directionCollideCoverage(e,t,s){if(!t.rect||!e._rect)return;const i=e._rect,r={...t.rect};r.y>i.y?(r.h+=r.y-i.y,r.y=i.y):r.h+=i.y-r.y,r.x>i.x?(r.w+=r.x-i.x,r.x=i.x):r.w+=i.x-r.x;let a,o=.5;for(let m of s){if(m.locked||!m._rect)break;const u=m._rect;let l=Number.MAX_VALUE,h=Number.MAX_VALUE;i.y<u.y?l=(r.y+r.h-u.y)/u.h:i.y+i.h>u.y+u.h&&(l=(u.y+u.h-r.y)/u.h),i.x<u.x?h=(r.x+r.w-u.x)/u.w:i.x+i.w>u.x+u.w&&(h=(u.x+u.w-r.x)/u.w);const g=Math.min(h,l);g>o&&(o=g,a=m)}return t.collide=a,a}cacheRects(e,t,s,i,r,a){return this.nodes.forEach(o=>o._rect={y:o.y*t+s,x:o.x*e+a,w:o.w*e-a-i,h:o.h*t-s-r}),this}swap(e,t){if(!t||t.locked||!e||e.locked)return!1;function s(){const r=t.x,a=t.y;return t.x=e.x,t.y=e.y,e.h!=t.h?(e.x=r,e.y=t.y+t.h):e.w!=t.w?(e.x=t.x+t.w,e.y=a):(e.x=r,e.y=a),e._dirty=t._dirty=!0,!0}let i;if(e.w===t.w&&e.h===t.h&&(e.x===t.x||e.y===t.y)&&(i=c.isTouching(e,t)))return s();if(i!==!1){if(e.w===t.w&&e.x===t.x&&(i||(i=c.isTouching(e,t)))){if(t.y<e.y){const r=e;e=t,t=r}return s()}if(i!==!1){if(e.h===t.h&&e.y===t.y&&(i||(i=c.isTouching(e,t)))){if(t.x<e.x){const r=e;e=t,t=r}return s()}return!1}}}isAreaEmpty(e,t,s,i){const r={x:e||0,y:t||0,w:s||1,h:i||1};return!this.collide(r)}compact(e="compact",t=!0){if(this.nodes.length===0)return this;t&&this.sortNodes();const s=this.batchMode;s||this.batchUpdate();const i=this._inColumnResize;i||(this._inColumnResize=!0);const r=this.nodes;return this.nodes=[],r.forEach((a,o,m)=>{let u;a.locked||(a.autoPosition=!0,e==="list"&&o&&(u=m[o-1])),this.addNode(a,!1,u)}),i||delete this._inColumnResize,s||this.batchUpdate(!1),this}set float(e){this._float!==e&&(this._float=e||!1,e||this._packNodes()._notify())}get float(){return this._float||!1}sortNodes(e=1){return this.nodes=c.sort(this.nodes,e),this}_packNodes(){return this.batchMode?this:(this.sortNodes(),this.float?this.nodes.forEach(e=>{if(e._updating||e._orig===void 0||e.y===e._orig.y)return;let t=e.y;for(;t>e._orig.y;)--t,this.collide(e,{x:e.x,y:t,w:e.w,h:e.h})||(e._dirty=!0,e.y=t)}):this.nodes.forEach((e,t)=>{if(!e.locked)for(;e.y>0;){const s=t===0?0:e.y-1;if(!(t===0||!this.collide(e,{x:e.x,y:s,w:e.w,h:e.h})))break;e._dirty=e.y!==s,e.y=s}}),this)}prepareNode(e,t){e._id=e._id??q._idSeq++;const s=e.id;if(s){let r=1;for(;this.nodes.find(a=>a.id===e.id&&a!==e);)e.id=s+"_"+r++}(e.x===void 0||e.y===void 0||e.x===null||e.y===null)&&(e.autoPosition=!0);const i={x:0,y:0,w:1,h:1};return c.defaults(e,i),e.autoPosition||delete e.autoPosition,e.noResize||delete e.noResize,e.noMove||delete e.noMove,c.sanitizeMinMax(e),typeof e.x=="string"&&(e.x=Number(e.x)),typeof e.y=="string"&&(e.y=Number(e.y)),typeof e.w=="string"&&(e.w=Number(e.w)),typeof e.h=="string"&&(e.h=Number(e.h)),isNaN(e.x)&&(e.x=i.x,e.autoPosition=!0),isNaN(e.y)&&(e.y=i.y,e.autoPosition=!0),isNaN(e.w)&&(e.w=i.w),isNaN(e.h)&&(e.h=i.h),this.nodeBoundFix(e,t),e}nodeBoundFix(e,t){const s=e._orig||c.copyPos({},e);if(e.maxW&&(e.w=Math.min(e.w||1,e.maxW)),e.maxH&&(e.h=Math.min(e.h||1,e.maxH)),e.minW&&(e.w=Math.max(e.w||1,e.minW)),e.minH&&(e.h=Math.max(e.h||1,e.minH)),(e.x||0)+(e.w||1)>this.column&&this.column<this.defaultColumn&&!this._inColumnResize&&!this.skipCacheUpdate&&e._id!=null&&this.findCacheLayout(e,this.defaultColumn)===-1){const r={...e};r.autoPosition||r.x===void 0?(delete r.x,delete r.y):r.x=Math.min(this.defaultColumn-1,r.x),r.w=Math.min(this.defaultColumn,r.w||1),this.cacheOneLayout(r,this.defaultColumn)}return e.w>this.column?e.w=this.column:e.w<1&&(e.w=1),this.maxRow&&e.h>this.maxRow?e.h=this.maxRow:e.h<1&&(e.h=1),e.x<0&&(e.x=0),e.y<0&&(e.y=0),e.x+e.w>this.column&&(t?e.w=this.column-e.x:e.x=this.column-e.w),this.maxRow&&e.y+e.h>this.maxRow&&(t?e.h=this.maxRow-e.y:e.y=this.maxRow-e.h),c.samePos(e,s)||(e._dirty=!0),this}getDirtyNodes(e){return e?this.nodes.filter(t=>t._dirty&&!c.samePos(t,t._orig)):this.nodes.filter(t=>t._dirty)}_notify(e){if(this.batchMode||!this.onChange)return this;const t=(e||[]).concat(this.getDirtyNodes());return this.onChange(t),this}cleanNodes(){return this.batchMode?this:(this.nodes.forEach(e=>{delete e._dirty,delete e._lastTried}),this)}saveInitial(){return this.nodes.forEach(e=>{e._orig=c.copyPos({},e),delete e._dirty}),this._hasLocked=this.nodes.some(e=>e.locked),this}restoreInitial(){return this.nodes.forEach(e=>{!e._orig||c.samePos(e,e._orig)||(c.copyPos(e,e._orig),e._dirty=!0)}),this._notify(),this}findEmptyPosition(e,t=this.nodes,s=this.column,i){const r=i?i.y*s+(i.x+i.w):0;let a=!1;for(let o=r;!a;++o){const m=o%s,u=Math.floor(o/s);if(m+e.w>s)continue;const l={x:m,y:u,w:e.w,h:e.h};t.find(h=>c.isIntercepted(l,h))||((e.x!==m||e.y!==u)&&(e._dirty=!0),e.x=m,e.y=u,delete e.autoPosition,a=!0)}return a}addNode(e,t=!1,s){const i=this.nodes.find(a=>a._id===e._id);if(i)return i;this._inColumnResize?this.nodeBoundFix(e):this.prepareNode(e),delete e._temporaryRemoved,delete e._removeDOM;let r;return e.autoPosition&&this.findEmptyPosition(e,this.nodes,this.column,s)&&(delete e.autoPosition,r=!0),this.nodes.push(e),t&&this.addedNodes.push(e),r||this._fixCollisions(e),this.batchMode||this._packNodes()._notify(),e}removeNode(e,t=!0,s=!1){return this.nodes.find(i=>i._id===e._id)?(s&&this.removedNodes.push(e),t&&(e._removeDOM=!0),this.nodes=this.nodes.filter(i=>i._id!==e._id),e._isAboutToRemove||this._packNodes(),this._notify([e]),this):this}removeAll(e=!0,t=!0){if(delete this._layouts,!this.nodes.length)return this;e&&this.nodes.forEach(i=>i._removeDOM=!0);const s=this.nodes;return this.removedNodes=t?s:[],this.nodes=[],this._notify(s)}moveNodeCheck(e,t){if(!this.changedPosConstrain(e,t))return!1;if(t.pack=!0,!this.maxRow)return this.moveNode(e,t);let s;const i=new q({column:this.column,float:this.float,nodes:this.nodes.map(a=>a._id===e._id?(s={...a},s):{...a})});if(!s)return!1;const r=i.moveNode(s,t)&&i.getRow()<=Math.max(this.getRow(),this.maxRow);if(!r&&!t.resizing&&t.collide){const a=t.collide.el.gridstackNode;if(this.swap(e,a))return this._notify(),!0}return r?(i.nodes.filter(a=>a._dirty).forEach(a=>{const o=this.nodes.find(m=>m._id===a._id);o&&(c.copyPos(o,a),o._dirty=!0)}),this._notify(),!0):!1}willItFit(e){if(delete e._willFitPos,!this.maxRow)return!0;const t=new q({column:this.column,float:this.float,nodes:this.nodes.map(i=>({...i}))}),s={...e};return this.cleanupNode(s),delete s.el,delete s._id,delete s.content,delete s.grid,t.addNode(s),t.getRow()<=this.maxRow?(e._willFitPos=c.copyPos({},s),!0):!1}changedPosConstrain(e,t){return t.w=t.w||e.w,t.h=t.h||e.h,e.x!==t.x||e.y!==t.y?!0:(e.maxW&&(t.w=Math.min(t.w,e.maxW)),e.maxH&&(t.h=Math.min(t.h,e.maxH)),e.minW&&(t.w=Math.max(t.w,e.minW)),e.minH&&(t.h=Math.max(t.h,e.minH)),e.w!==t.w||e.h!==t.h)}moveNode(e,t){var u,l;if(!e||!t)return!1;let s;t.pack===void 0&&!this.batchMode&&(s=t.pack=!0),typeof t.x!="number"&&(t.x=e.x),typeof t.y!="number"&&(t.y=e.y),typeof t.w!="number"&&(t.w=e.w),typeof t.h!="number"&&(t.h=e.h);const i=e.w!==t.w||e.h!==t.h,r=c.copyPos({},e,!0);if(c.copyPos(r,t),this.nodeBoundFix(r,i),c.copyPos(t,r),!t.forceCollide&&c.samePos(e,t))return!1;const a=c.copyPos({},e),o=this.collideAll(e,r,t.skip);let m=!0;if(o.length){const h=e._moving&&!t.nested;let g=h?this.directionCollideCoverage(e,t,o):o[0];if(h&&g&&((l=(u=e.grid)==null?void 0:u.opts)!=null&&l.subGridDynamic)&&!e.grid._isTemp){const p=c.areaIntercept(t.rect,g._rect),v=c.area(t.rect),f=c.area(g._rect);p/(v<f?v:f)>.8&&(g.grid.makeSubGrid(g.el,void 0,e),g=void 0)}g?m=!this._fixCollisions(e,r,g,t):(m=!1,s&&delete t.pack)}return m&&!c.samePos(e,r)&&(e._dirty=!0,c.copyPos(e,r)),t.pack&&this._packNodes()._notify(),!c.samePos(e,a)}getRow(){return this.nodes.reduce((e,t)=>Math.max(e,t.y+t.h),0)}beginUpdate(e){return e._updating||(e._updating=!0,delete e._skipDown,this.batchMode||this.saveInitial()),this}endUpdate(){const e=this.nodes.find(t=>t._updating);return e&&(delete e._updating,delete e._skipDown),this}save(e=!0,t,s){var o;const i=((o=this._layouts)==null?void 0:o.length)||0;let r;i&&(s?s!==this.column&&(r=this._layouts[s]):this.column!==i-1&&(r=this._layouts[i-1]));const a=[];return this.sortNodes(),this.nodes.forEach(m=>{const u=r==null?void 0:r.find(h=>h._id===m._id),l={...m,...u||{}};c.removeInternalForSave(l,!e),t&&t(m,l),a.push(l)}),a}layoutsNodesChange(e){return!this._layouts||this._inColumnResize?this:(this._layouts.forEach((t,s)=>{if(!t||s===this.column)return this;if(s<this.column)this._layouts[s]=void 0;else{const i=s/this.column;e.forEach(r=>{if(!r._orig)return;const a=t.find(o=>o._id===r._id);a&&(a.y>=0&&r.y!==r._orig.y&&(a.y+=r.y-r._orig.y,a.y<0&&(a.y=0)),r.x!==r._orig.x&&(a.x=Math.round(r.x*i),a.x<0&&(a.x=0)),r.w!==r._orig.w&&(a.w=Math.round(r.w*i),a.w<1&&(a.w=1)))})}}),this)}columnChanged(e,t,s="moveScale"){var o;if(!this.nodes.length||!t||e===t)return this;const i=s==="compact"||s==="list";i&&this.sortNodes(1),t<e&&this.cacheLayout(this.nodes,e),this.batchUpdate();let r=[],a=i?this.nodes:c.sort(this.nodes,-1);if(t>e&&this._layouts){const m=this._layouts[t]||[],u=this._layouts.length-1;!m.length&&e!==u&&((o=this._layouts[u])!=null&&o.length)&&(e=u,this._layouts[u].forEach(l=>{const h=a.find(g=>g._id===l._id);h&&(!i&&!l.autoPosition&&(h.x=l.x??h.x,h.y=l.y??h.y),h.w=l.w??h.w,(l.x==null||l.y===void 0)&&(h.autoPosition=!0))})),m.forEach(l=>{const h=a.findIndex(g=>g._id===l._id);if(h!==-1){const g=a[h];if(i){g.w=l.w;return}(l.autoPosition||isNaN(l.x)||isNaN(l.y))&&this.findEmptyPosition(l,r),l.autoPosition||(g.x=l.x??g.x,g.y=l.y??g.y,g.w=l.w??g.w,r.push(g)),a.splice(h,1)}})}if(i)this.compact(s,!1);else{if(a.length)if(typeof s=="function")s(t,e,r,a);else{const m=i||s==="none"?1:t/e,u=s==="move"||s==="moveScale",l=s==="scale"||s==="moveScale";a.forEach(h=>{h.x=t===1?0:u?Math.round(h.x*m):Math.min(h.x,t-1),h.w=t===1||e===1?1:l?Math.round(h.w*m)||1:Math.min(h.w,t),r.push(h)}),a=[]}r=c.sort(r,-1),this._inColumnResize=!0,this.nodes=[],r.forEach(m=>{this.addNode(m,!1),delete m._orig})}return this.nodes.forEach(m=>delete m._orig),this.batchUpdate(!1,!i),delete this._inColumnResize,this}cacheLayout(e,t,s=!1){const i=[];return e.forEach((r,a)=>{if(r._id===void 0){const o=r.id?this.nodes.find(m=>m.id===r.id):void 0;r._id=(o==null?void 0:o._id)??q._idSeq++}i[a]={x:r.x,y:r.y,w:r.w,_id:r._id}}),this._layouts=s?[]:this._layouts||[],this._layouts[t]=i,this}cacheOneLayout(e,t){e._id=e._id??q._idSeq++;const s={x:e.x,y:e.y,w:e.w,_id:e._id};(e.autoPosition||e.x===void 0)&&(delete s.x,delete s.y,e.autoPosition&&(s.autoPosition=!0)),this._layouts=this._layouts||[],this._layouts[t]=this._layouts[t]||[];const i=this.findCacheLayout(e,t);return i===-1?this._layouts[t].push(s):this._layouts[t][i]=s,this}findCacheLayout(e,t){var s,i;return((i=(s=this._layouts)==null?void 0:s[t])==null?void 0:i.findIndex(r=>r._id===e._id))??-1}removeNodeFromLayoutCache(e){if(this._layouts)for(let t=0;t<this._layouts.length;t++){const s=this.findCacheLayout(e,t);s!==-1&&this._layouts[t].splice(s,1)}}cleanupNode(e){for(const t in e)t[0]==="_"&&t!=="_id"&&delete e[t];return this}}q._idSeq=0;const A={alwaysShowResizeHandle:"mobile",animate:!0,auto:!0,cellHeight:"auto",cellHeightThrottle:100,cellHeightUnit:"px",column:12,draggable:{handle:".grid-stack-item-content",appendTo:"body",scroll:!0},handle:".grid-stack-item-content",itemClass:"grid-stack-item",margin:10,marginUnit:"px",maxRow:0,minRow:0,placeholderClass:"grid-stack-placeholder",placeholderText:"",removableOptions:{accept:"grid-stack-item",decline:"grid-stack-non-removable"},resizable:{handles:"se"},rtl:"auto"};class b{}const G=typeof window<"u"&&typeof document<"u"&&("ontouchstart"in document||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0);class T{}function re(d,e){d.touches.length>1||(d.cancelable&&d.preventDefault(),c.simulateMouseEvent(d.changedTouches[0],e))}function Se(d,e){d.cancelable&&d.preventDefault(),c.simulateMouseEvent(d,e)}function ne(d){T.touchHandled||(T.touchHandled=!0,re(d,"mousedown"))}function ae(d){T.touchHandled&&re(d,"mousemove")}function oe(d){if(!T.touchHandled)return;T.pointerLeaveTimeout&&(window.clearTimeout(T.pointerLeaveTimeout),delete T.pointerLeaveTimeout);const e=!!b.dragElement;re(d,"mouseup"),e||re(d,"click"),T.touchHandled=!1}function le(d){d.pointerType!=="mouse"&&d.target.releasePointerCapture(d.pointerId)}function Ne(d){b.dragElement&&d.pointerType!=="mouse"&&Se(d,"mouseenter")}function Ee(d){b.dragElement&&d.pointerType!=="mouse"&&(T.pointerLeaveTimeout=window.setTimeout(()=>{delete T.pointerLeaveTimeout,Se(d,"mouseleave")},10))}class ue{constructor(e,t,s){this.host=e,this.dir=t,this.option=s,this.moving=!1,this._mouseDown=this._mouseDown.bind(this),this._mouseMove=this._mouseMove.bind(this),this._mouseUp=this._mouseUp.bind(this),this._keyEvent=this._keyEvent.bind(this),this._init()}_init(){if(this.option.element)try{this.el=this.option.element instanceof HTMLElement?this.option.element:this.host.querySelector(this.option.element)}catch(e){this.option.element=void 0,console.error("Query for resizeable handle failed, falling back",e)}return this.el||(this.el=document.createElement("div"),this.host.appendChild(this.el)),this.el.classList.add("ui-resizable-handle"),this.el.classList.add(`${ue.prefix}${this.dir}`),this.el.style.zIndex="100",this.el.style.userSelect="none",this.el.addEventListener("mousedown",this._mouseDown),G&&(this.el.addEventListener("touchstart",ne),this.el.addEventListener("pointerdown",le)),this}destroy(){return this.moving&&this._mouseUp(this.mouseDownEvent),this.el.removeEventListener("mousedown",this._mouseDown),G&&(this.el.removeEventListener("touchstart",ne),this.el.removeEventListener("pointerdown",le)),this.option.element||this.host.removeChild(this.el),delete this.el,delete this.host,this}_mouseDown(e){this.mouseDownEvent=e,document.addEventListener("mousemove",this._mouseMove,{capture:!0,passive:!0}),document.addEventListener("mouseup",this._mouseUp,!0),G&&(this.el.addEventListener("touchmove",ae),this.el.addEventListener("touchend",oe)),e.stopPropagation(),e.preventDefault()}_mouseMove(e){const t=this.mouseDownEvent;this.moving?this._triggerEvent("move",e):Math.abs(e.x-t.x)+Math.abs(e.y-t.y)>2&&(this.moving=!0,this._triggerEvent("start",this.mouseDownEvent),this._triggerEvent("move",e),document.addEventListener("keydown",this._keyEvent)),e.stopPropagation()}_mouseUp(e){this.moving&&(this._triggerEvent("stop",e),document.removeEventListener("keydown",this._keyEvent)),document.removeEventListener("mousemove",this._mouseMove,!0),document.removeEventListener("mouseup",this._mouseUp,!0),G&&(this.el.removeEventListener("touchmove",ae),this.el.removeEventListener("touchend",oe)),delete this.moving,delete this.mouseDownEvent,e.stopPropagation(),e.preventDefault()}_keyEvent(e){var t,s;e.key==="Escape"&&((s=(t=this.host.gridstackNode)==null?void 0:t.grid)==null||s.engine.restoreInitial(),this._mouseUp(this.mouseDownEvent))}_triggerEvent(e,t){return this.option[e]&&this.option[e](t),this}}ue.prefix="ui-resizable-";class ve{constructor(){this._eventRegister={}}get disabled(){return this._disabled}on(e,t){this._eventRegister[e]=t}off(e){delete this._eventRegister[e]}enable(){this._disabled=!1}disable(){this._disabled=!0}destroy(){delete this._eventRegister}triggerEvent(e,t){if(!this.disabled&&this._eventRegister&&this._eventRegister[e])return this._eventRegister[e](t)}}class K extends ve{constructor(e,t={}){super(),this.el=e,this.option=t,this.rectScale={x:1,y:1},this._ui=()=>{const i=this.el.parentElement.getBoundingClientRect(),r={width:this.originalRect.width,height:this.originalRect.height+this.scrolled,left:this.originalRect.left,top:this.originalRect.top-this.scrolled},a=this.temporalRect||r;return{position:{left:(a.left-i.left)*this.rectScale.x,top:(a.top-i.top)*this.rectScale.y},size:{width:a.width*this.rectScale.x,height:a.height*this.rectScale.y}}},this._mouseOver=this._mouseOver.bind(this),this._mouseOut=this._mouseOut.bind(this),this.enable(),this._setupAutoHide(this.option.autoHide),this._setupHandlers()}on(e,t){super.on(e,t)}off(e){super.off(e)}enable(){super.enable(),this.el.classList.remove("ui-resizable-disabled"),this._setupAutoHide(this.option.autoHide)}disable(){super.disable(),this.el.classList.add("ui-resizable-disabled"),this._setupAutoHide(!1)}destroy(){this._removeHandlers(),this._setupAutoHide(!1),delete this.el,super.destroy()}updateOption(e){const t=e.handles&&e.handles!==this.option.handles,s=e.autoHide&&e.autoHide!==this.option.autoHide;return Object.keys(e).forEach(i=>this.option[i]=e[i]),t&&(this._removeHandlers(),this._setupHandlers()),s&&this._setupAutoHide(this.option.autoHide),this}_setupAutoHide(e){return e?(this.el.classList.add("ui-resizable-autohide"),this.el.addEventListener("mouseover",this._mouseOver),this.el.addEventListener("mouseout",this._mouseOut)):(this.el.classList.remove("ui-resizable-autohide"),this.el.removeEventListener("mouseover",this._mouseOver),this.el.removeEventListener("mouseout",this._mouseOut),b.overResizeElement===this&&delete b.overResizeElement),this}_mouseOver(e){b.overResizeElement||b.dragElement||(b.overResizeElement=this,this.el.classList.remove("ui-resizable-autohide"))}_mouseOut(e){b.overResizeElement===this&&(delete b.overResizeElement,this.el.classList.add("ui-resizable-autohide"))}_setupHandlers(){return this.handlers=this.option.handles.split(",").map(e=>e.trim()).map(e=>new ue(this.el,e,{element:this.option.element,start:t=>this._resizeStart(t),stop:t=>this._resizeStop(t),move:t=>this._resizing(t,e)})),this}_resizeStart(e){this.sizeToContent=c.shouldSizeToContent(this.el.gridstackNode,!0),this.originalRect=this.el.getBoundingClientRect(),this.scrollEl=c.getScrollElement(this.el),this.scrollY=this.scrollEl.scrollTop,this.scrolled=0,this.startEvent=e,this._setupHelper(),this._applyChange();const t=c.initEvent(e,{type:"resizestart",target:this.el});return this.option.start&&this.option.start(t,this._ui()),this.el.classList.add("ui-resizable-resizing"),this.triggerEvent("resizestart",t),this}_resizing(e,t){this.scrolled=this.scrollEl.scrollTop-this.scrollY,this.temporalRect=this._getChange(e,t),this._applyChange();const s=c.initEvent(e,{type:"resize",target:this.el});return this.option.resize&&this.option.resize(s,this._ui()),this.triggerEvent("resize",s),this}_resizeStop(e){const t=c.initEvent(e,{type:"resizestop",target:this.el});return this._cleanHelper(),this.option.stop&&this.option.stop(t),this.el.classList.remove("ui-resizable-resizing"),this.triggerEvent("resizestop",t),delete this.startEvent,delete this.originalRect,delete this.temporalRect,delete this.scrollY,delete this.scrolled,this}_setupHelper(){this.elOriginStyleVal=K._originStyleProp.map(s=>this.el.style[s]),this.parentOriginStylePosition=this.el.parentElement.style.position;const e=this.el.parentElement,t=c.getValuesFromTransformedElement(e);return this.rectScale={x:t.xScale,y:t.yScale},getComputedStyle(this.el.parentElement).position.match(/static/)&&(this.el.parentElement.style.position="relative"),this.el.style.position="absolute",this.el.style.opacity="0.8",this}_cleanHelper(){return K._originStyleProp.forEach((e,t)=>{this.el.style[e]=this.elOriginStyleVal[t]||null}),this.el.parentElement.style.position=this.parentOriginStylePosition||null,this}_getChange(e,t){const s=this.startEvent,i={width:this.originalRect.width,height:this.originalRect.height+this.scrolled,left:this.originalRect.left,top:this.originalRect.top-this.scrolled},r=e.clientX-s.clientX,a=this.sizeToContent?0:e.clientY-s.clientY;let o,m;t.indexOf("e")>-1?i.width+=r:t.indexOf("w")>-1&&(i.width-=r,i.left+=r,o=!0),t.indexOf("s")>-1?i.height+=a:t.indexOf("n")>-1&&(i.height-=a,i.top+=a,m=!0);const u=this._constrainSize(i.width,i.height,o,m);return Math.round(i.width)!==Math.round(u.width)&&(t.indexOf("w")>-1&&(i.left+=i.width-u.width),i.width=u.width),Math.round(i.height)!==Math.round(u.height)&&(t.indexOf("n")>-1&&(i.top+=i.height-u.height),i.height=u.height),i}_constrainSize(e,t,s,i){const r=this.option,a=(s?r.maxWidthMoveLeft:r.maxWidth)||Number.MAX_SAFE_INTEGER,o=r.minWidth/this.rectScale.x||e,m=(i?r.maxHeightMoveUp:r.maxHeight)||Number.MAX_SAFE_INTEGER,u=r.minHeight/this.rectScale.y||t,l=Math.min(a,Math.max(o,e)),h=Math.min(m,Math.max(u,t));return{width:l,height:h}}_applyChange(){let e={left:0,top:0,width:0,height:0};if(this.el.style.position==="absolute"){const t=this.el.parentElement,{left:s,top:i}=t.getBoundingClientRect();e={left:s,top:i,width:0,height:0}}return this.temporalRect?(Object.keys(this.temporalRect).forEach(t=>{const s=this.temporalRect[t],i=t==="width"||t==="left"?this.rectScale.x:t==="height"||t==="top"?this.rectScale.y:1;this.el.style[t]=(s-e[t])*i+"px"}),this):this}_removeHandlers(){return this.handlers.forEach(e=>e.destroy()),delete this.handlers,this}}K._originStyleProp=["width","height","position","left","top","opacity","zIndex"];const ut='input,textarea,button,select,option,[contenteditable="true"],.ui-resizable-handle';class Q extends ve{constructor(e,t={}){var r;super(),this.el=e,this.option=t,this.dragTransform={xScale:1,yScale:1,xOffset:0,yOffset:0};const s=(r=t==null?void 0:t.handle)==null?void 0:r.substring(1),i=e.gridstackNode;this.dragEls=!s||e.classList.contains(s)?[e]:i!=null&&i.subGrid?[e.querySelector(t.handle)||e]:Array.from(e.querySelectorAll(t.handle)),this.dragEls.length===0&&(this.dragEls=[e]),this._mouseDown=this._mouseDown.bind(this),this._mouseMove=this._mouseMove.bind(this),this._mouseUp=this._mouseUp.bind(this),this._keyEvent=this._keyEvent.bind(this),this.enable()}on(e,t){super.on(e,t)}off(e){super.off(e)}enable(){this.disabled!==!1&&(super.enable(),this.dragEls.forEach(e=>{e.addEventListener("mousedown",this._mouseDown),G&&(e.addEventListener("touchstart",ne),e.addEventListener("pointerdown",le))}),this.el.classList.remove("ui-draggable-disabled"))}disable(e=!1){this.disabled!==!0&&(super.disable(),this.dragEls.forEach(t=>{t.removeEventListener("mousedown",this._mouseDown),G&&(t.removeEventListener("touchstart",ne),t.removeEventListener("pointerdown",le))}),e||this.el.classList.add("ui-draggable-disabled"))}destroy(){this.dragTimeout&&window.clearTimeout(this.dragTimeout),delete this.dragTimeout,this.mouseDownEvent&&this._mouseUp(this.mouseDownEvent),this.disable(!0),delete this.el,delete this.helper,delete this.option,super.destroy()}updateOption(e){return Object.keys(e).forEach(t=>this.option[t]=e[t]),this}_mouseDown(e){if(T.touchHandled&&e.isTrusted&&(T.touchHandled=!1),!b.mouseHandled)return e.button!==0||!this.dragEls.find(t=>t===e.target)&&e.target.closest(ut)||this.option.cancel&&e.target.closest(this.option.cancel)||(this.mouseDownEvent=e,delete this.dragging,delete b.dragElement,delete b.dropElement,document.addEventListener("mousemove",this._mouseMove,{capture:!0,passive:!0}),document.addEventListener("mouseup",this._mouseUp,!0),G&&(e.currentTarget.addEventListener("touchmove",ae),e.currentTarget.addEventListener("touchend",oe)),e.preventDefault(),document.activeElement&&document.activeElement.blur(),b.mouseHandled=!0),!0}_callDrag(e){if(!this.dragging)return;const t=c.initEvent(e,{target:this.el,type:"drag"});this.option.drag&&this.option.drag(t,this.ui()),this.triggerEvent("drag",t)}_mouseMove(e){var s;const t=this.mouseDownEvent;if(this.lastDrag=e,this.dragging)if(this._dragFollow(e),b.pauseDrag){const i=Number.isInteger(b.pauseDrag)?b.pauseDrag:100;this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>this._callDrag(e),i)}else this._callDrag(e);else if(Math.abs(e.x-t.x)+Math.abs(e.y-t.y)>3){this.dragging=!0,b.dragElement=this;const i=(s=this.el.gridstackNode)==null?void 0:s.grid;i?b.dropElement=i.el.ddElement.ddDroppable:delete b.dropElement,this.helper=this._createHelper(),this._setupHelperContainmentStyle(),this.dragTransform=c.getValuesFromTransformedElement(this.helperContainment),this.dragOffset=this._getDragOffset(e,this.el,this.helperContainment),this._setupHelperStyle(e);const r=c.initEvent(e,{target:this.el,type:"dragstart"});this.option.start&&this.option.start(r,this.ui()),this.triggerEvent("dragstart",r),document.addEventListener("keydown",this._keyEvent)}return!0}_mouseUp(e){var t,s;if(document.removeEventListener("mousemove",this._mouseMove,!0),document.removeEventListener("mouseup",this._mouseUp,!0),G&&e.currentTarget&&(e.currentTarget.removeEventListener("touchmove",ae,!0),e.currentTarget.removeEventListener("touchend",oe,!0)),this.dragging){delete this.dragging,(t=this.el.gridstackNode)==null||delete t._origRotate,document.removeEventListener("keydown",this._keyEvent),((s=b.dropElement)==null?void 0:s.el)===this.el.parentElement&&delete b.dropElement,this.helperContainment.style.position=this.parentOriginStylePosition||null,this.helper!==this.el&&this.helper.remove(),this._removeHelperStyle();const i=c.initEvent(e,{target:this.el,type:"dragstop"});this.option.stop&&this.option.stop(i),this.triggerEvent("dragstop",i),b.dropElement&&b.dropElement.drop(e)}delete this.helper,delete this.mouseDownEvent,delete b.dragElement,delete b.dropElement,delete b.mouseHandled,e.preventDefault()}_keyEvent(e){var i,r;const t=this.el.gridstackNode,s=(t==null?void 0:t.grid)||((r=(i=b.dropElement)==null?void 0:i.el)==null?void 0:r.gridstack);if(e.key==="Escape")t&&t._origRotate&&(t._orig=t._origRotate,delete t._origRotate),s==null||s.cancelDrag(),this._mouseUp(this.mouseDownEvent);else if(t&&s&&(e.key==="r"||e.key==="R")){if(!c.canBeRotated(t))return;t._origRotate=t._origRotate||{...t._orig},delete t._moving,s.setAnimation(!1).rotate(t.el,{top:-this.dragOffset.offsetTop,left:-this.dragOffset.offsetLeft}).setAnimation(),t._moving=!0,this.dragOffset=this._getDragOffset(this.lastDrag,t.el,this.helperContainment),this.helper.style.width=this.dragOffset.width+"px",this.helper.style.height=this.dragOffset.height+"px",c.swap(t._orig,"w","h"),delete t._rect,this._mouseMove(this.lastDrag)}}_createHelper(){let e=this.el;return typeof this.option.helper=="function"?e=this.option.helper(this.el):this.option.helper==="clone"&&(e=c.cloneNode(this.el)),e.parentElement||c.appendTo(e,this.option.appendTo==="parent"?this.el.parentElement:this.option.appendTo),this.dragElementOriginStyle=Q.originStyleProp.map(t=>this.el.style[t]),e}_setupHelperStyle(e){var s,i;this.helper.classList.add("ui-draggable-dragging"),(i=(s=this.el.gridstackNode)==null?void 0:s.grid)==null||i.el.classList.add("grid-stack-dragging");const t=this.helper.style;return t.pointerEvents="none",t.width=this.dragOffset.width+"px",t.height=this.dragOffset.height+"px",t.willChange="left, top",t.position="fixed",this._dragFollow(e),t.transition="none",setTimeout(()=>{this.helper&&(t.transition=null)},0),this}_removeHelperStyle(){var t,s,i;this.helper.classList.remove("ui-draggable-dragging"),(s=(t=this.el.gridstackNode)==null?void 0:t.grid)==null||s.el.classList.remove("grid-stack-dragging");const e=(i=this.helper)==null?void 0:i.gridstackNode;if(!(e!=null&&e._isAboutToRemove)&&this.dragElementOriginStyle){const r=this.helper,a=this.dragElementOriginStyle.transition||null;r.style.transition=this.dragElementOriginStyle.transition="none",Q.originStyleProp.forEach(o=>r.style[o]=this.dragElementOriginStyle[o]||null),setTimeout(()=>r.style.transition=a,50)}return delete this.dragElementOriginStyle,this}_dragFollow(e){const t={left:0,top:0},s=this.helper.style,i=this.dragOffset;s.left=(e.clientX+i.offsetLeft-t.left)*this.dragTransform.xScale+"px",s.top=(e.clientY+i.offsetTop-t.top)*this.dragTransform.yScale+"px"}_setupHelperContainmentStyle(){return this.helperContainment=this.helper.parentElement,this.helper.style.position!=="fixed"&&(this.parentOriginStylePosition=this.helperContainment.style.position,getComputedStyle(this.helperContainment).position.match(/static/)&&(this.helperContainment.style.position="relative")),this}_getDragOffset(e,t,s){let i=0,r=0;s&&(i=this.dragTransform.xOffset,r=this.dragTransform.yOffset);const a=t.getBoundingClientRect();return{left:a.left,top:a.top,offsetLeft:-e.clientX+a.left-i,offsetTop:-e.clientY+a.top-r,width:a.width*this.dragTransform.xScale,height:a.height*this.dragTransform.yScale}}ui(){const t=this.el.parentElement.getBoundingClientRect(),s=this.helper.getBoundingClientRect();return{position:{top:(s.top-t.top)*this.dragTransform.yScale,left:(s.left-t.left)*this.dragTransform.xScale}}}}Q.originStyleProp=["width","height","transform","transform-origin","transition","pointerEvents","position","left","top","minWidth","willChange"];class mt extends ve{constructor(e,t={}){super(),this.el=e,this.option=t,this._mouseEnter=this._mouseEnter.bind(this),this._mouseLeave=this._mouseLeave.bind(this),this.enable(),this._setupAccept()}on(e,t){super.on(e,t)}off(e){super.off(e)}enable(){this.disabled!==!1&&(super.enable(),this.el.classList.add("ui-droppable"),this.el.classList.remove("ui-droppable-disabled"),this.el.addEventListener("mouseenter",this._mouseEnter),this.el.addEventListener("mouseleave",this._mouseLeave),G&&(this.el.addEventListener("pointerenter",Ne),this.el.addEventListener("pointerleave",Ee)))}disable(e=!1){this.disabled!==!0&&(super.disable(),this.el.classList.remove("ui-droppable"),e||this.el.classList.add("ui-droppable-disabled"),this.el.removeEventListener("mouseenter",this._mouseEnter),this.el.removeEventListener("mouseleave",this._mouseLeave),G&&(this.el.removeEventListener("pointerenter",Ne),this.el.removeEventListener("pointerleave",Ee)))}destroy(){this.disable(!0),this.el.classList.remove("ui-droppable"),this.el.classList.remove("ui-droppable-disabled"),super.destroy()}updateOption(e){return Object.keys(e).forEach(t=>this.option[t]=e[t]),this._setupAccept(),this}_mouseEnter(e){if(!b.dragElement||T.touchHandled&&e.isTrusted||!this._canDrop(b.dragElement.el))return;e.preventDefault(),e.stopPropagation(),b.dropElement&&b.dropElement!==this&&b.dropElement._mouseLeave(e,!0),b.dropElement=this;const t=c.initEvent(e,{target:this.el,type:"dropover"});this.option.over&&this.option.over(t,this._ui(b.dragElement)),this.triggerEvent("dropover",t),this.el.classList.add("ui-droppable-over")}_mouseLeave(e,t=!1){var i;if(!b.dragElement||b.dropElement!==this)return;e.preventDefault(),e.stopPropagation();const s=c.initEvent(e,{target:this.el,type:"dropout"});if(this.option.out&&this.option.out(s,this._ui(b.dragElement)),this.triggerEvent("dropout",s),b.dropElement===this&&(delete b.dropElement,!t)){let r,a=this.el.parentElement;for(;!r&&a;)r=(i=a.ddElement)==null?void 0:i.ddDroppable,a=a.parentElement;r&&r._mouseEnter(e)}}drop(e){e.preventDefault();const t=c.initEvent(e,{target:this.el,type:"drop"});this.option.drop&&this.option.drop(t,this._ui(b.dragElement)),this.triggerEvent("drop",t)}_canDrop(e){return e&&(!this.accept||this.accept(e))}_setupAccept(){return this.option.accept?(typeof this.option.accept=="string"?this.accept=e=>e.classList.contains(this.option.accept)||e.matches(this.option.accept):this.accept=this.option.accept,this):this}_ui(e){return{draggable:e.el,...e.ui()}}}class we{static init(e){return e.ddElement||(e.ddElement=new we(e)),e.ddElement}constructor(e){this.el=e}on(e,t){return this.ddDraggable&&["drag","dragstart","dragstop"].indexOf(e)>-1?this.ddDraggable.on(e,t):this.ddDroppable&&["drop","dropover","dropout"].indexOf(e)>-1?this.ddDroppable.on(e,t):this.ddResizable&&["resizestart","resize","resizestop"].indexOf(e)>-1&&this.ddResizable.on(e,t),this}off(e){return this.ddDraggable&&["drag","dragstart","dragstop"].indexOf(e)>-1?this.ddDraggable.off(e):this.ddDroppable&&["drop","dropover","dropout"].indexOf(e)>-1?this.ddDroppable.off(e):this.ddResizable&&["resizestart","resize","resizestop"].indexOf(e)>-1&&this.ddResizable.off(e),this}setupDraggable(e){return this.ddDraggable?this.ddDraggable.updateOption(e):this.ddDraggable=new Q(this.el,e),this}cleanDraggable(){return this.ddDraggable&&(this.ddDraggable.destroy(),delete this.ddDraggable),this}setupResizable(e){return this.ddResizable?this.ddResizable.updateOption(e):this.ddResizable=new K(this.el,e),this}cleanResizable(){return this.ddResizable&&(this.ddResizable.destroy(),delete this.ddResizable),this}setupDroppable(e){return this.ddDroppable?this.ddDroppable.updateOption(e):this.ddDroppable=new mt(this.el,e),this}cleanDroppable(){return this.ddDroppable&&(this.ddDroppable.destroy(),delete this.ddDroppable),this}}class gt{resizable(e,t,s,i){return this._getDDElements(e,t).forEach(r=>{if(t==="disable"||t==="enable")r.ddResizable&&r.ddResizable[t]();else if(t==="destroy")r.ddResizable&&r.cleanResizable();else if(t==="option")r.setupResizable({[s]:i});else{const o=r.el.gridstackNode.grid;let m=r.el.getAttribute("gs-resize-handles")||o.opts.resizable.handles||"e,s,se";m==="all"&&(m="n,e,s,w,se,sw,ne,nw");const u=!o.opts.alwaysShowResizeHandle;r.setupResizable({...o.opts.resizable,handles:m,autoHide:u,start:t.start,stop:t.stop,resize:t.resize})}}),this}draggable(e,t,s,i){return this._getDDElements(e,t).forEach(r=>{if(t==="disable"||t==="enable")r.ddDraggable&&r.ddDraggable[t]();else if(t==="destroy")r.ddDraggable&&r.cleanDraggable();else if(t==="option")r.setupDraggable({[s]:i});else{const a=r.el.gridstackNode.grid;r.setupDraggable({...a.opts.draggable,start:t.start,stop:t.stop,drag:t.drag})}}),this}dragIn(e,t){return this._getDDElements(e).forEach(s=>s.setupDraggable(t)),this}droppable(e,t,s,i){return typeof t.accept=="function"&&!t._accept&&(t._accept=t.accept,t.accept=r=>t._accept(r)),this._getDDElements(e,t).forEach(r=>{t==="disable"||t==="enable"?r.ddDroppable&&r.ddDroppable[t]():t==="destroy"?r.ddDroppable&&r.cleanDroppable():t==="option"?r.setupDroppable({[s]:i}):r.setupDroppable(t)}),this}isDroppable(e){var t;return!!((t=e==null?void 0:e.ddElement)!=null&&t.ddDroppable&&!e.ddElement.ddDroppable.disabled)}isDraggable(e){var t;return!!((t=e==null?void 0:e.ddElement)!=null&&t.ddDraggable&&!e.ddElement.ddDraggable.disabled)}isResizable(e){var t;return!!((t=e==null?void 0:e.ddElement)!=null&&t.ddResizable&&!e.ddElement.ddResizable.disabled)}on(e,t,s){return this._getDDElements(e).forEach(i=>i.on(t,r=>{s(r,b.dragElement?b.dragElement.el:r.target,b.dragElement?b.dragElement.helper:null)})),this}off(e,t){return this._getDDElements(e).forEach(s=>s.off(t)),this}_getDDElements(e,t){const s=e.gridstack||t!=="destroy"&&t!=="disable",i=c.getElements(e);return i.length?i.map(a=>a.ddElement||(s?we.init(a):null)).filter(a=>a):[]}}/*!
 * GridStack 12.4.2
 * https://gridstackjs.com/
 *
 * Copyright (c) 2021-2025  Alain Dumesny
 * see root license https://github.com/gridstack/gridstack.js/tree/master/LICENSE
 */const M=new gt;class y{static init(e={},t=".grid-stack"){if(typeof document>"u")return null;const s=y.getGridElement(t);return s?(s.gridstack||(s.gridstack=new y(s,c.cloneDeep(e))),s.gridstack):(console.error(typeof t=="string"?'GridStack.initAll() no grid was found with selector "'+t+`" - element missing or wrong selector ?
Note: ".grid-stack" is required for proper CSS styling and drag/drop, and is the default selector.`:"GridStack.init() no grid element was passed."),null)}static initAll(e={},t=".grid-stack"){const s=[];return typeof document>"u"||(y.getGridElements(t).forEach(i=>{i.gridstack||(i.gridstack=new y(i,c.cloneDeep(e))),s.push(i.gridstack)}),s.length===0&&console.error('GridStack.initAll() no grid was found with selector "'+t+`" - element missing or wrong selector ?
Note: ".grid-stack" is required for proper CSS styling and drag/drop, and is the default selector.`)),s}static addGrid(e,t={}){if(!e)return null;let s=e;if(s.gridstack){const a=s.gridstack;return t&&(a.opts={...a.opts,...t}),t.children!==void 0&&a.load(t.children),a}return(!e.classList.contains("grid-stack")||y.addRemoveCB)&&(y.addRemoveCB?s=y.addRemoveCB(e,t,!0,!0):s=c.createDiv(["grid-stack",t.class],e)),y.init(t,s)}static registerEngine(e){y.engineClass=e}get placeholder(){if(!this._placeholder){this._placeholder=c.createDiv([this.opts.placeholderClass,A.itemClass,this.opts.itemClass]);const e=c.createDiv(["placeholder-content"],this._placeholder);this.opts.placeholderText&&(e.textContent=this.opts.placeholderText)}return this._placeholder}constructor(e,t={}){var u;this.el=e,this.opts=t,this.animationDelay=310,this._gsEventHandler={},this._extraDragRow=0,this.dragTransform={xScale:1,yScale:1,xOffset:0,yOffset:0},e.gridstack=this,this.opts=t=t||{},e.classList.contains("grid-stack")||this.el.classList.add("grid-stack"),t.row&&(t.minRow=t.maxRow=t.row,delete t.row);const s=c.toNumber(e.getAttribute("gs-row"));t.column==="auto"&&delete t.column,t.alwaysShowResizeHandle!==void 0&&(t._alwaysShowResizeHandle=t.alwaysShowResizeHandle);const i=t.columnOpts;if(i){const l=i.breakpoints;!i.columnWidth&&!(l!=null&&l.length)?delete t.columnOpts:(i.columnMax=i.columnMax||12,(l==null?void 0:l.length)>1&&l.sort((h,g)=>(g.w||0)-(h.w||0)))}const r={...c.cloneDeep(A),column:c.toNumber(e.getAttribute("gs-column"))||A.column,minRow:s||c.toNumber(e.getAttribute("gs-min-row"))||A.minRow,maxRow:s||c.toNumber(e.getAttribute("gs-max-row"))||A.maxRow,staticGrid:c.toBool(e.getAttribute("gs-static"))||A.staticGrid,sizeToContent:c.toBool(e.getAttribute("gs-size-to-content"))||void 0,draggable:{handle:(t.handleClass?"."+t.handleClass:t.handle?t.handle:"")||A.draggable.handle},removableOptions:{accept:t.itemClass||A.removableOptions.accept,decline:A.removableOptions.decline}};e.getAttribute("gs-animate")&&(r.animate=c.toBool(e.getAttribute("gs-animate"))),t=c.defaults(t,r),this._initMargin(),this.checkDynamicColumn(),this._updateColumnVar(t),t.rtl==="auto"&&(t.rtl=e.style.direction==="rtl"),t.rtl&&this.el.classList.add("grid-stack-rtl");const a=this.el.closest("."+A.itemClass),o=a==null?void 0:a.gridstackNode;if(o&&(o.subGrid=this,this.parentGridNode=o,this.el.classList.add("grid-stack-nested"),o.el.classList.add("grid-stack-sub-grid")),this._isAutoCellHeight=t.cellHeight==="auto",this._isAutoCellHeight||t.cellHeight==="initial")this.cellHeight(void 0);else{typeof t.cellHeight=="number"&&t.cellHeightUnit&&t.cellHeightUnit!==A.cellHeightUnit&&(t.cellHeight=t.cellHeight+t.cellHeightUnit,delete t.cellHeightUnit);const l=t.cellHeight;delete t.cellHeight,this.cellHeight(l)}t.alwaysShowResizeHandle==="mobile"&&(t.alwaysShowResizeHandle=G),this._setStaticClass();const m=t.engineClass||y.engineClass||q;if(this.engine=new m({column:this.getColumn(),float:t.float,maxRow:t.maxRow,onChange:l=>{l.forEach(h=>{const g=h.el;g&&(h._removeDOM?(g&&g.remove(),delete h._removeDOM):this._writePosAttr(g,h))}),this._updateContainerHeight()}}),t.auto&&(this.batchUpdate(),this.engine._loading=!0,this.getGridItems().forEach(l=>this._prepareElement(l)),delete this.engine._loading,this.batchUpdate(!1)),t.children){const l=t.children;delete t.children,l.length&&this.load(l)}this.setAnimation(),t.subGridDynamic&&!b.pauseDrag&&(b.pauseDrag=!0),((u=t.draggable)==null?void 0:u.pause)!==void 0&&(b.pauseDrag=t.draggable.pause),this._setupRemoveDrop(),this._setupAcceptWidget(),this._updateResizeEvent()}_updateColumnVar(e=this.opts){this.el.classList.add("gs-"+e.column),typeof e.column=="number"&&this.el.style.setProperty("--gs-column-width",`${100/e.column}%`)}addWidget(e){if(!e)return;if(typeof e=="string"){console.error("V11: GridStack.addWidget() does not support string anymore. see #2736");return}if(e.ELEMENT_NODE)return console.error("V11: GridStack.addWidget() does not support HTMLElement anymore. use makeWidget()"),this.makeWidget(e);let t,s=e;if(s.grid=this,s.el?t=s.el:y.addRemoveCB?t=y.addRemoveCB(this.el,e,!0,!1):t=this.createWidgetDivs(s),!t)return;if(s=t.gridstackNode,s&&t.parentElement===this.el&&this.engine.nodes.find(r=>r._id===s._id))return t;const i=this._readAttr(t);return c.defaults(e,i),this.engine.prepareNode(e),this.el.appendChild(t),this.makeWidget(t,e),t}createWidgetDivs(e){const t=c.createDiv(["grid-stack-item",this.opts.itemClass]),s=c.createDiv(["grid-stack-item-content"],t);return c.lazyLoad(e)?e.visibleObservable||(e.visibleObservable=new IntersectionObserver(([i])=>{var r,a;i.isIntersecting&&((r=e.visibleObservable)==null||r.disconnect(),delete e.visibleObservable,y.renderCB(s,e),(a=e.grid)==null||a.prepareDragDrop(e.el))}),window.setTimeout(()=>{var i;return(i=e.visibleObservable)==null?void 0:i.observe(t)})):y.renderCB(s,e),t}makeSubGrid(e,t,s,i=!0){var p,v,f;let r=e.gridstackNode;if(r||(r=this.makeWidget(e).gridstackNode),(p=r.subGrid)!=null&&p.el)return r.subGrid;let a,o=this;for(;o&&!a;)a=(v=o.opts)==null?void 0:v.subGridOpts,o=(f=o.parentGridNode)==null?void 0:f.grid;t=c.cloneDeep({...this.opts,id:void 0,children:void 0,column:"auto",columnOpts:void 0,layout:"list",subGridOpts:void 0,...a||{},...t||r.subGridOpts||{}}),r.subGridOpts=t;let m;t.column==="auto"&&(m=!0,t.column=Math.max(r.w||1,(s==null?void 0:s.w)||1),delete t.columnOpts);let u=r.el.querySelector(".grid-stack-item-content"),l,h;if(i&&(this._removeDD(r.el),h={...r,x:0,y:0},c.removeInternalForSave(h),delete h.subGridOpts,r.content&&(h.content=r.content,delete r.content),y.addRemoveCB?l=y.addRemoveCB(this.el,h,!0,!1):(l=c.createDiv(["grid-stack-item"]),l.appendChild(u),u=c.createDiv(["grid-stack-item-content"],r.el)),this.prepareDragDrop(r.el)),s){const C=m?t.column:r.w,k=r.h+s.h,j=r.el.style;j.transition="none",this.update(r.el,{w:C,h:k}),setTimeout(()=>j.transition=null)}const g=r.subGrid=y.addGrid(u,t);return s!=null&&s._moving&&(g._isTemp=!0),m&&(g._autoColumn=!0),i&&g.makeWidget(l,h),s&&(s._moving?window.setTimeout(()=>c.simulateMouseEvent(s._event,"mouseenter",g.el),0):g.makeWidget(r.el,r)),this.resizeToContentCheck(!1,r),g}removeAsSubGrid(e){var s;const t=(s=this.parentGridNode)==null?void 0:s.grid;t&&(t.batchUpdate(),t.removeWidget(this.parentGridNode.el,!0,!0),this.engine.nodes.forEach(i=>{i.x+=this.parentGridNode.x,i.y+=this.parentGridNode.y,t.makeWidget(i.el,i)}),t.batchUpdate(!1),this.parentGridNode&&delete this.parentGridNode.subGrid,delete this.parentGridNode,e&&window.setTimeout(()=>c.simulateMouseEvent(e._event,"mouseenter",t.el),0))}save(e=!0,t=!1,s=y.saveCB,i){const r=this.engine.save(e,s,i);if(r.forEach(a=>{var o;if(e&&a.el&&!a.subGrid&&!s){const m=a.el.querySelector(".grid-stack-item-content");a.content=m==null?void 0:m.innerHTML,a.content||delete a.content}else if(!e&&!s&&delete a.content,(o=a.subGrid)!=null&&o.el){const m=a.w||a.subGrid.getColumn(),u=a.subGrid.save(e,t,s,m);a.subGridOpts=t?u:{children:u},delete a.subGrid}delete a.el}),t){const a=c.cloneDeep(this.opts);a.marginBottom===a.marginTop&&a.marginRight===a.marginLeft&&a.marginTop===a.marginRight&&(a.margin=a.marginTop,delete a.marginTop,delete a.marginRight,delete a.marginBottom,delete a.marginLeft),a.rtl===(this.el.style.direction==="rtl")&&(a.rtl="auto"),this._isAutoCellHeight&&(a.cellHeight="auto"),this._autoColumn&&(a.column="auto");const o=a._alwaysShowResizeHandle;return delete a._alwaysShowResizeHandle,o!==void 0?a.alwaysShowResizeHandle=o:delete a.alwaysShowResizeHandle,c.removeInternalAndSame(a,A),a.children=r,a}return r}load(e,t=y.addRemoveCB||!0){e=c.cloneDeep(e);const s=this.getColumn();e.forEach(l=>{l.w=l.w||l.minW||1,l.h=l.h||l.minH||1}),e=c.sort(e),this.engine.skipCacheUpdate=this._ignoreLayoutsNodeChange=!0;let i=0;e.forEach(l=>{i=Math.max(i,(l.x||0)+l.w)}),i>this.engine.defaultColumn&&(this.engine.defaultColumn=i),i>s&&(this.engine.nodes.length===0&&this.responseLayout?(this.engine.nodes=e,this.engine.columnChanged(i,s,this.responseLayout),e=this.engine.nodes,this.engine.nodes=[],delete this.responseLayout):this.engine.cacheLayout(e,i,!0));const r=y.addRemoveCB;typeof t=="function"&&(y.addRemoveCB=t);const a=[];this.batchUpdate();const o=!this.engine.nodes.length,m=o&&this.opts.animate;m&&this.setAnimation(!1),!o&&t&&[...this.engine.nodes].forEach(h=>{if(!h.id)return;c.find(e,h.id)||(y.addRemoveCB&&y.addRemoveCB(this.el,h,!1,!1),a.push(h),this.removeWidget(h.el,!0,!1))}),this.engine._loading=!0;const u=[];return this.engine.nodes=this.engine.nodes.filter(l=>c.find(e,l.id)?(u.push(l),!1):!0),e.forEach(l=>{var g;const h=c.find(u,l.id);if(h){if(c.shouldSizeToContent(h)&&(l.h=h.h),this.engine.nodeBoundFix(l),(l.autoPosition||l.x===void 0||l.y===void 0)&&(l.w=l.w||h.w,l.h=l.h||h.h,this.engine.findEmptyPosition(l)),this.engine.nodes.push(h),c.samePos(h,l)&&this.engine.nodes.length>1&&(this.moveNode(h,{...l,forceCollide:!0}),c.copyPos(l,h)),this.update(h.el,l),(g=l.subGridOpts)!=null&&g.children){const p=h.el.querySelector(".grid-stack");p&&p.gridstack&&p.gridstack.load(l.subGridOpts.children)}}else t&&this.addWidget(l)}),delete this.engine._loading,this.engine.removedNodes=a,this.batchUpdate(!1),delete this._ignoreLayoutsNodeChange,delete this.engine.skipCacheUpdate,r?y.addRemoveCB=r:delete y.addRemoveCB,m&&this.setAnimation(!0,!0),this}batchUpdate(e=!0){return this.engine.batchUpdate(e),e||(this._updateContainerHeight(),this._triggerRemoveEvent(),this._triggerAddEvent(),this._triggerChangeEvent()),this}getCellHeight(e=!1){if(this.opts.cellHeight&&this.opts.cellHeight!=="auto"&&(!e||!this.opts.cellHeightUnit||this.opts.cellHeightUnit==="px"))return this.opts.cellHeight;if(this.opts.cellHeightUnit==="rem")return this.opts.cellHeight*parseFloat(getComputedStyle(document.documentElement).fontSize);if(this.opts.cellHeightUnit==="em")return this.opts.cellHeight*parseFloat(getComputedStyle(this.el).fontSize);if(this.opts.cellHeightUnit==="cm")return this.opts.cellHeight*(96/2.54);if(this.opts.cellHeightUnit==="mm")return this.opts.cellHeight*(96/2.54)/10;const t=this.el.querySelector("."+this.opts.itemClass);if(t){const i=c.toNumber(t.getAttribute("gs-h"))||1;return Math.round(t.offsetHeight/i)}const s=parseInt(this.el.getAttribute("gs-current-row"));return s?Math.round(this.el.getBoundingClientRect().height/s):this.opts.cellHeight}cellHeight(e){if(e!==void 0&&this._isAutoCellHeight!==(e==="auto")&&(this._isAutoCellHeight=e==="auto",this._updateResizeEvent()),(e==="initial"||e==="auto")&&(e=void 0),e===void 0){const s=-this.opts.marginRight-this.opts.marginLeft+this.opts.marginTop+this.opts.marginBottom;e=this.cellWidth()+s}const t=c.parseHeight(e);return this.opts.cellHeightUnit===t.unit&&this.opts.cellHeight===t.h?this:(this.opts.cellHeightUnit=t.unit,this.opts.cellHeight=t.h,this.el.style.setProperty("--gs-cell-height",`${this.opts.cellHeight}${this.opts.cellHeightUnit}`),this._updateContainerHeight(),this.resizeToContentCheck(),this)}cellWidth(){return this._widthOrContainer()/this.getColumn()}_widthOrContainer(e=!1){var t;return e&&((t=this.opts.columnOpts)!=null&&t.breakpointForWindow)?window.innerWidth:this.el.clientWidth||this.el.parentElement.clientWidth||window.innerWidth}checkDynamicColumn(){var r,a;const e=this.opts.columnOpts;if(!e||!e.columnWidth&&!((r=e.breakpoints)!=null&&r.length))return!1;const t=this.getColumn();let s=t;const i=this._widthOrContainer(!0);if(e.columnWidth)s=Math.min(Math.round(i/e.columnWidth)||1,e.columnMax);else{s=e.columnMax;let o=0;for(;o<e.breakpoints.length&&i<=e.breakpoints[o].w;)s=e.breakpoints[o++].c||t}if(s!==t){const o=(a=e.breakpoints)==null?void 0:a.find(m=>m.c===s);return this.column(s,(o==null?void 0:o.layout)||e.layout),!0}return!1}compact(e="compact",t=!0){return this.engine.compact(e,t),this._triggerChangeEvent(),this}column(e,t="moveScale"){if(!e||e<1||this.opts.column===e)return this;const s=this.getColumn();return this.opts.column=e,this.engine?(this.engine.column=e,this.el.classList.remove("gs-"+s),this._updateColumnVar(),this.engine.columnChanged(s,e,t),this._isAutoCellHeight&&this.cellHeight(),this.resizeToContentCheck(!0),this._ignoreLayoutsNodeChange=!0,this._triggerChangeEvent(),delete this._ignoreLayoutsNodeChange,this):(this.responseLayout=t,this)}getColumn(){return this.opts.column}getGridItems(){return Array.from(this.el.children).filter(e=>e.matches("."+this.opts.itemClass)&&!e.matches("."+this.opts.placeholderClass))}isIgnoreChangeCB(){return this._ignoreLayoutsNodeChange}destroy(e=!0){var t;if(this.el)return this.offAll(),this._updateResizeEvent(!0),this.setStatic(!0,!1),this.setAnimation(!1),e?this.el.parentNode.removeChild(this.el):(this.removeAll(e),this.el.removeAttribute("gs-current-row")),this.parentGridNode&&delete this.parentGridNode.subGrid,delete this.parentGridNode,delete this.opts,(t=this._placeholder)==null||delete t.gridstackNode,delete this._placeholder,delete this.engine,delete this.el.gridstack,delete this.el,this}float(e){return this.opts.float!==e&&(this.opts.float=this.engine.float=e,this._triggerChangeEvent()),this}getFloat(){return this.engine.float}getCellFromPixel(e,t=!1){const s=this.el.getBoundingClientRect();let i;t?i={top:s.top+document.documentElement.scrollTop,left:s.left}:i={top:this.el.offsetTop,left:this.el.offsetLeft};const r=e.left-i.left,a=e.top-i.top,o=s.width/this.getColumn(),m=s.height/parseInt(this.el.getAttribute("gs-current-row"));return{x:Math.floor(r/o),y:Math.floor(a/m)}}getRow(){return Math.max(this.engine.getRow(),this.opts.minRow||0)}isAreaEmpty(e,t,s,i){return this.engine.isAreaEmpty(e,t,s,i)}makeWidget(e,t){const s=y.getElement(e);if(!s||s.gridstackNode)return s;s.parentElement||this.el.appendChild(s),this._prepareElement(s,!0,t);const i=s.gridstackNode;this._updateContainerHeight(),i.subGridOpts&&this.makeSubGrid(s,i.subGridOpts,void 0,!1);let r;return this.opts.column===1&&!this._ignoreLayoutsNodeChange&&(r=this._ignoreLayoutsNodeChange=!0),this._triggerAddEvent(),this._triggerChangeEvent(),r&&delete this._ignoreLayoutsNodeChange,s}on(e,t){return e.indexOf(" ")!==-1?(e.split(" ").forEach(i=>this.on(i,t)),this):(e==="change"||e==="added"||e==="removed"||e==="enable"||e==="disable"?(e==="enable"||e==="disable"?this._gsEventHandler[e]=i=>t(i):this._gsEventHandler[e]=i=>{i.detail&&t(i,i.detail)},this.el.addEventListener(e,this._gsEventHandler[e])):e==="drag"||e==="dragstart"||e==="dragstop"||e==="resizestart"||e==="resize"||e==="resizestop"||e==="dropped"||e==="resizecontent"?this._gsEventHandler[e]=t:console.error("GridStack.on("+e+") event not supported"),this)}off(e){return e.indexOf(" ")!==-1?(e.split(" ").forEach(s=>this.off(s)),this):((e==="change"||e==="added"||e==="removed"||e==="enable"||e==="disable")&&this._gsEventHandler[e]&&this.el.removeEventListener(e,this._gsEventHandler[e]),delete this._gsEventHandler[e],this)}offAll(){return Object.keys(this._gsEventHandler).forEach(e=>this.off(e)),this}removeWidget(e,t=!0,s=!0){return e?(y.getElements(e).forEach(i=>{if(i.parentElement&&i.parentElement!==this.el)return;let r=i.gridstackNode;r||(r=this.engine.nodes.find(a=>i===a.el)),r&&(t&&y.addRemoveCB&&y.addRemoveCB(this.el,r,!1,!1),delete i.gridstackNode,this._removeDD(i),this.engine.removeNode(r,t,s),t&&i.parentElement&&i.remove())}),s&&(this._triggerRemoveEvent(),this._triggerChangeEvent()),this):(console.error("Error: GridStack.removeWidget(undefined) called"),this)}removeAll(e=!0,t=!0){return this.engine.nodes.forEach(s=>{e&&y.addRemoveCB&&y.addRemoveCB(this.el,s,!1,!1),delete s.el.gridstackNode,this.opts.staticGrid||this._removeDD(s.el)}),this.engine.removeAll(e,t),t&&this._triggerRemoveEvent(),this}setAnimation(e=this.opts.animate,t){return t?setTimeout(()=>{this.opts&&this.setAnimation(e)}):e?this.el.classList.add("grid-stack-animate"):this.el.classList.remove("grid-stack-animate"),this.opts.animate=e,this}hasAnimationCSS(){return this.el.classList.contains("grid-stack-animate")}setStatic(e,t=!0,s=!0){return!!this.opts.staticGrid===e?this:(e?this.opts.staticGrid=!0:delete this.opts.staticGrid,this._setupRemoveDrop(),this._setupAcceptWidget(),this.engine.nodes.forEach(i=>{this.prepareDragDrop(i.el),i.subGrid&&s&&i.subGrid.setStatic(e,t,s)}),t&&this._setStaticClass(),this)}updateOptions(e){var s;const t=this.opts;return e===t?this:(e.acceptWidgets!==void 0&&(t.acceptWidgets=e.acceptWidgets,this._setupAcceptWidget()),e.animate!==void 0&&this.setAnimation(e.animate),e.cellHeight&&this.cellHeight(e.cellHeight),e.class!==void 0&&e.class!==t.class&&(t.class&&this.el.classList.remove(t.class),e.class&&this.el.classList.add(e.class)),e.columnOpts?(this.opts.columnOpts=e.columnOpts,this.checkDynamicColumn()):e.columnOpts===null&&this.opts.columnOpts?(delete this.opts.columnOpts,this._updateResizeEvent()):typeof e.column=="number"&&this.column(e.column),e.margin!==void 0&&this.margin(e.margin),e.staticGrid!==void 0&&this.setStatic(e.staticGrid),e.disableDrag!==void 0&&!e.staticGrid&&this.enableMove(!e.disableDrag),e.disableResize!==void 0&&!e.staticGrid&&this.enableResize(!e.disableResize),e.float!==void 0&&this.float(e.float),e.row!==void 0?(t.minRow=t.maxRow=t.row=e.row,this._updateContainerHeight()):(e.minRow!==void 0&&(t.minRow=e.minRow,this._updateContainerHeight()),e.maxRow!==void 0&&(t.maxRow=e.maxRow)),e.lazyLoad!==void 0&&(t.lazyLoad=e.lazyLoad),(s=e.children)!=null&&s.length&&this.load(e.children),this)}update(e,t){return y.getElements(e).forEach(s=>{var l;const i=s==null?void 0:s.gridstackNode;if(!i)return;const r={...c.copyPos({},i),...c.cloneDeep(t)};this.engine.nodeBoundFix(r),delete r.autoPosition;const a=["x","y","w","h"];let o;if(a.some(h=>r[h]!==void 0&&r[h]!==i[h])&&(o={},a.forEach(h=>{o[h]=r[h]!==void 0?r[h]:i[h],delete r[h]})),!o&&(r.minW||r.minH||r.maxW||r.maxH)&&(o={}),r.content!==void 0){const h=s.querySelector(".grid-stack-item-content");h&&h.textContent!==r.content&&(i.content=r.content,y.renderCB(h,r),(l=i.subGrid)!=null&&l.el&&(h.appendChild(i.subGrid.el),i.subGrid._updateContainerHeight())),delete r.content}let m=!1,u=!1;for(const h in r)h[0]!=="_"&&i[h]!==r[h]&&(i[h]=r[h],m=!0,u=u||!this.opts.staticGrid&&(h==="noResize"||h==="noMove"||h==="locked"));if(c.sanitizeMinMax(i),o){const h=o.w!==void 0&&o.w!==i.w;this.moveNode(i,o),h&&i.subGrid?i.subGrid.onResize(this.hasAnimationCSS()?i.w:void 0):this.resizeToContentCheck(h,i),delete i._orig}(o||m)&&this._writeAttr(s,i),u&&this.prepareDragDrop(i.el),y.updateCB&&y.updateCB(i)}),this}moveNode(e,t){const s=e._updating;s||this.engine.cleanNodes().beginUpdate(e),this.engine.moveNode(e,t),this._updateContainerHeight(),s||(this._triggerChangeEvent(),this.engine.endUpdate())}resizeToContent(e){var g,p;if(!e||(e.classList.remove("size-to-content-max"),!e.clientHeight))return;const t=e.gridstackNode;if(!t)return;const s=t.grid;if(!s||e.parentElement!==s.el)return;const i=s.getCellHeight(!0);if(!i)return;let r=t.h?t.h*i:e.clientHeight,a;if(t.resizeToContentParent&&(a=e.querySelector(t.resizeToContentParent)),a||(a=e.querySelector(y.resizeToContentParent)),!a)return;const o=e.clientHeight-a.clientHeight,m=t.h?t.h*i-o:a.clientHeight;let u;if(t.subGrid){u=t.subGrid.getRow()*t.subGrid.getCellHeight(!0);const v=t.subGrid.el.getBoundingClientRect(),f=e.getBoundingClientRect();u+=v.top-f.top}else{if((p=(g=t.subGridOpts)==null?void 0:g.children)!=null&&p.length)return;{const v=a.firstElementChild;if(!v){console.error(`Error: GridStack.resizeToContent() widget id:${t.id} '${y.resizeToContentParent}'.firstElementChild is null, make sure to have a div like container. Skipping sizing.`);return}u=v.getBoundingClientRect().height||m}}if(m===u)return;r+=u-m;let l=Math.ceil(r/i);const h=Number.isInteger(t.sizeToContent)?t.sizeToContent:0;h&&l>h&&(l=h,e.classList.add("size-to-content-max")),t.minH&&l<t.minH?l=t.minH:t.maxH&&l>t.maxH&&(l=t.maxH),l!==t.h&&(s._ignoreLayoutsNodeChange=!0,s.moveNode(t,{h:l}),delete s._ignoreLayoutsNodeChange)}resizeToContentCBCheck(e){y.resizeToContentCB?y.resizeToContentCB(e):this.resizeToContent(e)}rotate(e,t){return y.getElements(e).forEach(s=>{const i=s.gridstackNode;if(!c.canBeRotated(i))return;const r={w:i.h,h:i.w,minH:i.minW,minW:i.minH,maxH:i.maxW,maxW:i.maxH};if(t){const o=t.left>0?Math.floor(t.left/this.cellWidth()):0,m=t.top>0?Math.floor(t.top/this.opts.cellHeight):0;r.x=i.x+o-(i.h-(m+1)),r.y=i.y+m-o}Object.keys(r).forEach(o=>{r[o]===void 0&&delete r[o]});const a=i._orig;this.update(s,r),i._orig=a}),this}margin(e){if(!(typeof e=="string"&&e.split(" ").length>1)){const s=c.parseHeight(e);if(this.opts.marginUnit===s.unit&&this.opts.margin===s.h)return}return this.opts.margin=e,this.opts.marginTop=this.opts.marginBottom=this.opts.marginLeft=this.opts.marginRight=void 0,this._initMargin(),this}getMargin(){return this.opts.margin}willItFit(e){return this.engine.willItFit(e)}_triggerChangeEvent(){if(this.engine.batchMode)return this;const e=this.engine.getDirtyNodes(!0);return e&&e.length&&(this._ignoreLayoutsNodeChange||this.engine.layoutsNodesChange(e),this._triggerEvent("change",e)),this.engine.saveInitial(),this}_triggerAddEvent(){var e;if(this.engine.batchMode)return this;if((e=this.engine.addedNodes)!=null&&e.length){this._ignoreLayoutsNodeChange||this.engine.layoutsNodesChange(this.engine.addedNodes),this.engine.addedNodes.forEach(s=>{delete s._dirty});const t=[...this.engine.addedNodes];this.engine.addedNodes=[],this._triggerEvent("added",t)}return this}_triggerRemoveEvent(){var e;if(this.engine.batchMode)return this;if((e=this.engine.removedNodes)!=null&&e.length){const t=[...this.engine.removedNodes];this.engine.removedNodes=[],this._triggerEvent("removed",t)}return this}_triggerEvent(e,t){const s=t?new CustomEvent(e,{bubbles:!1,detail:t}):new Event(e);let i=this;for(;i.parentGridNode;)i=i.parentGridNode.grid;return i.el.dispatchEvent(s),this}_updateContainerHeight(){if(!this.engine||this.engine.batchMode)return this;const e=this.parentGridNode;let t=this.getRow()+this._extraDragRow;const s=this.opts.cellHeight,i=this.opts.cellHeightUnit;if(!s)return this;if(!e&&!this.opts.minRow){const r=c.parseHeight(getComputedStyle(this.el).minHeight);if(r.h>0&&r.unit===i){const a=Math.floor(r.h/s);t<a&&(t=a)}}return this.el.setAttribute("gs-current-row",String(t)),this.el.style.removeProperty("min-height"),this.el.style.removeProperty("height"),t&&(this.el.style[e?"minHeight":"height"]=t*s+i),e&&c.shouldSizeToContent(e)&&e.grid.resizeToContentCBCheck(e.el),this}_prepareElement(e,t=!1,s){s=s||this._readAttr(e),e.gridstackNode=s,s.el=e,s.grid=this,s=this.engine.addNode(s,t),this._writeAttr(e,s),e.classList.add(A.itemClass,this.opts.itemClass);const i=c.shouldSizeToContent(s);return i?e.classList.add("size-to-content"):e.classList.remove("size-to-content"),i&&this.resizeToContentCheck(!1,s),c.lazyLoad(s)||this.prepareDragDrop(s.el),this}_writePosAttr(e,t){return(!t._moving&&!t._resizing||this._placeholder===e)&&(e.style.top=t.y?t.y===1?"var(--gs-cell-height)":`calc(${t.y} * var(--gs-cell-height))`:null,e.style.left=t.x?t.x===1?"var(--gs-column-width)":`calc(${t.x} * var(--gs-column-width))`:null,e.style.width=t.w>1?`calc(${t.w} * var(--gs-column-width))`:null,e.style.height=t.h>1?`calc(${t.h} * var(--gs-cell-height))`:null),e.setAttribute("gs-x",String(t.x)),e.setAttribute("gs-y",String(t.y)),t.w>1?e.setAttribute("gs-w",String(t.w)):e.removeAttribute("gs-w"),t.h>1?e.setAttribute("gs-h",String(t.h)):e.removeAttribute("gs-h"),this}_writeAttr(e,t){if(!t)return this;this._writePosAttr(e,t);const s={noResize:"gs-no-resize",noMove:"gs-no-move",locked:"gs-locked",id:"gs-id",sizeToContent:"gs-size-to-content"};for(const i in s)t[i]?e.setAttribute(s[i],String(t[i])):e.removeAttribute(s[i]);return this}_readAttr(e,t=!0){const s={};s.x=c.toNumber(e.getAttribute("gs-x")),s.y=c.toNumber(e.getAttribute("gs-y")),s.w=c.toNumber(e.getAttribute("gs-w")),s.h=c.toNumber(e.getAttribute("gs-h")),s.autoPosition=c.toBool(e.getAttribute("gs-auto-position")),s.noResize=c.toBool(e.getAttribute("gs-no-resize")),s.noMove=c.toBool(e.getAttribute("gs-no-move")),s.locked=c.toBool(e.getAttribute("gs-locked"));const i=e.getAttribute("gs-size-to-content");i&&(i==="true"||i==="false"?s.sizeToContent=c.toBool(i):s.sizeToContent=parseInt(i,10)),s.id=e.getAttribute("gs-id"),s.maxW=c.toNumber(e.getAttribute("gs-max-w")),s.minW=c.toNumber(e.getAttribute("gs-min-w")),s.maxH=c.toNumber(e.getAttribute("gs-max-h")),s.minH=c.toNumber(e.getAttribute("gs-min-h")),t&&(s.w===1&&e.removeAttribute("gs-w"),s.h===1&&e.removeAttribute("gs-h"),s.maxW&&e.removeAttribute("gs-max-w"),s.minW&&e.removeAttribute("gs-min-w"),s.maxH&&e.removeAttribute("gs-max-h"),s.minH&&e.removeAttribute("gs-min-h"));for(const r in s){if(!s.hasOwnProperty(r))return;!s[r]&&s[r]!==0&&r!=="sizeToContent"&&delete s[r]}return s}_setStaticClass(){const e=["grid-stack-static"];return this.opts.staticGrid?(this.el.classList.add(...e),this.el.setAttribute("gs-static","true")):(this.el.classList.remove(...e),this.el.removeAttribute("gs-static")),this}onResize(e=(t=>(t=this.el)==null?void 0:t.clientWidth)()){if(!e||this.prevWidth===e)return;this.prevWidth=e,this.batchUpdate();let s=!1;return this._autoColumn&&this.parentGridNode?this.opts.column!==this.parentGridNode.w&&(this.column(this.parentGridNode.w,this.opts.layout||"list"),s=!0):s=this.checkDynamicColumn(),this._isAutoCellHeight&&this.cellHeight(),this.engine.nodes.forEach(i=>{i.subGrid&&i.subGrid.onResize()}),this._skipInitialResize||this.resizeToContentCheck(s),delete this._skipInitialResize,this.batchUpdate(!1),this}resizeToContentCheck(e=!1,t=void 0){if(this.engine){if(e&&this.hasAnimationCSS())return setTimeout(()=>this.resizeToContentCheck(!1,t),this.animationDelay);if(t)c.shouldSizeToContent(t)&&this.resizeToContentCBCheck(t.el);else if(this.engine.nodes.some(s=>c.shouldSizeToContent(s))){const s=[...this.engine.nodes];this.batchUpdate(),s.forEach(i=>{c.shouldSizeToContent(i)&&this.resizeToContentCBCheck(i.el)}),this._ignoreLayoutsNodeChange=!0,this.batchUpdate(!1),this._ignoreLayoutsNodeChange=!1}this._gsEventHandler.resizecontent&&this._gsEventHandler.resizecontent(null,t?[t]:this.engine.nodes)}}_updateResizeEvent(e=!1){const t=!this.parentGridNode&&(this._isAutoCellHeight||this.opts.sizeToContent||this.opts.columnOpts||this.engine.nodes.find(s=>s.sizeToContent));return!e&&t&&!this.resizeObserver?(this._sizeThrottle=c.throttle(()=>this.onResize(),this.opts.cellHeightThrottle),this.resizeObserver=new ResizeObserver(()=>this._sizeThrottle()),this.resizeObserver.observe(this.el),this._skipInitialResize=!0):(e||!t)&&this.resizeObserver&&(this.resizeObserver.disconnect(),delete this.resizeObserver,delete this._sizeThrottle),this}static getElement(e=".grid-stack-item"){return c.getElement(e)}static getElements(e=".grid-stack-item"){return c.getElements(e)}static getGridElement(e){return y.getElement(e)}static getGridElements(e){return c.getElements(e)}_initMargin(){let e,t=0,s=[];typeof this.opts.margin=="string"&&(s=this.opts.margin.split(" ")),s.length===2?(this.opts.marginTop=this.opts.marginBottom=s[0],this.opts.marginLeft=this.opts.marginRight=s[1]):s.length===4?(this.opts.marginTop=s[0],this.opts.marginRight=s[1],this.opts.marginBottom=s[2],this.opts.marginLeft=s[3]):(e=c.parseHeight(this.opts.margin),this.opts.marginUnit=e.unit,t=this.opts.margin=e.h),["marginTop","marginRight","marginBottom","marginLeft"].forEach(a=>{this.opts[a]===void 0?this.opts[a]=t:(e=c.parseHeight(this.opts[a]),this.opts[a]=e.h,delete this.opts.margin)}),this.opts.marginUnit=e.unit,this.opts.marginTop===this.opts.marginBottom&&this.opts.marginLeft===this.opts.marginRight&&this.opts.marginTop===this.opts.marginRight&&(this.opts.margin=this.opts.marginTop);const r=this.el.style;return r.setProperty("--gs-item-margin-top",`${this.opts.marginTop}${this.opts.marginUnit}`),r.setProperty("--gs-item-margin-bottom",`${this.opts.marginBottom}${this.opts.marginUnit}`),r.setProperty("--gs-item-margin-right",`${this.opts.marginRight}${this.opts.marginUnit}`),r.setProperty("--gs-item-margin-left",`${this.opts.marginLeft}${this.opts.marginUnit}`),this}static getDD(){return M}static setupDragIn(e,t,s,i=document){(t==null?void 0:t.pause)!==void 0&&(b.pauseDrag=t.pause),t={appendTo:"body",helper:"clone",...t||{}},(typeof e=="string"?c.getElements(e,i):e).forEach((a,o)=>{M.isDraggable(a)||M.dragIn(a,t),s!=null&&s[o]&&(a.gridstackNode=s[o])})}movable(e,t){return this.opts.staticGrid?this:(y.getElements(e).forEach(s=>{const i=s.gridstackNode;i&&(t?delete i.noMove:i.noMove=!0,this.prepareDragDrop(i.el))}),this)}resizable(e,t){return this.opts.staticGrid?this:(y.getElements(e).forEach(s=>{const i=s.gridstackNode;i&&(t?delete i.noResize:i.noResize=!0,this.prepareDragDrop(i.el))}),this)}disable(e=!0){if(!this.opts.staticGrid)return this.enableMove(!1,e),this.enableResize(!1,e),this._triggerEvent("disable"),this}enable(e=!0){if(!this.opts.staticGrid)return this.enableMove(!0,e),this.enableResize(!0,e),this._triggerEvent("enable"),this}enableMove(e,t=!0){return this.opts.staticGrid?this:(e?delete this.opts.disableDrag:this.opts.disableDrag=!0,this.engine.nodes.forEach(s=>{this.prepareDragDrop(s.el),s.subGrid&&t&&s.subGrid.enableMove(e,t)}),this)}enableResize(e,t=!0){return this.opts.staticGrid?this:(e?delete this.opts.disableResize:this.opts.disableResize=!0,this.engine.nodes.forEach(s=>{this.prepareDragDrop(s.el),s.subGrid&&t&&s.subGrid.enableResize(e,t)}),this)}cancelDrag(){var t;const e=(t=this._placeholder)==null?void 0:t.gridstackNode;e&&(e._isExternal?(e._isAboutToRemove=!0,this.engine.removeNode(e)):e._isAboutToRemove&&y._itemRemoving(e.el,!1),this.engine.restoreInitial())}_removeDD(e){return M.draggable(e,"destroy").resizable(e,"destroy"),e.gridstackNode&&delete e.gridstackNode._initDD,delete e.ddElement,this}_setupAcceptWidget(){if(this.opts.staticGrid||!this.opts.acceptWidgets&&!this.opts.removable)return M.droppable(this.el,"destroy"),this;let e,t;const s=(i,r,a)=>{var g;a=a||r;const o=a.gridstackNode;if(!o)return;if(!((g=o.grid)!=null&&g.el)){a.style.transform=`scale(${1/this.dragTransform.xScale},${1/this.dragTransform.yScale})`;const p=a.getBoundingClientRect();a.style.left=p.x+(this.dragTransform.xScale-1)*(i.clientX-p.x)/this.dragTransform.xScale+"px",a.style.top=p.y+(this.dragTransform.yScale-1)*(i.clientY-p.y)/this.dragTransform.yScale+"px",a.style.transformOrigin="0px 0px"}let{top:m,left:u}=a.getBoundingClientRect();const l=this.el.getBoundingClientRect();u-=l.left,m-=l.top;const h={position:{top:m*this.dragTransform.xScale,left:u*this.dragTransform.yScale}};if(o._temporaryRemoved){if(o.x=Math.max(0,Math.round(u/t)),o.y=Math.max(0,Math.round(m/e)),delete o.autoPosition,this.engine.nodeBoundFix(o),!this.engine.willItFit(o)){if(o.autoPosition=!0,!this.engine.willItFit(o)){M.off(r,"drag");return}o._willFitPos&&(c.copyPos(o,o._willFitPos),delete o._willFitPos)}this._onStartMoving(a,i,h,o,t,e)}else this._dragOrResize(a,i,h,o,t,e)};return M.droppable(this.el,{accept:i=>{const r=i.gridstackNode||this._readAttr(i,!1);if((r==null?void 0:r.grid)===this)return!0;if(!this.opts.acceptWidgets)return!1;let a=!0;if(typeof this.opts.acceptWidgets=="function")a=this.opts.acceptWidgets(i);else{const o=this.opts.acceptWidgets===!0?".grid-stack-item":this.opts.acceptWidgets;a=i.matches(o)}if(a&&r&&this.opts.maxRow){const o={w:r.w,h:r.h,minW:r.minW,minH:r.minH};a=this.engine.willItFit(o)}return a}}).on(this.el,"dropover",(i,r,a)=>{let o=(a==null?void 0:a.gridstackNode)||r.gridstackNode;if((o==null?void 0:o.grid)===this&&!o._temporaryRemoved)return!1;if(o!=null&&o._sidebarOrig&&(o.w=o._sidebarOrig.w,o.h=o._sidebarOrig.h),o!=null&&o.grid&&o.grid!==this&&!o._temporaryRemoved&&o.grid._leave(r,a),a=a||r,t=this.cellWidth(),e=this.getCellHeight(!0),!o){const l=a.getAttribute("data-gs-widget")||a.getAttribute("gridstacknode");if(l){try{o=JSON.parse(l)}catch{console.error("Gridstack dropover: Bad JSON format: ",l)}a.removeAttribute("data-gs-widget"),a.removeAttribute("gridstacknode")}o||(o=this._readAttr(a)),o._sidebarOrig={w:o.w,h:o.h}}o.grid||(o.el||(o={...o}),o._isExternal=!0,a.gridstackNode=o);const m=o.w||Math.round(a.offsetWidth/t)||1,u=o.h||Math.round(a.offsetHeight/e)||1;return o.grid&&o.grid!==this?(r._gridstackNodeOrig||(r._gridstackNodeOrig=o),r.gridstackNode=o={...o,w:m,h:u,grid:this},delete o.x,delete o.y,this.engine.cleanupNode(o).nodeBoundFix(o),o._initDD=o._isExternal=o._temporaryRemoved=!0):(o.w=m,o.h=u,o._temporaryRemoved=!0),y._itemRemoving(o.el,!1),M.on(r,"drag",s),s(i,r,a),!1}).on(this.el,"dropout",(i,r,a)=>{const o=(a==null?void 0:a.gridstackNode)||r.gridstackNode;return o&&(!o.grid||o.grid===this)&&(this._leave(r,a),this._isTemp&&this.removeAsSubGrid(o)),!1}).on(this.el,"drop",(i,r,a)=>{var g,p,v;const o=(a==null?void 0:a.gridstackNode)||r.gridstackNode;if((o==null?void 0:o.grid)===this&&!o._isExternal)return!1;const m=!!this.placeholder.parentElement,u=r!==a;this.placeholder.remove(),delete this.placeholder.gridstackNode,m&&this.opts.animate&&(this.setAnimation(!1),this.setAnimation(!0,!0));const l=r._gridstackNodeOrig;if(delete r._gridstackNodeOrig,m&&(l!=null&&l.grid)&&l.grid!==this){const f=l.grid;f.engine.removeNodeFromLayoutCache(l),f.engine.removedNodes.push(l),f._triggerRemoveEvent()._triggerChangeEvent(),f.parentGridNode&&!f.engine.nodes.length&&f.opts.subGridDynamic&&f.removeAsSubGrid()}if(!o||(m&&(this.engine.cleanupNode(o),o.grid=this),(g=o.grid)==null||delete g._isTemp,M.off(r,"drag"),a!==r?(a.remove(),r=a):r.remove(),this._removeDD(r),!m))return!1;const h=(v=(p=o.subGrid)==null?void 0:p.el)==null?void 0:v.gridstack;return c.copyPos(o,this._readAttr(this.placeholder)),c.removePositioningStyles(r),u&&(o.content||o.subGridOpts||y.addRemoveCB)?(delete o.el,r=this.addWidget(o)):(this._prepareElement(r,!0,o),this.el.appendChild(r),this.resizeToContentCheck(!1,o),h&&(h.parentGridNode=o),this._updateContainerHeight()),this.engine.addedNodes.push(o),this._triggerAddEvent(),this._triggerChangeEvent(),this.engine.endUpdate(),this._gsEventHandler.dropped&&this._gsEventHandler.dropped({...i,type:"dropped"},l&&l.grid?l:void 0,o),!1}),this}static _itemRemoving(e,t){if(!e)return;const s=e?e.gridstackNode:void 0;!(s!=null&&s.grid)||e.classList.contains(s.grid.opts.removableOptions.decline)||(t?s._isAboutToRemove=!0:delete s._isAboutToRemove,t?e.classList.add("grid-stack-item-removing"):e.classList.remove("grid-stack-item-removing"))}_setupRemoveDrop(){if(typeof this.opts.removable!="string")return this;const e=document.querySelector(this.opts.removable);return e?(!this.opts.staticGrid&&!M.isDroppable(e)&&M.droppable(e,this.opts.removableOptions).on(e,"dropover",(t,s)=>y._itemRemoving(s,!0)).on(e,"dropout",(t,s)=>y._itemRemoving(s,!1)),this):this}prepareDragDrop(e,t=!1){const s=e==null?void 0:e.gridstackNode;if(!s)return;const i=s.noMove||this.opts.disableDrag,r=s.noResize||this.opts.disableResize,a=this.opts.staticGrid||i&&r;if((t||a)&&(s._initDD&&(this._removeDD(e),delete s._initDD),a&&e.classList.add("ui-draggable-disabled","ui-resizable-disabled"),!t))return this;if(!s._initDD){let o,m;const u=(g,p)=>{this.triggerEvent(g,g.target),o=this.cellWidth(),m=this.getCellHeight(!0),this._onStartMoving(e,g,p,s,o,m)},l=(g,p)=>{this._dragOrResize(e,g,p,s,o,m)},h=g=>{this.placeholder.remove(),delete this.placeholder.gridstackNode,delete s._moving,delete s._resizing,delete s._event,delete s._lastTried;const p=s.w!==s._orig.w,v=g.target;if(!(!v.gridstackNode||v.gridstackNode.grid!==this)){if(s.el=v,s._isAboutToRemove){const f=e.gridstackNode.grid;f._gsEventHandler[g.type]&&f._gsEventHandler[g.type](g,v),f.engine.nodes.push(s),f.removeWidget(e,!0,!0)}else c.removePositioningStyles(v),s._temporaryRemoved?(this._writePosAttr(v,s),this.engine.addNode(s)):this._writePosAttr(v,s),this.triggerEvent(g,v);this._extraDragRow=0,this._updateContainerHeight(),this._triggerChangeEvent(),this.engine.endUpdate(),g.type==="resizestop"&&(Number.isInteger(s.sizeToContent)&&(s.sizeToContent=s.h),this.resizeToContentCheck(p,s))}};M.draggable(e,{start:u,stop:h,drag:l}).resizable(e,{start:u,stop:h,resize:l}),s._initDD=!0}return M.draggable(e,i?"disable":"enable").resizable(e,r?"disable":"enable"),this}_onStartMoving(e,t,s,i,r,a){var o;if(this.engine.cleanNodes().beginUpdate(i),this._writePosAttr(this.placeholder,i),this.el.appendChild(this.placeholder),this.placeholder.gridstackNode=i,(o=i.grid)!=null&&o.el)this.dragTransform=c.getValuesFromTransformedElement(e);else if(this.placeholder&&this.placeholder.closest(".grid-stack")){const m=this.placeholder.closest(".grid-stack");this.dragTransform=c.getValuesFromTransformedElement(m)}else this.dragTransform={xScale:1,xOffset:0,yScale:1,yOffset:0};if(i.el=this.placeholder,i._lastUiPosition=s.position,i._prevYPix=s.position.top,i._moving=t.type==="dragstart",i._resizing=t.type==="resizestart",delete i._lastTried,t.type==="dropover"&&i._temporaryRemoved&&(this.engine.addNode(i),i._moving=!0),this.engine.cacheRects(r,a,this.opts.marginTop,this.opts.marginRight,this.opts.marginBottom,this.opts.marginLeft),t.type==="resizestart"){const m=this.getColumn()-i.x,u=(this.opts.maxRow||Number.MAX_SAFE_INTEGER)-i.y;M.resizable(e,"option","minWidth",r*Math.min(i.minW||1,m)).resizable(e,"option","minHeight",a*Math.min(i.minH||1,u)).resizable(e,"option","maxWidth",r*Math.min(i.maxW||Number.MAX_SAFE_INTEGER,m)).resizable(e,"option","maxWidthMoveLeft",r*Math.min(i.maxW||Number.MAX_SAFE_INTEGER,i.x+i.w)).resizable(e,"option","maxHeight",a*Math.min(i.maxH||Number.MAX_SAFE_INTEGER,u)).resizable(e,"option","maxHeightMoveUp",a*Math.min(i.maxH||Number.MAX_SAFE_INTEGER,i.y+i.h))}}_dragOrResize(e,t,s,i,r,a){const o={...i._orig};let m,u=this.opts.marginLeft,l=this.opts.marginRight,h=this.opts.marginTop,g=this.opts.marginBottom;const p=Math.round(a*.1),v=Math.round(r*.1);if(u=Math.min(u,v),l=Math.min(l,v),h=Math.min(h,p),g=Math.min(g,p),t.type==="drag"){if(i._temporaryRemoved)return;const C=s.position.top-i._prevYPix;i._prevYPix=s.position.top,this.opts.draggable.scroll!==!1&&c.updateScrollPosition(e,s.position,C);const k=s.position.left+(s.position.left>i._lastUiPosition.left?-l:u),j=s.position.top+(s.position.top>i._lastUiPosition.top?-g:h);o.x=Math.round(k/r),o.y=Math.round(j/a);const _=this._extraDragRow;if(this.engine.collide(i,o)){const x=this.getRow();let N=Math.max(0,o.y+i.h-x);this.opts.maxRow&&x+N>this.opts.maxRow&&(N=Math.max(0,this.opts.maxRow-x)),this._extraDragRow=N}else this._extraDragRow=0;if(this._extraDragRow!==_&&this._updateContainerHeight(),i.x===o.x&&i.y===o.y)return}else if(t.type==="resize"){if(o.x<0||(c.updateScrollResize(t,e,a),o.w=Math.round((s.size.width-u)/r),o.h=Math.round((s.size.height-h)/a),i.w===o.w&&i.h===o.h)||i._lastTried&&i._lastTried.w===o.w&&i._lastTried.h===o.h)return;const C=s.position.left+u,k=s.position.top+h;o.x=Math.round(C/r),o.y=Math.round(k/a),m=!0}i._event=t,i._lastTried=o;const f={x:s.position.left+u,y:s.position.top+h,w:(s.size?s.size.width:i.w*r)-u-l,h:(s.size?s.size.height:i.h*a)-h-g};if(this.engine.moveNodeCheck(i,{...o,cellWidth:r,cellHeight:a,rect:f,resizing:m})){i._lastUiPosition=s.position,this.engine.cacheRects(r,a,h,l,g,u),delete i._skipDown,m&&i.subGrid&&i.subGrid.onResize(),this._extraDragRow=0,this._updateContainerHeight();const C=t.target;i._sidebarOrig||this._writePosAttr(C,i),this.triggerEvent(t,C)}}triggerEvent(e,t){let s=this;for(;s.parentGridNode;)s=s.parentGridNode.grid;s._gsEventHandler[e.type]&&s._gsEventHandler[e.type](e,t)}_leave(e,t){t=t||e;const s=t.gridstackNode;if(!s||(t.style.transform=t.style.transformOrigin=null,M.off(e,"drag"),s._temporaryRemoved))return;s._temporaryRemoved=!0,this.engine.removeNode(s),s.el=s._isExternal&&t?t:e;const i=s._sidebarOrig;s._isExternal&&this.engine.cleanupNode(s),s._sidebarOrig=i,this.opts.removable===!0&&y._itemRemoving(e,!0),e._gridstackNodeOrig?(e.gridstackNode=e._gridstackNodeOrig,delete e._gridstackNodeOrig):s._isExternal&&this.engine.restoreInitial()}}y.renderCB=(d,e)=>{d&&(e!=null&&e.content)&&(d.textContent=e.content)};y.resizeToContentParent=".grid-stack-item-content";y.Utils=c;y.Engine=q;y.GDRev="12.4.2";function ft({statusCounts:d}){const{t:e}=H(),t=F();return n.jsxs(xe,{className:"justify-start",children:[n.jsx("div",{onClick:()=>t("/jobs?status=not_started"),className:"cursor-pointer hover:scale-105 transition-transform",children:n.jsx(W,{heading:e("jobs.notStarted"),value:d.not_started,iconSrc:"/icon-not-started.gif"})}),n.jsx("div",{onClick:()=>t("/jobs?status=in_progress"),className:"cursor-pointer hover:scale-105 transition-transform",children:n.jsx(W,{heading:e("jobs.inProgress"),value:d.in_progress,iconSrc:"/icon-in-progress.gif"})}),n.jsx("div",{onClick:()=>t("/jobs?status=waiting_for_parts"),className:"cursor-pointer hover:scale-105 transition-transform",children:n.jsx(W,{heading:e("jobs.waitingParts"),value:d.waiting_for_parts,iconSrc:"/icon-waiting-parts.gif"})}),n.jsx("div",{onClick:()=>t("/jobs?status=completed"),className:"cursor-pointer hover:scale-105 transition-transform",children:n.jsx(W,{heading:e("jobs.completed"),value:d.completed,iconSrc:"/icon-completed.gif"})})]})}function pt({job:d,userLanguage:e,mechanics:t,onAssignMechanic:s}){const i=F(),[r,a]=w.useState(null),{t:o}=H();w.useEffect(()=>{d.vehicleId&&!d.vehicleLicensePlate&&je(d.vehicleId).then(a)},[d.vehicleId,d.vehicleLicensePlate]);const m=d.vehicleLicensePlate||(r==null?void 0:r.licensePlate),u=d.vehicleBrand||(r==null?void 0:r.brand),l=d.vehicleModel||(r==null?void 0:r.model),g={not_started:{class:"status-not-started",label:o("jobs.notStarted")},in_progress:{class:"status-in-progress",label:o("jobs.inProgress")},waiting_for_parts:{class:"status-waiting",label:o("jobs.waitingParts")},completed:{class:"status-completed",label:o("jobs.completed")},ready_for_pickup:{class:"status-completed",label:o("jobs.completed")}}[d.status]||{class:"",label:d.status};return n.jsx(I,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>i(`/jobs/${d.id}`),children:n.jsxs(B,{className:"p-4",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Re,{brand:u||"",size:"sm",className:"text-primary shrink-0"}),m?n.jsx(be,{plateNumber:m,size:"xs"}):n.jsx("span",{className:"text-xs text-muted-foreground",children:o("jobs.noVehicle")})]}),(u||l)&&n.jsxs("p",{className:"text-xs text-muted-foreground mt-1 truncate",children:[u," ",l]})]}),n.jsxs("div",{className:"flex flex-col items-end gap-1.5 shrink-0",children:[n.jsx("span",{className:`badge-premium ${g.class} text-xs px-2 py-0.5 whitespace-nowrap`,children:g.label}),t&&s&&n.jsx(Me,{assignedMechanicId:d.assignedMechanicId,mechanics:t,onAssign:p=>s(d.id,p)})]})]}),n.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1",children:ye(d,e)})]})})}function xt({jobs:d,mechanics:e,onAssignMechanic:t}){const{t:s,language:i}=H(),r=F();return n.jsxs(I,{className:"card-glass h-full flex flex-col",children:[n.jsxs($,{className:"pb-2 p-4 flex flex-row items-center justify-between flex-shrink-0",children:[n.jsxs(J,{className:"text-xl font-bold flex items-center gap-3",children:[n.jsx(De,{className:"h-7 w-7 text-blue-500"}),s("dashboard.recentJobs")]}),n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>r("/jobs"),className:"hover:bg-primary/10 hover:text-primary",children:s("common.viewAll")})]}),n.jsxs(B,{className:"p-4 pt-0 flex-1 overflow-auto",children:[n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:d.slice(0,6).map((a,o)=>n.jsx("div",{className:"animate-slide-up",style:{animationDelay:`${o*50}ms`},children:n.jsx(pt,{job:a,userLanguage:i,mechanics:e,onAssignMechanic:t})},a.id))}),d.length===0&&n.jsxs("div",{className:"text-center py-8",children:[n.jsx(Y,{className:"h-12 w-12 text-muted-foreground/30 mx-auto mb-4"}),n.jsx("p",{className:"text-muted-foreground text-sm",children:s("jobs.noRecentJobs")})]})]})]})}function yt({jobs:d}){const{t:e,language:t}=H(),s=F();return n.jsxs(I,{className:"card-glass border-l-4 border-l-gold shadow-glow-gold/20 h-full flex flex-col",children:[n.jsx($,{className:"pb-2 p-4 flex-shrink-0",children:n.jsxs(J,{className:"text-base font-bold flex items-center gap-2",children:[n.jsx(tt,{className:"h-7 w-7 text-amber-500"}),e("dashboard.urgentJobs")]})}),n.jsxs(B,{className:"space-y-3 flex-1 overflow-auto p-4 pt-0",children:[d.slice(0,4).map((i,r)=>n.jsxs("div",{className:"p-4 rounded-xl glass-light cursor-pointer hover-lift group animate-slide-up",style:{animationDelay:`${r*100}ms`},onClick:()=>s(`/jobs/${i.id}`),children:[n.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[n.jsx(ie,{className:"h-4 w-4 text-gold flex-shrink-0 mt-0.5 animate-pulse"}),n.jsx("p",{className:"font-semibold text-sm",children:i.customerName})]}),n.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 pl-6",children:ye(i,t)})]},i.id)),d.length===0&&n.jsxs("div",{className:"text-center py-8",children:[n.jsx(Ce,{className:"h-12 w-12 text-muted-foreground/30 mx-auto mb-4"}),n.jsx("p",{className:"text-muted-foreground text-sm",children:e("dashboard.noUrgentJobs")})]})]})]})}function bt({jobs:d,mechanics:e}){const{t}=H(),s=d.filter(r=>{const a=new Date(r.createdAt),o=new Date;return a.toDateString()===o.toDateString()}),i=d.filter(r=>r.status==="completed"&&r.completedAt&&new Date(r.completedAt).toDateString()===new Date().toDateString()).length;return n.jsxs(I,{className:"card-glass h-full flex flex-col",children:[n.jsx($,{className:"pb-2 p-4 flex-shrink-0",children:n.jsxs(J,{className:"text-base font-bold flex items-center gap-2",children:[n.jsx(ht,{className:"h-7 w-7 text-violet-500"}),t("dashboard.todayActivity")]})}),n.jsxs(B,{className:"space-y-4 flex-1 p-4 pt-0",children:[n.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-primary/5",children:[n.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:t("dashboard.jobsCreated")}),n.jsx("span",{className:"text-2xl font-bold text-primary",children:s.length})]}),n.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-success/5",children:[n.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:t("dashboard.completed")}),n.jsx("span",{className:"text-2xl font-bold text-success",children:i})]}),n.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-gold/5",children:[n.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:t("dashboard.activeMechanics")}),n.jsx("span",{className:"text-2xl font-bold text-gold-foreground",children:e.length})]})]})]})}function vt(){const{t:d}=H(),e=F();return n.jsxs(I,{className:"card-glass h-full flex flex-col",children:[n.jsx($,{className:"pb-2 p-4 flex-shrink-0",children:n.jsxs(J,{className:"text-base font-bold flex items-center gap-2",children:[n.jsx(st,{className:"h-7 w-7 text-emerald-500"}),d("dashboard.quickActions")]})}),n.jsxs(B,{className:"space-y-3 flex-1 p-4 pt-0",children:[n.jsxs(O,{variant:"outline",className:"w-full justify-start gap-3 h-12 hover:bg-primary/10 hover:border-primary hover:text-primary transition-all",onClick:()=>e("/jobs/new"),children:[n.jsx(Ge,{className:"h-5 w-5"}),n.jsx("span",{className:"font-medium",children:d("jobs.newJob")})]}),n.jsxs(O,{variant:"outline",className:"w-full justify-start gap-3 h-12 hover:bg-primary/10 hover:border-primary hover:text-primary transition-all",onClick:()=>e("/messages"),children:[n.jsx(ze,{className:"h-5 w-5"}),n.jsx("span",{className:"font-medium",children:d("nav.messages")})]}),n.jsxs(O,{variant:"outline",className:"w-full justify-start gap-3 h-12 hover:bg-primary/10 hover:border-primary hover:text-primary transition-all",onClick:()=>e("/jobs"),children:[n.jsx(Y,{className:"h-5 w-5"}),n.jsx("span",{className:"font-medium",children:d("jobs.allJobs")})]})]})]})}function wt({jobs:d,mechanics:e}){const{t}=H(),s=d.filter(r=>r.status!=="completed"),i=e.map(r=>({name:r.fullName,email:r.email,active:s.filter(a=>a.assignedMechanicId===r.id).length,completed:d.filter(a=>a.assignedMechanicId===r.id&&a.status==="completed").length})).sort((r,a)=>a.active-r.active);return n.jsxs(I,{className:"card-glass h-full flex flex-col",children:[n.jsx($,{className:"pb-2 p-4 flex-shrink-0",children:n.jsxs(J,{className:"text-base font-bold flex items-center gap-2",children:[n.jsx(it,{className:"h-7 w-7 text-orange-500"}),t("dashboard.mechanicsWorkload")]})}),n.jsx(B,{className:"flex-1 overflow-auto space-y-2 p-4 pt-0",children:i.length>0?i.map((r,a)=>n.jsxs("div",{className:"flex items-center justify-between p-2.5 rounded-xl bg-muted/30",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsxs(Fe,{className:"h-7 w-7 shrink-0",children:[se(r.email)&&n.jsx($e,{src:se(r.email),alt:r.name}),n.jsx(Je,{className:"text-xs bg-primary/10 text-primary",children:r.name.charAt(0)})]}),n.jsx("span",{className:"text-sm font-medium truncate",children:r.name})]}),n.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[n.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full bg-primary/10 text-primary font-semibold",children:[r.active," ",t("dashboard.active")]}),n.jsxs("span",{className:"text-xs text-muted-foreground",children:[r.completed," ",t("dashboard.done")]})]})]},a)):n.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:t("common.noData")})})]})}function _t({jobs:d}){const{t:e}=H(),t=F(),s=d.filter(i=>i.status==="waiting_for_parts").sort((i,r)=>new Date(i.updatedAt||i.createdAt).getTime()-new Date(r.updatedAt||r.createdAt).getTime());return n.jsxs(I,{className:"card-glass h-full flex flex-col",children:[n.jsx($,{className:"pb-2 p-4 flex-shrink-0",children:n.jsxs(J,{className:"text-base font-bold flex items-center gap-2",children:[n.jsx(rt,{className:"h-7 w-7 text-rose-500"}),e("dashboard.partsWaiting"),s.length>0&&n.jsx("span",{className:"ml-auto text-sm font-semibold text-amber-600 bg-amber-100 dark:bg-amber-900/30 px-2 py-0.5 rounded-full",children:s.length})]})}),n.jsx(B,{className:"p-4 pt-0 flex-1 overflow-auto space-y-2",children:s.length>0?s.slice(0,6).map(i=>n.jsxs("div",{onClick:()=>t(`/jobs/${i.id}`),className:"flex items-center justify-between p-2.5 rounded-xl bg-muted/30 cursor-pointer hover:bg-muted/50 transition-colors",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[i.vehicleLicensePlate?n.jsx(be,{plateNumber:i.vehicleLicensePlate,size:"xs"}):n.jsxs("span",{className:"text-xs text-muted-foreground",children:["#",i.jobNumber]}),n.jsx("span",{className:"text-sm truncate text-muted-foreground",children:i.customerName})]}),n.jsxs("span",{className:"text-xs text-muted-foreground shrink-0",children:[Math.floor((Date.now()-new Date(i.updatedAt||i.createdAt).getTime())/(1e3*60*60*24)),e("dashboard.daysShort")]})]},i.id)):n.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:e("dashboard.noPartsWaiting")})})]})}function Nt({jobs:d}){const{t:e}=H(),t=new Date,s=new Date(t.getTime()-7*24*60*60*1e3),i=new Date(t.getTime()-14*24*60*60*1e3),r=d.filter(h=>new Date(h.createdAt)>=s).length,a=d.filter(h=>{const g=new Date(h.createdAt);return g>=i&&g<s}).length,o=d.filter(h=>h.status==="completed"&&h.completedAt&&new Date(h.completedAt)>=s).length,m=d.filter(h=>h.status==="completed"&&h.completedAt&&new Date(h.completedAt)>=i&&new Date(h.completedAt)<s).length,u=(h,g)=>{if(g===0)return h>0?"+100%":"0%";const p=Math.round((h-g)/g*100);return p>=0?`+${p}%`:`${p}%`},l=(h,g,p)=>h===g?"text-muted-foreground":h>g===p?"text-green-600":"text-red-500";return n.jsxs(I,{className:"card-glass h-full flex flex-col",children:[n.jsx($,{className:"pb-2 p-4 flex-shrink-0",children:n.jsxs(J,{className:"text-base font-bold flex items-center gap-2",children:[n.jsx(qe,{className:"h-7 w-7 text-teal-500"}),e("dashboard.weeklyPerformance")]})}),n.jsxs(B,{className:"p-4 pt-0 flex-1 space-y-3",children:[n.jsxs("div",{className:"p-3 rounded-xl bg-primary/5",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("span",{className:"text-sm text-muted-foreground",children:e("dashboard.jobsCreated")}),n.jsxs("span",{className:`text-xs font-semibold ${l(r,a,!0)}`,children:[u(r,a)," ",e("dashboard.vsLastWeek")]})]}),n.jsx("span",{className:"text-2xl font-bold",children:r})]}),n.jsxs("div",{className:"p-3 rounded-xl bg-success/5",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("span",{className:"text-sm text-muted-foreground",children:e("dashboard.jobsCompleted")}),n.jsxs("span",{className:`text-xs font-semibold ${l(o,m,!0)}`,children:[u(o,m)," ",e("dashboard.vsLastWeek")]})]}),n.jsx("span",{className:"text-2xl font-bold",children:o})]}),n.jsxs("div",{className:"p-3 rounded-xl bg-muted/30",children:[n.jsx("div",{className:"flex items-center justify-between mb-1",children:n.jsx("span",{className:"text-sm text-muted-foreground",children:e("dashboard.activeJobs")})}),n.jsx("span",{className:"text-2xl font-bold",children:d.filter(h=>h.status==="in_progress").length})]})]})]})}function Et({jobs:d}){const{t:e}=H();F();const t=new Map;d.forEach(r=>{if(!r.customerName)return;const a=r.customerId||r.customerName,o=t.get(a);o?(o.total++,r.status!=="completed"&&o.active++):t.set(a,{name:r.customerName,total:1,active:r.status!=="completed"?1:0})});const s=Array.from(t.values()).sort((r,a)=>a.active-r.active||a.total-r.total).slice(0,8),i=t.size;return n.jsxs(I,{className:"card-glass h-full flex flex-col",children:[n.jsx($,{className:"pb-2 p-4 flex-shrink-0",children:n.jsxs(J,{className:"text-base font-bold flex items-center gap-2",children:[n.jsx(ct,{className:"h-7 w-7 text-indigo-500"}),e("dashboard.customerOverview"),n.jsx("span",{className:"ml-auto text-sm font-semibold text-violet-600 bg-violet-100 dark:bg-violet-900/30 px-2 py-0.5 rounded-full",children:i})]})}),n.jsxs(B,{className:"p-4 pt-0 flex-1 overflow-auto space-y-2",children:[s.map((r,a)=>n.jsxs("div",{className:"flex items-center justify-between p-2.5 rounded-xl bg-muted/30",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsx("div",{className:"w-7 h-7 rounded-full bg-violet-100 dark:bg-violet-900/30 flex items-center justify-center text-xs font-bold text-violet-600 shrink-0",children:r.name.charAt(0)}),n.jsx("span",{className:"text-sm font-medium truncate",children:r.name})]}),n.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[r.active>0&&n.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full bg-primary/10 text-primary font-semibold",children:[r.active," ",e("dashboard.active")]}),n.jsxs("span",{className:"text-xs text-muted-foreground",children:[r.total," ",e("dashboard.total")]})]})]},a)),s.length===0&&n.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:e("common.noData")})]})]})}const fe=[{id:"job-stats",labelKey:"dashboard.widgetJobStats",defaultW:12,defaultH:2},{id:"recent-jobs",labelKey:"dashboard.widgetRecentJobs",defaultW:8,defaultH:6},{id:"urgent-jobs",labelKey:"dashboard.widgetUrgentJobs",defaultW:4,defaultH:3},{id:"today-activity",labelKey:"dashboard.widgetTodayActivity",defaultW:4,defaultH:3},{id:"quick-actions",labelKey:"dashboard.widgetQuickActions",defaultW:4,defaultH:3},{id:"mechanics-workload",labelKey:"dashboard.widgetMechanicsWorkload",defaultW:6,defaultH:4},{id:"parts-waiting",labelKey:"dashboard.widgetPartsWaiting",defaultW:6,defaultH:4},{id:"weekly-performance",labelKey:"dashboard.widgetWeeklyPerformance",defaultW:4,defaultH:4},{id:"customer-overview",labelKey:"dashboard.widgetCustomerOverview",defaultW:6,defaultH:4}],X=[{id:"job-stats",x:0,y:0,w:12,h:2},{id:"recent-jobs",x:0,y:2,w:8,h:6},{id:"urgent-jobs",x:8,y:2,w:4,h:3},{id:"today-activity",x:8,y:5,w:4,h:3},{id:"quick-actions",x:8,y:8,w:4,h:3}],Ae=w.forwardRef(({jobs:d,mechanics:e,statusCounts:t,urgentJobs:s,recentJobs:i,onAssignMechanic:r,onLockChange:a,onSave:o,onReset:m,externalIsLocked:u,showControls:l=!0},h)=>{const{user:g}=ce(),{t:p}=H(),v=w.useRef(null),f=w.useRef(null),[C,k]=w.useState(!0),[j,_]=w.useState(!0),[x,N]=w.useState(X),[R,D]=w.useState(0),U=u!==void 0?u:C;w.useEffect(()=>{(async()=>{if(g)try{const L=await ee(g.id),P=(L==null?void 0:L.dashboardLayout)||X;N(P),_(!1)}catch(L){console.error("Error loading dashboard layout:",L),N(X),_(!1)}})()},[g]),w.useEffect(()=>{if(j||!v.current||f.current)return;const E=setTimeout(()=>{if(!v.current||f.current)return;const L=y.init({column:12,cellHeight:80,margin:12,float:!1,disableResize:!1,disableDrag:U,animate:!0,columnOpts:{breakpoints:[{w:640,c:1},{w:900,c:6},{w:1200,c:12}]},draggable:{handle:".grid-stack-item-content"}},v.current);f.current=L,L.on("change",()=>{U||me()})},50);return()=>{clearTimeout(E),f.current&&(f.current.destroy(!1),f.current=null)}},[j,R]),w.useEffect(()=>{if(!f.current||j)return;const E=f.current;x.forEach(L=>{const P=document.querySelector(`[gs-id="${L.id}"]`);P&&E.update(P,{x:L.x,y:L.y,w:L.w,h:L.h})})},[x,j]),w.useEffect(()=>{f.current&&(U?f.current.disable():f.current.enable())},[U]);const me=async()=>{if(!g||!f.current){console.log("Cannot save: user or grid not ready");return}try{const P=f.current.getGridItems().map(V=>{const z=V.gridstackNode;return{id:z==null?void 0:z.id,x:(z==null?void 0:z.x)||0,y:(z==null?void 0:z.y)||0,w:(z==null?void 0:z.w)||4,h:(z==null?void 0:z.h)||4}});console.log("Saving layout:",P);const S=await ee(g.id);await ge(g.id,{...S,dashboardLayout:P,updatedAt:new Date().toISOString()}),console.log("Layout saved successfully"),te.success(p("dashboard.layoutSaved"))}catch(E){console.error("Error saving layout:",E),te.error(p("dashboard.layoutSaveFailed"))}},_e=async()=>{if(m){m();return}if(g)try{N(X);const E=await ee(g.id);await ge(g.id,{...E,dashboardLayout:X,updatedAt:new Date().toISOString()}),te.success(p("dashboard.layoutReset"))}catch(E){console.error("Error resetting layout:",E),te.error(p("dashboard.layoutResetFailed"))}},Te=E=>{const L=x.find(S=>S.id===E);let P;if(L)P=x.filter(S=>S.id!==E);else{const S=fe.find(z=>z.id===E);if(!S)return;const V=X.find(z=>z.id===E);P=[...x,{id:E,x:(V==null?void 0:V.x)??0,y:(V==null?void 0:V.y)??0,w:S.defaultW,h:S.defaultH}]}f.current&&(f.current.destroy(!1),f.current=null),N(P),D(S=>S+1),g&&ee(g.id).then(S=>{ge(g.id,{...S,dashboardLayout:P,updatedAt:new Date().toISOString()})})},Pe=()=>x.map(E=>E.id);w.useImperativeHandle(h,()=>({saveLayout:me,resetLayout:_e,toggleWidget:Te,getVisibleWidgetIds:Pe}));const Oe=()=>{const E=!U;a?a(E):k(E)},We=()=>{o?o():me()},Ie=E=>{switch(E){case"job-stats":return n.jsx(ft,{statusCounts:t});case"recent-jobs":return n.jsx(xt,{jobs:i,mechanics:e,onAssignMechanic:r});case"urgent-jobs":return n.jsx(yt,{jobs:s});case"today-activity":return n.jsx(bt,{jobs:d,mechanics:e});case"quick-actions":return n.jsx(vt,{});case"mechanics-workload":return n.jsx(wt,{jobs:d,mechanics:e});case"parts-waiting":return n.jsx(_t,{jobs:d});case"weekly-performance":return n.jsx(Nt,{jobs:d});case"customer-overview":return n.jsx(Et,{jobs:d});default:return null}};return j?n.jsx("div",{className:"flex items-center justify-center h-64",children:n.jsx("p",{className:"text-muted-foreground",children:p("common.loading")})}):n.jsxs("div",{className:l?"space-y-4":"",children:[l&&n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(O,{variant:U?"outline":"default",size:"sm",onClick:Oe,className:"gap-2",children:U?n.jsxs(n.Fragment,{children:[n.jsx(ke,{className:"h-4 w-4"}),p("dashboard.unlockLayout")]}):n.jsxs(n.Fragment,{children:[n.jsx(Le,{className:"h-4 w-4"}),p("dashboard.lockLayout")]})}),!U&&n.jsx(O,{variant:"outline",size:"sm",onClick:We,className:"gap-2",children:p("common.save")}),n.jsxs(O,{variant:"outline",size:"sm",onClick:_e,className:"gap-2",children:[n.jsx(He,{className:"h-4 w-4"}),p("dashboard.resetLayout")]}),!U&&n.jsx("p",{className:"text-sm text-muted-foreground",children:p("dashboard.dragToReorder")})]}),n.jsx("div",{ref:v,className:"grid-stack",children:x.map(E=>n.jsx("div",{className:"grid-stack-item","gs-id":E.id,"gs-x":E.x,"gs-y":E.y,"gs-w":E.w,"gs-h":E.h,children:n.jsx("div",{className:"grid-stack-item-content overflow-hidden rounded-lg",children:Ie(E.id)})},E.id))},R)]})});Ae.displayName="CustomizableDashboard";function Ct(){const[d,e]=w.useState(!0);return{isLocked:d,setIsLocked:e}}function de(d){const e={not_started:0,in_progress:1,waiting_for_parts:2,completed:3},t={urgent:0,normal:1,low:2};return[...d].sort((s,i)=>{const r=e[s.status]-e[i.status];if(r!==0)return r;const a=t[s.priority]-t[i.priority];return a!==0?a:new Date(i.createdAt).getTime()-new Date(s.createdAt).getTime()})}function jt({status:d}){const{t:e}=H(),t={not_started:{class:"status-not-started",label:e("jobs.notStarted")},in_progress:{class:"status-in-progress",label:e("jobs.inProgress")},waiting_for_parts:{class:"status-waiting",label:e("jobs.waitingParts")},completed:{class:"status-completed",label:e("jobs.completed")}},{class:s,label:i}=t[d];return n.jsx("span",{className:`badge-premium ${s}`,children:i})}function pe({job:d,compact:e=!1,userLanguage:t,userRole:s,mechanics:i,onAssign:r}){const a=F(),[o,m]=w.useState(null);w.useEffect(()=>{d.vehicleId&&!d.vehicleLicensePlate&&je(d.vehicleId).then(m)},[d.vehicleId,d.vehicleLicensePlate]);const u=d.vehicleLicensePlate||(o==null?void 0:o.licensePlate),l=d.vehicleBrand||(o==null?void 0:o.brand),h=d.vehicleModel||(o==null?void 0:o.model),g=d.vehicleYear||(o==null?void 0:o.year),{t:p}=H(),v=()=>{const k=Date.now()-new Date(d.createdAt).getTime(),j=Math.floor(k/(1e3*60*60));return j<1?p("time.justNow"):j<24?p("time.hoursAgo").replace("{hours}",j.toString()):p("time.daysAgo").replace("{days}",Math.floor(j/24).toString())},f=d.priority==="urgent",C=s!=="mechanic";return n.jsx(I,{className:`card-premium card-interactive group ${f?"border-l-4 border-l-gold":""}`,onClick:()=>a(`/jobs/${d.id}`),children:n.jsxs(B,{className:e?"p-4":"p-5",children:[n.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[n.jsx("div",{className:"w-12 h-12 flex items-center justify-center shrink-0",children:n.jsx(Re,{brand:l||"",size:"lg",className:"text-primary"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[u?n.jsx(be,{plateNumber:u,size:"sm"}):n.jsx("h4",{className:"font-semibold text-base text-muted-foreground",children:p("jobs.noVehicle")}),f&&n.jsx(ie,{className:"h-4 w-4 text-primary/70"})]}),(l||h)&&n.jsxs("p",{className:"text-sm text-muted-foreground",children:[l," ",h," ",g?`(${g})`:""]}),C&&n.jsx("p",{className:"text-xs text-muted-foreground/70 mt-1",children:d.customerName})]}),n.jsxs("div",{className:"flex flex-col items-end gap-2 shrink-0",children:[n.jsx(jt,{status:d.status}),i&&r&&s!=="mechanic"&&n.jsx(Me,{assignedMechanicId:d.assignedMechanicId,mechanics:i,onAssign:k=>r(d.id,k)})]})]}),!e&&n.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 mb-3 leading-relaxed",children:ye(d,t)}),n.jsxs("div",{className:"flex items-center justify-between text-xs",children:[n.jsx("span",{className:`priority-${d.priority} font-semibold uppercase tracking-wide`,children:d.priority}),n.jsxs("span",{className:"flex items-center gap-1.5 text-muted-foreground",children:[n.jsx(Ke,{className:"h-3.5 w-3.5"}),v()]})]})]})})}function kt(){const{t:d,language:e}=H(),{user:t}=ce(),s=F(),i=Ve(),[r,a]=w.useState([]),[o,m]=w.useState([]),[u,l]=w.useState(!0),{isLocked:h,setIsLocked:g}=Ct(),p=w.useRef(null),[v,f]=w.useState(fe.map(x=>x.id));w.useEffect(()=>{(async()=>{try{const[N,R]=await Promise.all([Qe(),Ze()]);a(N),m(R)}catch(N){console.error("Error loading dashboard data:",N)}finally{l(!1),setTimeout(()=>{var R;const N=(R=p.current)==null?void 0:R.getVisibleWidgetIds();N&&f(N)},500)}})()},[]);const C=async(x,N)=>{try{await et(x,{assignedMechanicId:N,assignedAt:new Date().toISOString()},t==null?void 0:t.id),a(R=>R.map(D=>D.id===x?{...D,assignedMechanicId:N,assignedAt:new Date().toISOString()}:D))}catch(R){console.error("Error assigning mechanic:",R)}};if(u)return n.jsx("div",{className:"flex items-center justify-center h-64 animate-fade-in",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 rounded-2xl gradient-royal-radial mx-auto mb-4 flex items-center justify-center animate-pulse",children:n.jsx(Y,{className:"h-8 w-8 text-white"})}),n.jsx("p",{className:"text-muted-foreground",children:d("common.loadingDashboard")})]})});const k={not_started:r.filter(x=>x.status==="not_started").length,in_progress:r.filter(x=>x.status==="in_progress").length,waiting_for_parts:r.filter(x=>x.status==="waiting_for_parts").length,completed:r.filter(x=>x.status==="completed").length},j=de(r.filter(x=>x.priority==="urgent"&&x.status!=="completed")),_=de(r).slice(0,i?5:8);return r.filter(x=>{const N=new Date(x.createdAt),R=new Date;return N.toDateString()===R.toDateString()}),i?n.jsxs("div",{className:"space-y-6 pb-6 animate-fade-in",children:[n.jsxs("div",{className:"p-6 rounded-2xl glass-light",children:[n.jsx("h1",{className:"text-2xl font-bold mb-1 text-gradient-royal",children:d("nav.dashboard")}),n.jsx("p",{className:"text-sm text-muted-foreground",children:d("dashboard.welcomeBackShort")})]}),n.jsxs(xe,{className:"justify-start",children:[n.jsx("div",{onClick:()=>s("/jobs?status=not_started"),className:"cursor-pointer",children:n.jsx(W,{heading:d("jobs.notStarted"),value:k.not_started,iconSrc:"/icon-not-started.gif"})}),n.jsx("div",{onClick:()=>s("/jobs?status=in_progress"),className:"cursor-pointer",children:n.jsx(W,{heading:d("jobs.inProgress"),value:k.in_progress,iconSrc:"/icon-in-progress.gif"})}),n.jsx("div",{onClick:()=>s("/jobs?status=waiting_for_parts"),className:"cursor-pointer",children:n.jsx(W,{heading:d("jobs.waitingParts"),value:k.waiting_for_parts,iconSrc:"/icon-waiting-parts.gif"})}),n.jsx("div",{onClick:()=>s("/jobs?status=completed"),className:"cursor-pointer",children:n.jsx(W,{heading:d("jobs.completed"),value:k.completed,iconSrc:"/icon-completed.gif"})})]}),n.jsx("div",{className:"grid grid-cols-1 gap-3",children:n.jsxs(O,{variant:"outline",className:"h-14 text-base border-2 hover:bg-primary/10 hover:border-primary hover:text-primary",onClick:()=>s("/messages"),children:[n.jsx(ze,{className:"mr-2 h-5 w-5"}),d("dashboard.viewMessages")]})}),n.jsxs(I,{className:"card-glass",children:[n.jsx($,{className:"pb-4",children:n.jsxs(J,{className:"text-lg font-bold flex items-center gap-2",children:[n.jsx("div",{className:"w-8 h-8 rounded-lg gradient-royal flex items-center justify-center",children:n.jsx(De,{className:"h-4 w-4 text-white"})}),d("dashboard.todaySchedule")]})}),n.jsxs(B,{className:"space-y-3",children:[_.length>0?_.map((x,N)=>n.jsx("div",{className:"animate-slide-up",style:{animationDelay:`${N*50}ms`},children:n.jsx(pe,{job:x,userLanguage:e,userRole:"office_staff",mechanics:o,onAssign:C})},x.id)):n.jsxs("div",{className:"text-center py-8",children:[n.jsx(Y,{className:"h-12 w-12 text-muted-foreground/30 mx-auto mb-4"}),n.jsx("p",{className:"text-muted-foreground",children:d("common.noData")})]}),n.jsx("p",{onClick:()=>s("/jobs"),className:"text-center text-sm text-primary hover:text-primary/80 cursor-pointer pt-2 hover:underline",children:d("jobs.viewAll")})]})]})]}):n.jsxs("div",{className:"space-y-6 animate-fade-in -ml-6",children:[n.jsxs("div",{className:"relative overflow-hidden rounded-3xl p-8 glass-light border-0",children:[n.jsx("div",{className:"absolute inset-0 gradient-royal-radial opacity-5"}),n.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-primary/5 rounded-full blur-3xl"}),n.jsxs("div",{className:"relative flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl lg:text-4xl font-bold mb-2 text-gradient-royal",children:d("nav.dashboard")}),n.jsx("p",{className:"text-base lg:text-lg text-muted-foreground",children:d("dashboard.welcomeMessage")})]}),n.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[n.jsxs(O,{variant:h?"outline":"default",size:"sm",onClick:()=>g(!h),className:"gap-2 h-9",children:[h?n.jsx(ke,{className:"h-3.5 w-3.5"}):n.jsx(Le,{className:"h-3.5 w-3.5"}),n.jsx("span",{className:"hidden xl:inline text-sm",children:d(h?"dashboard.unlockLayout":"dashboard.lockLayout")})]}),!h&&n.jsxs(O,{variant:"outline",size:"sm",onClick:()=>{var x;return(x=p.current)==null?void 0:x.saveLayout()},className:"gap-2 h-9",children:[n.jsx(lt,{className:"h-3.5 w-3.5"}),n.jsx("span",{className:"hidden xl:inline text-sm",children:d("common.save")})]}),n.jsxs(nt,{children:[n.jsx(at,{asChild:!0,children:n.jsxs(O,{variant:"outline",size:"sm",className:"gap-2 h-9",children:[n.jsx(dt,{className:"h-3.5 w-3.5"}),n.jsx("span",{className:"hidden xl:inline text-sm",children:d("dashboard.widgets")})]})}),n.jsxs(ot,{align:"end",className:"w-56 p-3",children:[n.jsx("p",{className:"text-sm font-semibold mb-2",children:d("dashboard.toggleWidgets")}),n.jsx("div",{className:"space-y-2",children:fe.map(x=>{const N=v.includes(x.id);return n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-sm",children:[n.jsx("input",{type:"checkbox",checked:N,onChange:()=>{var R;(R=p.current)==null||R.toggleWidget(x.id),f(D=>N?D.filter(U=>U!==x.id):[...D,x.id])},className:"rounded border-border"}),d(x.labelKey)]},x.id)})})]})]}),n.jsxs(O,{variant:"outline",size:"sm",onClick:()=>{var x;(x=p.current)==null||x.resetLayout(),setTimeout(()=>{var R;const N=(R=p.current)==null?void 0:R.getVisibleWidgetIds();N&&f(N)},200)},className:"gap-2 h-9",children:[n.jsx(He,{className:"h-3.5 w-3.5"}),n.jsx("span",{className:"hidden xl:inline text-sm",children:d("dashboard.resetLayout")})]})]})]})]}),n.jsx(Ae,{ref:p,jobs:r,mechanics:o,statusCounts:k,urgentJobs:j,recentJobs:_,onAssignMechanic:C,externalIsLocked:h,onLockChange:g,showControls:!1})]})}function Rt(){var j;const{t:d,language:e}=H(),{user:t}=ce(),s=F(),[i,r]=w.useState([]),[a,o]=w.useState([]),[m,u]=w.useState(!0),[l,h]=w.useState(!1),[g,p]=w.useState(0);if(w.useEffect(()=>{if(!t)return;const _=Ye(x=>{const N=x.filter(D=>!D.assignedMechanicId&&D.status==="not_started"),R=x.filter(D=>D.assignedMechanicId===t.id);r(de(N)),o(de(R)),u(!1)});return()=>_()},[t]),w.useEffect(()=>{if(!t)return;const _=Xe(x=>{const N=x.filter(D=>D.senderId!==t.id&&(!D.readBy||!D.readBy.includes(t.id))),R=new Set(N.map(D=>D.jobId));p(R.size)});return()=>_()},[t]),m)return n.jsx("div",{className:"flex items-center justify-center h-64 animate-fade-in",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 rounded-2xl gradient-royal-radial mx-auto mb-4 flex items-center justify-center animate-pulse",children:n.jsx(Y,{className:"h-8 w-8 text-white"})}),n.jsx("p",{className:"text-muted-foreground",children:d("common.loadingDashboard")})]})});const v=a.filter(_=>_.status==="in_progress").length,f=a.filter(_=>_.status==="waiting_for_parts").length,C=a.filter(_=>_.status==="completed").length,k=a.filter(_=>_.status!=="completed");return n.jsxs("div",{className:"space-y-6 pb-6 animate-fade-in",children:[n.jsxs("div",{className:"relative overflow-hidden rounded-2xl p-6 glass-light",children:[n.jsx("div",{className:"absolute inset-0 gradient-royal-radial opacity-5"}),n.jsx("div",{className:"absolute top-0 right-0 w-48 h-48 bg-primary/5 rounded-full blur-3xl"}),n.jsx("div",{className:"relative",children:n.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n.jsx("div",{className:"w-14 h-14 flex items-center justify-center",children:n.jsx("img",{src:"/Garageprologo.png",alt:"GaragePro Logo",className:"w-full h-full object-contain"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gradient-royal",children:d("dashboard.welcomeUser").replace("{name}",((j=t==null?void 0:t.fullName)==null?void 0:j.split(" ")[0])||"")}),n.jsx("p",{className:"text-sm text-muted-foreground",children:d("dashboard.readyToWork")})]})]})})]}),n.jsxs(xe,{className:"justify-start",children:[n.jsx("div",{onClick:()=>s("/jobs?tab=available"),className:"cursor-pointer hover:scale-105 transition-transform",children:n.jsx(W,{heading:d("jobs.available"),value:i.length,iconSrc:"/icon-not-started.gif"})}),n.jsx("div",{onClick:()=>s("/jobs?status=in_progress"),className:"cursor-pointer hover:scale-105 transition-transform",children:n.jsx(W,{heading:d("jobs.active"),value:v,iconSrc:"/icon-in-progress.gif"})}),n.jsx("div",{onClick:()=>s("/jobs?status=waiting_for_parts"),className:"cursor-pointer hover:scale-105 transition-transform",children:n.jsx(W,{heading:d("jobs.ordered"),value:f,iconSrc:"/icon-waiting-parts.gif"})}),n.jsx("div",{onClick:()=>s("/jobs?status=completed"),className:"cursor-pointer hover:scale-105 transition-transform",children:n.jsx(W,{heading:d("jobs.completed"),value:C,iconSrc:"/icon-completed.gif"})})]}),n.jsxs(I,{className:"card-glass",children:[n.jsx($,{className:"pb-4",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-8 h-8 rounded-lg gradient-royal flex items-center justify-center",children:n.jsx(Y,{className:"h-4 w-4 text-white"})}),n.jsx(J,{className:"text-lg font-bold",children:d("nav.jobs")})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Y,{className:`h-5 w-5 transition-colors ${l?"text-muted-foreground":"text-primary"}`}),n.jsxs("label",{className:"switch-toggle relative inline-block",children:[n.jsx("input",{type:"checkbox",checked:l,onChange:_=>h(_.target.checked),className:"opacity-0 w-0 h-0 absolute"}),n.jsxs("span",{className:`switch-inner relative block w-[140px] h-[30px] rounded-full cursor-pointer transition-all duration-300 ${l?"bg-foreground":"bg-muted"}`,children:[n.jsx("span",{className:`switch-label absolute text-xs font-medium top-[7px] transition-all duration-300 ${l?"left-[15px] text-background":"right-[8px] left-auto text-muted-foreground"}`,children:d(l?"jobs.active":"jobs.available")}),n.jsx("span",{className:`switch-slider absolute w-[70px] h-[26px] rounded-full top-[2px] text-xs font-medium flex items-center justify-center transition-all duration-300 shadow-md ${l?"left-[68px] bg-muted-foreground text-background":"left-[2px] bg-background text-foreground"}`,children:d(l?"jobs.available":"jobs.active")})]})]}),n.jsx(ie,{className:`h-5 w-5 transition-colors ${l?"text-primary/70":"text-muted-foreground"}`})]})]})}),n.jsx(B,{className:"space-y-3",children:l?n.jsxs(n.Fragment,{children:[i.length>0?n.jsx("div",{className:"space-y-3",children:i.slice(0,5).map((_,x)=>n.jsx("div",{className:"animate-slide-up",style:{animationDelay:`${x*50}ms`},children:n.jsx(pe,{job:_,userLanguage:e,userRole:"mechanic"})},_.id))}):n.jsxs("div",{className:"text-center py-12",children:[n.jsx(ie,{className:"h-12 w-12 text-muted-foreground/30 mx-auto mb-4"}),n.jsx("p",{className:"text-muted-foreground",children:d("jobs.noAvailableJobs")})]}),n.jsx("p",{onClick:()=>s("/jobs?tab=available"),className:"text-center text-sm text-primary hover:text-primary/80 cursor-pointer pt-2 hover:underline",children:d("jobs.viewAvailableJobs")})]}):n.jsxs(n.Fragment,{children:[k.length>0?n.jsx("div",{className:"space-y-3",children:k.slice(0,5).map((_,x)=>n.jsx("div",{className:"animate-slide-up",style:{animationDelay:`${x*50}ms`},children:n.jsx(pe,{job:_,userLanguage:e,userRole:"mechanic"})},_.id))}):n.jsxs("div",{className:"text-center py-12",children:[n.jsx(Y,{className:"h-12 w-12 text-muted-foreground/30 mx-auto mb-4"}),n.jsx("p",{className:"text-muted-foreground",children:d("jobs.noActiveJobs")})]}),n.jsx("p",{onClick:()=>s("/jobs?tab=my-jobs"),className:"text-center text-sm text-primary hover:text-primary/80 cursor-pointer pt-2 hover:underline",children:d("jobs.viewMyJobs")})]})})]})]})}function Jt(){const{user:d}=ce(),{t:e}=H();return d?d.role==="mechanic"?n.jsx(Rt,{}):n.jsx(kt,{}):n.jsx("div",{className:"flex items-center justify-center h-64",children:n.jsx("p",{className:"text-muted-foreground",children:e("auth.pleaseLogin")})})}export{Jt as default};
